function createShadowedBackground(e){e=void 0!==e?e:$("body"),$(".gridShadowedBackground").length<1?$(e).append($("<div />").addClass("gridShadowedBackground")):$(".gridShadowedBackground").removeClass("grid-hide")}function createModalPopup(e){createShadowedBackground(e=void 0!==e?e:$("body")),$(e).append($("<div />").addClass("gridPopupContent dialog").append($("<div />").addClass("gridPopupInner").append($("<h5 />").addClass("gridPopupHeader").html("Upload an Address Book")).append($("<div />").addClass("gridPopupBody").html('<h5>Upload your address list:</h5><div style="20px 20px 10px 20px"><input type="text" style="width:75%;display:inline-block"/><span class="jqs-choose-file grid-btn">Choose File</span></div><div style="padding-left:40px"><input type="checkbox"/>Check this if the uploaded file has Header Row</div><div style="text-align: right;padding-right: 40px"><span class="jqs-upload-file grid-btn">Upload</span></div>'))))}function createProgressBar(e,t,i){$(e).append($("<div />").addClass("meter").append($("<span />").addClass(void 0!==t?t:"jqs-progress").css({width:(void 0!==i?i:0)+"%"})))}function destroyProgressBar(e,t){$(".gridShadowedBackground").remove(),$(e).find(".gridPopupContent").remove()}function updateProgressBar(e,t,i){$(e).stop(),void 0===i||i?$(e).animate({width:t+"%"}):$(e).css("width",t+"%")}function getTextNodesIn(e){var t=[];if(3==e.nodeType)t.push(e);else for(var i=e.childNodes,a=0,s=i.length;a<s;++a)t.push.apply(t,getTextNodesIn(i[a]));return t}function setSelectionRange(e,t,i){if(document.createRange&&window.getSelection){var a=document.createRange();a.selectNodeContents(e);for(var s,o,r=getTextNodesIn(e),n=!1,d=0,l=0;o=r[l++];){if(s=d+o.length,!n&&t>=d&&(t<s||t==s&&l<=r.length)&&(a.setStart(o,t-d),n=!0),n&&i<=s){a.setEnd(o,i-d);break}d=s}var h=window.getSelection();h.removeAllRanges(),h.addRange(a)}else if(document.selection&&document.body.createTextRange){var c=document.body.createTextRange();c.moveToElementText(e),c.collapse(!0),c.moveEnd("character",i),c.moveStart("character",t),c.select()}}function makeEditableAndHighlight(e){var t,i=window.getSelection();i.rangeCount&&i.getRangeAt&&(t=i.getRangeAt(0)),document.designMode="on",t&&(i.removeAllRanges(),i.addRange(t)),document.execCommand("HiliteColor",!1,e)||document.execCommand("BackColor",!1,e),document.designMode="off"}function highlight(e){if(window.getSelection)try{document.execCommand("BackColor",!1,e)||makeEditableAndHighlight(e)}catch(t){makeEditableAndHighlight(e)}else document.selection&&document.selection.createRange&&document.selection.createRange().execCommand("BackColor",!1,e)}function selectAndHighlightRange(e,t,i){setSelectionRange(e,t,i),highlight("")}function scrollEvent(e){if(0==$(".jqs-grid-shadowed-background.hide").length&&$(".jqs-grid-shadowed-background").length>0&&0==$(".jqs-data-group-drop-down.texelGridList:hover").length&&0!=$("#env-variabledata-grid:hover").length){var t=window.event||e,i=t.detail?-120*t.detail:t.wheelDelta;(void 0!==t.deltaY&&(t.deltaY>0||t.deltaY<0)||void 0!==t.axis&&2==t.axis||void 0===t.deltaY&&void 0===t.axis)&&(i<0?$(".env-grid_vertical_scrollbar").scrollTo("+=30"):$(".env-grid_vertical_scrollbar").scrollTo("-=30"))}}$(window).on("resize",function(){try{$("#env-variabledata-grid").VariableDataGrid("resizeGridOverlay")}catch(e){}}),$(function(){var e=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";document.attachEvent?document.attachEvent("on"+e,scrollEvent):document.addEventListener&&(document.removeEventListener(e,scrollEvent),document.addEventListener(e,scrollEvent,!1))});var waitForFinalEvent=function(){var e={};return function(t,i,a){a||(a="Don't call this twice without a uniqueId."),e[a]&&clearTimeout(e[a]),e[a]=setTimeout(t,i)}}();Grid=function(e){this.rows=0,this.columns=0,this.data=[],Grid.functionsDefined||(Grid.functionsDefined=!0,Grid.prototype.init=function(e){this.rows=e[0],this.columns=e[1],this.data=new Array(this.rows);for(var t=0;t<this.rowCount;t++)this.data[t]=new Array(this.columnCount)},Grid.prototype.load=function(e){this.init(e.length,e[0].length);for(var t=0;t<this.rows;t++){this.data[t]=new Array(this.rows);for(var i=0;i<this.columns;i++)this.data[t][i]=e}})};var _getColumnIndex=function(e){return $(e).parent().index()};$.widget("envelopes.DataGrid",$.envelopes.BaseWidget,{options:{debug:!1,usesDesign:!0,responsive:!1,overlayRows:100,overlayColumns:26,overlayMaxRows:200,overlayMaxColumns:100,dataMinRows:100,dataMinColumns:1,dataAddRowSize:100,cellHeight:20,dataGroupId:0,clientId:"envelopes",partyId:"",sessionId:"",dataGroupMode:"manual",dataGroupAttributeSet:"dynamic",dataGroupAttributes:["A"],persistenceBatchSize:100,fileUploadEndpoint:"/"+websiteId+"/control/uploadVariableDataFile",getVariableDataGroupNamesEndPoint:"/"+websiteId+"/control/getVariableDataGroupNames",findVariableDataGroupEndPoint:"/"+websiteId+"/control/findVariableDataGroup",syncToServerEndpoint:"/"+websiteId+"/control/saveVariableData",deleteVariableDataEndpoint:"/"+websiteId+"/control/deleteVariableData",saveVariableDataForLaterEndpoint:"/"+websiteId+"/control/saveVariableDataForLater",loginCallback:function(){console.log("login callback")},contextMenu:'<div class="env-grid_contextmenu">  <div>a</div>  <div>b</div>  <div>c</div>  <div>d</div>  <div>e</div>  <div>f</div></div>'},_isResponsive:function(){return this.options.responsive},_getGridOverlayRows:function(){return this.options.overlayRows},_setGridOverlayRows:function(e){if(void 0===e){if(this._isResponsive()){var t=this.element.parent().height();this.options.overlayRows=parseInt((t-80)/this._getCellHeight())-5}}else if(this._getGridOverlayRows()!=e){this.options.overlayRows=e,this._resetOverlayColumns(),this._resetOverlayRows(),this._renderGridOverlay(),this._setVerticalScrollHeight(),this._loadDropdowns();var i=this._getDataGroup();void 0!==i.name&&this._setDataGroupName(i.name),this._lastRowOffSet>1&&$(".env-grid_vertical_scrollbar").scrollTo(parseInt((this._lastRowOffSet-1)*this._getScrollFactor()))}},_scrollToTop:function(){$(".env-grid_vertical_scrollbar").scrollTo(0)},_getGridOverlayColumns:function(){return this._getColumnTitles().length>0?this._getColumnTitles().length:this.options.overlayColumns},_getGridOverlayMaxRows:function(){return this.options.overlayMaxRows},_getGridOverlayMaxColumns:function(){return this.options.overlayMaxColumns},_getDataMinRows:function(){return this.options.dataMinRows},_getDataMinColumns:function(){return this.options.dataMinColumns},_getDataAddRowSize:function(){return this.options.dataAddRowSize},_getCellHeight:function(){return this.options.cellHeight},_getDataGroupId$:function(){return this.options.dataGroupId},_getPartyId$:function(){return this.options.partyId},_setPartyId$:function(e){this.options.partyId=e},_getSessionId$:function(){return this.options.sessionId},_getClientId$:function(){return this.options.clientId},_getDataGroupAttributeSet$:function(){return this.options.dataGroupAttributeSet},_getDataGroupAttributes$:function(){return this.options.dataGroupAttributes},_getWidgetName:function(){return"envelopes.DataGrid"},_getIndentBaseOffset:function(){return"\t\t\t\t\t"},_getDefaultGridDataArrayDimension:function(){return[this._getDataMinRows(),this._getDataMinColumns()]},_getColumnTitles:function(){return[]},_emptyRowsAtBottom:2,_uploadedFileName:"",_dataGroupId:0,_getDataGroupId:function(){return this._dataGroupId},_setDataGroupId:function(e){this._dataGroupId=e.dataGroupId,this._setRowDataIds(e.rowDataIds)},_setRowDataIds:function(e){for(prop in e){var t=this._gridData[e[prop]];t[0]=this._setIdCellValue(t[0],prop)}},_dataGroupAttributeSet:"dynamic",_getDataGroupAttributeSet:function(){return this._dataGroupAttributeSet},_setDataGroupAttributeSet:function(e){this._dataGroupAttributeSet=e},_dataGroupAttributes:[],_getDataGroupAttributes:function(){return this._dataGroupAttributes.length>0?this._dataGroupAttributes:this._getDataGroupAttributes$()},_setDataGroupAttributes:function(e){this._dataGroupAttributes=e},_dataGroups:{},_dataGroup:{},_getDataGroup:function(){return this._dataGroup},_setDataGroup:function(e){this._dataGroup=e,this._dataGroupId=e.id},_loadDataGroup:function(e){if(this._getDataGroupId()!=e){var t=this._getDataGroupFromClient(e);void 0!==t.id&&(this._setDataGroup(t),this._setDataGroupAttributeSet(t.attributeSet),this._setDataGroupAttributes(t.attributes),this._initializeGridData(),this._initGridData(),this._setDataGroupName(t.name),this._resetSelectedCells(),this._makeCellActive(),this._markSelection(!0),this._scrollToTop(),this._showServiceCharge())}},_getDataGroupFromClient:function(e){return void 0===e&&(e=0),this._getDataGroupFromServer(e)},_getDataGroupFromServer:function(e){var t="attributeSet="+this._getDataGroupAttributeSet$();void 0!==e&&e>0&&(t+="&groupId="+e);var i=null;return $.ajax({url:this.options.findVariableDataGroupEndPoint,data:t,method:"GET",dataType:"json",async:!1}).done(function(e){e.success&&(i=e.dataGroup)}),i},_bindDataGroup:function(){var e=this._getDataGroupFromClient(this._getDataGroupId$());void 0!==e.id&&(this._setDataGroup(e),this._setDataGroupAttributeSet(e.attributeSet),this._setDataGroupAttributes(e.attributes))},_initializeGridData:function(){var e=this._getOverlayRows()<this._getDataMinRows()?this._getDataMinRows():this._getOverlayRows(),t=this._getOverlayColumns()<this._getDataMinColumns()?this._getDataMinColumns():this._getOverlayColumns();this._gridData=new Array(e);for(var i=0;i<e;i++)this._gridData[i]=new Array(t);this._setVerticalScrollHeight()},_initGridData:function(){var e=this._getDataGroup();void 0!==e.name&&(this._setDataGroupName(e.name),this._loadGridData(e.rowData))},_loadGridData:function(e){this._resetActiveCell(),e=this._fixArrayDimension(e,this._getDefaultGridDataArrayDimension());var t=this._currentDataRowCount(),i=this._currentDataColumnCount();e.length>this._currentDataRowCount()&&(t=e.length),e[0].length>this._currentDataColumnCount()&&(this.addColumns(-1,e[0].length-i),i=e[0].length),t%100>0&&(t+=100-t%100),this._gridData=new Array(t);for(var a=0;a<t;a++)if(this._gridData[a]=new Array(i),a<e.length)for(var s=0;s<i;s++)s<e[a].length&&(this._gridData[a][s]=e[a][s]);this._setVerticalScrollHeight()},_getDataGroupName:function(){return $(".jqs-grid-name").val()},_setDataGroupName:function(e){$(".jqs-grid-name").val(e)},_unsavedRowDataBuffer:{indices:[],rowData:[]},_clearUnsavedRowDataBuffer:function(e){e._unsavedRowDataBuffer={indices:[],rowData:[]}},_addRowDataToUnsavedRowDataBuffer:function(e,t){var i=this._firstIndexInArray(this._unsavedRowDataBuffer.indices,e),a=i>-1?i:this._unsavedRowDataBuffer.indices.length;if(!this._isArrayEmpty(this._gridData[e])){var s=this._getRowIdValue(this._gridData[e][0]);""!=s&&this._isArrayEmpty(this._getRowDataWithoutIdValue(this._gridData[e]))?(i>-1&&(this._unsavedRowDataBuffer.indices.splice(i,1),this._unsavedRowDataBuffer.rowData.splice(i,1)),this._removeRowDataFromServer(s,e)):(this._unsavedRowDataBuffer.indices[a]=e,this._unsavedRowDataBuffer.rowData[a]=this._removeNullsFrom1DArray(this._gridData[e]))}(void 0===t||0==t)&&this._unsavedRowDataBuffer.rowData.length>0&&this._saveDataGroup({},this._clearUnsavedRowDataBuffer),this._updateServiceCharge()},_savedDataGroupNames:{},_getSavedDataGroupNames:function(e){if(1==e||0==Object.keys(this._savedDataGroupNames).length){var t=this,i="clientId="+this._getClientId$()+"&partyId="+this._getPartyId$()+"&sessionId="+this._getSessionId$();$.ajax({url:t.options.getVariableDataGroupNamesEndPoint,data:i,method:"GET",dataType:"json",async:!1}).done(function(e){e.success&&(t._savedDataGroupNames=e.dataGroups)}),e||(t._savedDataGroupNames[0]="New AddressBook")}return this._savedDataGroupNames},_updateSavedDataGroupNames:function(e,t){void 0===t||""==t.trim()||void 0!==this._savedDataGroupNames[e]&&this._savedDataGroupNames[e]==t||(this._savedDataGroupNames[e]=t,this._getDataGroup().name=t,this._renderSavedDataGroupNamesDropDown())},_renderSavedDataGroupNamesDropDown:function(){var e=this,t=$(".jqs-data-group-drop-down");$(t).html("");var i=this._getSavedDataGroupNames();for(prop in i)t.append($("<li />").attr("data-id",prop).html(i[prop]).on("click",function(){e._loadDataGroup($(this).attr("data-id"))}))},_gridData:[[]],_overlayRows:0,_getOverlayRows:function(){return this._overlayRows},_setOverlayRows:function(e,t){"boolean"==typeof t?1==t?this._overlayRows+=e:this._overlayRows-=e:this._overlayRows=e},_resetOverlayRows:function(){this._overlayRows=0},_overlayColumns:0,_getOverlayColumns:function(){return this._overlayColumns},_setOverlayColumns:function(e,t){"boolean"==typeof t?1==t?this._overlayColumns+=e:this._overlayColumns-=e:this._overlayColumns=e},_resetOverlayColumns:function(){this._overlayColumns=0},_rowOffSet:1,_lastRowOffSet:1,_getRowOffSet:function(){return this._rowOffSet},_setRowOffSet:function(e){e<1?e=1:e>=this._currentDataRowCount()&&(e=this._currentDataRowCount()),this._rowOffSet=e,this._lastRowOffSet=e},_view:"list",_getView:function(){return this._view},_setView:function(e){this._view=e},_caretPosition:"end",_getCaretPosition:function(){return this._caretPosition},_setCaretPosition:function(e){this._caretPosition=e},_resetCaretPosition:function(){this._caretPosition="end"},_selectedCells:[[],[]],_getSelectedCells:function(){return this._selectedCells},_setSelectedCells:function(e,t){null!==e&&null!==t?this._selectedCells=[this._selectedCells[0].concat(e),this._selectedCells[1].concat(t)]:null!==e?this._selectedCells=[this._selectedCells[0].concat(e),this._selectedCells[1]]:null!==t&&(this._selectedCells=[this._selectedCells[0],this._selectedCells[1].concat(t)])},_resetSelectedCells:function(){this._selectedCells=[[],[]],this._resetCopiedCells(),this._resetCaretPosition()},_copiedCells:[[],[]],_getCopiedCells:function(){return this._copiedCells},_setCopiedCells:function(e){this._copiedCells=e},_resetCopiedCells:function(){this._copiedCells=[[],[]],$(".jqs-copied").removeClass("jqs-copied")},_hasCopiedCells:function(){return this._copiedCells[0].length>0||this._copiedCells[1].length>0},_activeCell:[0,0],_getActiveCell:function(){return this._activeCell},_setActiveCell:function(e){4==this._activeCell.length?this._activeCell=[e[0],e[1],this._activeCell[2],this._activeCell[3]]:this._activeCell=e},_resetActiveCell:function(){4==this._activeCell.length?this._activeCell=[0,0,this._activeCell[2],this._activeCell[3]]:this._activeCell=[0,0],this._makeCellActive()},_mappingMode:!1,_isMappingMode:function(){return this._mappingMode},_setMappingMode:function(){this._mappingMode=!0,$(".jqs-grid-name").attr("readonly","readonly"),this._setToolbarButtonsState(),this._setMapColumnsToolbarButtonState(),this._hideServiceCharge()},_resetMappingMode:function(){this._mappingMode=!1,$(".jqs-grid-name").removeAttr("readonly"),this._setToolbarButtonsState(),this._setMapColumnsToolbarButtonState(),this._showServiceCharge()},_ignoreScroll:!1,_isIgnoreScroll:function(){return this._ignoreScroll},_setIgnoreScroll:function(){this._ignoreScroll=!0},_resetIgnoreScroll:function(){this._ignoreScroll=!1},_create:function(){0==$(".texelFileUploadForm").length&&this.element.parent().append('<div style="position:absolute; top:-100px;"><form class="texelFileUploadForm" id="texelFileUploadForm" action="'+this.options.fileUploadEndpoint+'" method="post" enctype="multipart/form-data"><input type="file" name="addressFile" id="addressFileButton"><input type="hidden" name="hasHeaderColumn" id="hasHeaderColumn"</form></div>'),$(window).scrollTop(0),this._bindDataGroup(),this._setGridOverlayRows(),this._renderGridOverlay(),this._initializeGridData(),this._initGridData(),this.resizeGridOverlay()},_renderGridOverlay:function(){var e=this;this.element.empty().append(this._buildToolbarElement()).append($("<div/>").addClass("env-grid_container").append($(this.options.contextMenu)).append('<div class="env-grid_topLeft"></div>').append(this._generateColumnHeaderRowHTML()).append(this._generateRowNumberColumnHTML())).append(this._buildScrollBarElement()).append($("<div/>").addClass("footer-container").append($("<div/>").addClass("left-side-container").append($("<div/>").addClass("jqs-upload-file grid-btn-cta margin-left-xs uploadAddressList").html('<i class="fa fa-upload"></i>  Upload Address List  <i class="fa fa-caret-right"></i>'))).append($("<div/>").addClass("right-side-container").append($("<span/>").addClass("jqs-cancel grid-btn grid-btn-regular").text("Cancel").on("click",function(){e._isMappingMode()?e._cancelColumnMapping():(e.closeEvent(),e.hideGrid())})).append($("<span/>").addClass("jqs-save-for-later grid-btn grid-btn-cta2"+(""!=e._getPartyId$()?" grid-hide":"")).text("Save for Later").on("click",function(){var t=$($(".env-grid_active_cell")[0]).find(".jqs-editable").text();e._saveCellData1(e._getActiveCell()[0],e._getActiveCell()[1],t),e._addRowDataToUnsavedRowDataBuffer(e._getActiveCell()[0],!0),e._saveDataGroup({},function(){e.saveVariableDataGroupsToAccount()})})).append($("<span/>").addClass("jqs-apply-to-design grid-btn grid-btn-cta").text(this.options.usesDesign?"Apply to Design":"Apply").on("click",function(){if($($(".env-grid_active_cell")[0]).find(".jqs-editable").length>0){var t=$($(".env-grid_active_cell")[0]).find(".jqs-editable").text();e._saveCellData1(e._getActiveCell()[0],e._getActiveCell()[1],t),e._addRowDataToUnsavedRowDataBuffer(e._getActiveCell()[0],!0)}0==e.getFilteredGridData(!0).length?alert("Please enter addressing data before applying to the design"):("function"==typeof triggerAddressing&&triggerAddressing(),$("#texAddAddressing").addClass("jqs-hasdata").removeAttr("data-reveal-id"),e._saveDataGroup({},function(){e.applyEvent(),e.hideGrid()}))})).append($('<span style="display:none"/>').addClass("jqs-finish-mapping grid-btn grid-btn-cta").text("Finish Mapping").on("click",function(){$('.jqs-co1umn-mapper option[value!=""]:selected').length>0?e.hideColumnMapper():alert("Please map the fields that matches your data ")})).append('<div class="jqs-addressing-service-charge" style="font-size: 20px;margin: 10px 5px 0px 0px;">Addressing Service Charge: <span class="jqs-addressing-fee" style="color: #FC7E22;">$0.00</span></div>'))).append($("<div />").addClass("jqs-grid-shadowed-background gridShadowedBackground grid-hide")),$(".texelFileUploadForm").find("#addressFileButton").on("change",function(t){var i=t.target.files[0].name;void 0!==i&&""!=typeof i&&null!=i||(i=$(this).val().split("\\").pop()),e.uploadedFileChangeEvent(i),e._uploadedFileName=i}),$("#texelFileUploadForm").on("submit",function(t){t.preventDefault(),"true"==$("#jqs-has-column-header:checked").val()&&$("#hasHeaderColumn").val("true");var i=t.target,a=new FormData(i);$.ajax({url:i.action,method:i.method,processData:!1,contentType:!1,data:a,dataType:"json"}).done(function(t){if(t.success)$(".texelFileUploadForm").find("#addressFileButton").val(""),e.options.dataGroupMode="",e._hideFileUpload(),e.uploadGridData(e.cleanVariableData(t.variableData),!0),e._showHintBalloon($(".env-grid_container .hint-start-mapping"),1e3);else{var i=t.message;"EMPTY_SHEET"==i?alert("The uploaded file has no address data in it."):"TOO_MANY_COLUMNS"==i&&alert("You can upload files with a maximum of 100 columns and found more than 100 columns.")}})}),this._addDefaultColumnHeader(),this._addRowsToGridOverlay(this._getGridOverlayRows()),e._makeGridCellsSelectable(),e._makeColumnsResizable()},siteLoginCallback:function(e){$("#env-variabledata-grid").VariableDataGrid("saveVariableDataGroupsToAccount",e.partyId)},siteLoginCallbackToLoadVariableDataGroups:function(e){$("#env-variabledata-grid").VariableDataGrid("loadAllVariableDataGroups",e.partyId)},_showExistingDataGroups:function(){var e=this,t=""!=e._getPartyId$();this._hideExistingDataGroups();var i=this._createPopup("existingGroups",(""!=t?"loggedin ":"")+"dialog");$(i).append($("<div />").addClass("gridPopupInner").append($("<h5 />").addClass("gridPopupHeader").html("Existing Address Books")).append(e._buildExistingDataGroupsDialogBody(t)).append($("<div />").addClass("gridCloseButton").on("click",function(){e.options.dataGroupMode="",e._hideExistingDataGroups()}))),1==t&&$(".jqs-save-for-later").addClass("grid-hide"),$("#jqs-grid-popup-existingGroups").css("height",$("#jqs-grid-popup-existingGroups").height()+10+"px")},_buildExistingDataGroupsDialogBody:function(e){var t=this,i=this._buildSavedDataGroupNamesDropDown(!0,e),a=$('<div style="text-align: center; width:400px"/>').addClass("gridPopupBody"),s=!1;return""!=i&&($(a).append($('<div style="text-align: left"/>').append("<h5>Choose an Address Book:</h5>").append(i)),0==e&&$(a).append($('<div style="margin-top:30px"/>')),s=!0),0==e&&$(a).append("<h6>Login to your account to see saved Address Books:</h6>").append($("<div>").css("text-align","center").append($("<span/>").css("width","200px").addClass("jqs-grid-login grid-btn grid-btn-cta").text("Log In").on("click",function(){t.loadAllVariableDataGroups()}))),0==s&&(0==e&&$(a).append($('<div style="margin-top:30px"/>')),$(a).append(0==e?"<h6>Or click below to create a New Address Book:</h6>":"<h6>No existing Address Books found, click below to create a New Address Book:</h6>").append($("<div>").css("text-align","center").append($("<span/>").css("width","200px").addClass("jqs-grid-login grid-btn grid-btn-cta2").text("New Address Book").on("click",function(){t._hideExistingDataGroups()})))),a},loadAllVariableDataGroups:function(e){void 0!==e&&this._setPartyId$(e),""!=this._getPartyId$()?this._showExistingDataGroups():(this._hideExistingDataGroups(),loginCallback(this.siteLoginCallbackToLoadVariableDataGroups))},_hideExistingDataGroups:function(){this.element.find("#jqs-grid-popup-existingGroups").remove(),this.element.find(".jqs-grid-shadowed-background").addClass("grid-hide"),$(".jqs-editable").focus(),this._setCaret("end")},_showFileUpload:function(){var e=this;this._hideFileUpload();var t=this._createPopup("fileUpload","dialog upload");$(t).append($("<div />").addClass("gridPopupInner").append($("<h5 />").addClass("gridPopupHeader").html("Upload Address Data")).append($("<div />").addClass("gridPopupBody").html("<h5>Upload the Address Data File:</h5>").append(this._buildFileUploadUI())).append($("<div />").addClass("gridCloseButton").on("click",function(){e._hideFileUpload()})))},_showDialog:function(e,t,i,a){var s=this,o=this._createPopup(e,"dialog");$(o).append($("<div />").addClass("gridPopupInner").append($("<h5 />").addClass("gridPopupHeader").html(t)).append($("<div />").addClass("gridPopupBody").html("<h6>"+i+"</h6>")).append($("<div/>").css("text-align","center").css("padding","10px 40px 10px").append($("<span/>").addClass("grid-btn grid-btn-cta").html("OK").on("click",function(){s._closeDialog(e)}))).append($("<div />").addClass("gridCloseButton").on("click",function(){s._closeDialog(e)}))),$("#jqs-grid-popup-"+e).css("height",$("#jqs-grid-popup-"+e).height()+10+"px")},_closeDialog:function(e){this.element.find("#jqs-grid-popup-"+e).remove(),this.element.find(".jqs-grid-shadowed-background").addClass("grid-hide"),$(".jqs-editable").focus(),this._setCaret("end")},_buildFileUploadUI:function(){return $('<div style="width:400px"/>').append($("<div/>").append('<input id="jqs-address-data-file" type="text" style="width:70%;display:inline-block"/>').append($("<span/>").addClass("jqs-choose-file-btn grid-btn grid-btn-cta").html("Choose File").off("click").on("click",function(){$(".texelFileUploadForm").find("#addressFileButton").trigger("click")}))).append($('<div style="position: relative;top: -8px;left:55px; disp"/>').append('<input id="jqs-has-column-header" value="true" readonly="readonly" type="checkbox" checked ="checked"/><span style="padding-left:10px">First row contains column names</span>')).append($("<div/>").css("text-align","right").append($("<span/>").addClass("jqs-upload-btn grid-btn").html("Upload").off("click").on("click",function(){$("#texelFileUploadForm").submit()})))},_hideFileUpload:function(){this.element.find("#jqs-grid-popup-fileUpload").remove(),$(".texelFileUploadForm").find("#addressFileButton").val(""),this.element.find(".jqs-grid-shadowed-background").addClass("grid-hide"),$(".jqs-editable").focus(),this._setCaret("end")},_showProgressBar:function(e,t){this._hideProgressBar();var i=this._createPopup(e);$(i).append($("<div />").attr("id","jqs-grid-progressbar-"+e).addClass("meter").append($("<span />").addClass("jqs-progress").css({width:t+"%"})))},_updateProgressBar:function(e,t,i){this.element.find("#jqs-grid-progressbar-"+e+" .jqs-progress").css({width:t+"%"}),1==i&&100==t&&this._hideProgressBar(e)},_hideProgressBar:function(e){this.element.find("#jqs-grid-popup-"+e).remove(),this.element.find(".jqs-grid-shadowed-background").addClass("grid-hide")},_createPopup:function(e,t){return this.element.find(".jqs-grid-shadowed-background").parent().append($("<div />").attr("id","jqs-grid-popup-"+e).addClass("jqs-grid-popup-content gridPopupContent"+(void 0!==t?" "+t:""))),this.element.find(".jqs-grid-shadowed-background").removeClass("grid-hide"),this.element.find("#jqs-grid-popup-"+e)},_makeGridCellsSelectable:function(){var e=this;$(".env-grid_container").selectable({filter:".env-grid_co1umn",appendTo:".gridOverlayBg",selecting:function(){$(".jqs-addr-drop-down").hide();var t=$(".ui-selecting:first",this),i=(e._getDataRowIndex($(t).parent().index(".env-grid_row")),e._getDataColumnIndex($(t).index()),$(".ui-selecting:last",this));e._getDataRowIndex($(i).parent().index(".env-grid_row")),e._getDataColumnIndex($(i).index())},unselecting:function(){var t=$(".ui-selecting:first",this),i=(e._getDataRowIndex($(t).parent().index(".env-grid_row")),e._getDataColumnIndex($(t).index()),$(".ui-selecting:last",this));e._getDataRowIndex($(i).parent().index(".env-grid_row")),e._getDataColumnIndex($(i).index())},selected:function(){var t=$(".ui-selected:first",this),i=[e._getDataRowIndex($(t).parent().index(".env-grid_row")),e._getDataColumnIndex($(t).index())];e.selectCell(i,i)}})},_makeColumnsResizable:function(){var e=this;$(".jqs-header-co1umn").resizable({handles:"e",resize:function(t,i){var a=$(i.element).width(),s=i.element.index();$(".jqs-editable").parent().parent().index()==s&&($(".jqs-editable").css("width",a-4+"px"),$(".jqs-editable").css("max-width",a-4+"px")),$(".env-grid_row .env-grid_co1umn:nth-child("+(s+1)+")").css("width",a+10+"px"),e._activeCell=[e._activeCell[0],e._activeCell[1],a-4,s]}})},_checkReadOnlyMode:function(e){if(this._isMappingMode())return alert("The grid is read only and you need to finish Column Mapping in order to make the grid editable"),e.preventDefault(),!1},_loadDropdowns:function(){$(document).off("click.addr-drop-down").on("click.addr-drop-down",function(e){"true"!=$(e.target).attr("data-dropdown-active")&&($(".jqs-addr-drop-down").hide(),$('[data-dropdown-active="true"]').each(function(){$(this).attr("data-dropdown-active","false")}))}),$(".jqs-addr-drop-down").each(function(){var e=$(this);if("true"!=e.attr("data-dropdown-live")){var t=$("#"+e.attr("data-dropdown-parent"));e.attr("data-dropdown-live","true"),e.css({top:t.offset().top-e.offset().top+parseFloat(t.outerHeight()),left:t.offset().left-e.offset().left,width:parseFloat(t.outerWidth()),height:"auto",visibility:"visible",display:"none"}),t.on("click.addr-drop-down",function(){e.toggle(),e.attr("data-dropdown-active","true"),t.attr("data-dropdown-active","true")})}})},_hideDropdown:function(){},_buildSavedDataGroupNamesDropDown:function(e,t,i){var a=this;if(void 0===i&&(i=this._getSavedDataGroupNames(e)),void 0!==e&&1==e){var s=$("<ul />").addClass("selectListContainer"),o=!1;for(prop in i)s.append($("<li />").attr("data-id",prop).addClass("selectList").html(i[prop]).on("click",function(){a._loadDataGroup($(this).attr("data-id")),a.options.dataGroupMode="",a._hideExistingDataGroups()})),o=!0;return void 0!==t&&1==t&&$(".jqs-addr-drop-down").html("").append(a._buildSavedDataGroupNamesDropDown(!1,!1,i)),o?s:""}s=$("<ul />").addClass("jqs-data-group-drop-down texelGridList");for(prop in i)s.append($("<li />").attr("data-id",prop).html(i[prop]).on("click",function(){a._loadDataGroup($(this).attr("data-id")),a.options.dataGroupMode=""}));return s},_buildToolbarElement:function(){var e=this;this._isMappingMode();return $("<div/>").addClass("env-grid_toolbar").append($("<div/>").addClass("tbr-btn-group").append($("<div/>").addClass("tbr-button")).append($("<input/>").attr("id","env-grid-name-input").addClass("tbr-name-textBox jqs-grid-name").attr("spellcheck",!1).on("keydown",function(){$(".jqs-addr-drop-down").hide()}).on("click",function(t){e._checkReadOnlyMode()}).on("blur",function(t){e.saveDataGroupName($(this).val())})).append($("<div />").addClass("jqs-addr-drop-down data-groups").attr("data-dropdown-parent","env-grid-name-input").append(e._buildSavedDataGroupNamesDropDown()))).append($("<div/>").addClass("tbr-btn-group").append($("<div/>").addClass("jqs-upload-file grid-btn-cta uploadAddressListMini").html('<i class="fa fa-upload"></i>'))).append($("<div/>").addClass("tbr-btn-group"))},_setMapColumnsToolbarButtonState:function(){},_setToolbarButtonsState:function(){var e=this;this._isMappingMode()?$(".tbr-button").addClass("disabled").off("click"):0==this.getFilteredGridData(!0).length?$(".jqs-upload-file").removeClass("disabled").off("click").on("click",function(){e._showFileUpload()}):$(".jqs-upload-file").addClass("disabled").off("click")},_generateColumnHeaderRowHTML:function(){return'<div class="env-grid_top"></div>'},_generateRowNumberColumnHTML:function(){return'<div class="env-grid_left"></div>'},_buildScrollBarElement:function(){var e=this,t=this._getGridOverlayRows()*this._getCellHeight()+21,i=t+11;return $('<div class="env-grid_vertical_scrollbar"/>').css("height",t+"px").css("bottom",i+"px").on("scroll",function(){e.scrollEvent()}).append($("<div/>").addClass("jqs-vertical-scroll-height"))},_getScrollFactor:function(){return 20},_addDefaultColumnHeader:function(){for(var e=this._getStringArray(this._getColumnTitles()),t=0;t<this._getGridOverlayColumns()&&t<this._getGridOverlayMaxColumns();t++)this._addColumnHeaderCell(t,e.length>t?e[t]:"")},_addColumnHeaderCell:function(e,t){var i="";i+=void 0!==t&&""!=t?'<div class="jqs-header-co1umn">'+t+"</div>":'<div class="jqs-header-co1umn">'+this._getDefaultColumnTitle(e)+"</div>",0==e?0==this._getOverlayColumns()?$(".env-grid_top").append($(i)):$(".env-grid_top div.jqs-header-co1umn:eq("+e+")").before($(i)):$(".env-grid_top div.jqs-header-co1umn:eq("+(e-1)+")").after($(i)),this._overlayColumnCreated()},_removeColumnHeaderCell:function(e){$(".env-grid_top .jqs-header-co1umn:eq("+e+")").remove(),this._overlayColumnRemoved()},_getDefaultColumnTitle:function(e){var t=String.fromCharCode(65+e%26);return e>25&&(t=String.fromCharCode(64+parseInt(e/26))+t),t},_addRowsToGridOverlay:function(e){for(var t=this,i=0;i<e;i++){if(this._getOverlayRows()+i>=this._getGridOverlayMaxRows())return i;this._addRowToGridOverlay()}$(".env-grid_container").append($("<div/>").addClass("jqs-grid-bottom grid-hide").append($("<div/>").append($('<span style="background: #808080"/>').addClass("jqs-add grid-btn grid-btn-regular").text("Add").on("click",function(){t.addRows()})).append($('<span style="position:relative; top: 2px; left: 7px;"/>').text("100 more rows at bottom"))))},_addRowToGridOverlay:function(){this._addRowNumberCellToGridOverlay();var e=$("<div/>").addClass("env-grid_row");$.each(this._buildOverlayRowCells(this._getOverlayColumns()),function(t,i){$(e).append(i)}),$(".env-grid_container").append($(e)),this._overlayRowCreated()},_addRowNumberCellToGridOverlay:function(){var e=this,t='<div class="jqs-row-number">'+(this._getOverlayRows()+1)+"</div>",i="",a=this._getOverlayRows();$(".env-grid_left").append($(t).hover(function(){i=$(this).html(),$(this).empty().append($('<img class="delete-icon" src="/html/addressing/img/delete.png"/>')).addClass("pointer-cursor").off("click").on("click",function(){1==confirm("This will remove the entire row, do you want to proceed?")&&e.removeRows(a)})},function(){$(this).html(i).removeClass("cursor-pointer")}))},removeRows:function(e,t){var i=this,a=this._getDataRowIndex(e),s=this._getRowIdValue(this._gridData[a][0]);parseInt(s)>0?$.ajax({url:i.options.deleteVariableDataEndpoint,method:"POST",data:"variableDataId="+s,dataType:"json",async:!1}).done(function(e){e.success&&(i._gridData.splice(a,1),i._renderData())}):(i._gridData.splice(a,1),this._renderData())},_removeRowDataFromServer:function(e,t){var i=this;parseInt(e)>0&&$.ajax({url:i.options.deleteVariableDataEndpoint,method:"POST",data:"variableDataId="+e,dataType:"json",async:!1}).done(function(e){e.success&&(i._gridData[t][0]="")})},_buildOverlayRowCells:function(e){for(var t=[],i=0;i<e&&!(this._getOverlayColumns()+i>=this._getGridOverlayMaxColumns());i++)t[i]=this._buildOverlayCell();return t},_buildOverlayCell:function(){var e=this;return $("<div/>").addClass("env-grid_co1umn").attr("spellcheck",!1).on("click",function(t){e._checkReadOnlyMode(t)})},_canSwitchCell:function(e,t){if(38==e||40==e)return!0;var i=window.getSelection().getRangeAt(0).startOffset;return 37==e&&0==i||39==e&&i==t.trim().length},_buildActiveCellElement:function(){var e=this,t='style="min-height:14px;';4==this._activeCell.length&&this._activeCell[1]==this._activeCell[3]?t=t+"width:"+this._activeCell[2]+"px;max-width:"+this._activeCell[2]+'px;" ':t+='"';var i=$("<div/>").addClass("env-grid_active_cell").append($('<div class="jqs-editable" '+t+' contenteditable="true"/>').on("mousedown",function(){try{$(".env-grid_container").selectable("destroy"),$(window).on("mouseup.jqs-editable-mouseup",function(){e._makeGridCellsSelectable(),e._setCaretPosition(window.getSelection().getRangeAt(0).startOffset),$(this).off("mouseup.jqs-editable-mouseup")})}catch(e){}}).on("paste",function(t){t.preventDefault();var i=t.originalEvent.clipboardData.getData("text");i=i.split(/\n/);for(var a=[],s=0;s<i.length;s++)a[s]=i[s].split(/\t/);(a.length>1||a[0].length>1)&&alert("Pasting tabular data is not supported"),$(this).text(a[0][0]),e._setCaretPosition("end"),e._setCaret("end")}).on("keydown",function(t){$(".jqs-addr-drop-down").hide(),$(this).width()>$(this).parent().width()-5&&$(this).width($(this).width()+$(".jqs-editable").parent().parent().next().width()),"13"==t.keyCode?(t.preventDefault(),e._activateNextCell(3)):"37"==t.keyCode&&e._canSwitchCell(t.keyCode,$(this).text())?(t.preventDefault(),e._activateNextCell(4)):"38"==t.keyCode&&e._canSwitchCell(t.keyCode,$(this).text())?(t.preventDefault(),e._activateNextCell(1)):"39"==t.keyCode&&e._canSwitchCell(t.keyCode,$(this).text())?(t.preventDefault(),e._activateNextCell(2)):"40"==t.keyCode&&e._canSwitchCell(t.keyCode,$(this).text())&&(t.preventDefault(),e._activateNextCell(3))}).on("keyup",function(){e._setCaretPosition(window.getSelection().getRangeAt(0).startOffset)}).on("blur",function(){})).append($("<div/>"));return this._shiftTab(i,function(){e._activateNextCell(4)},function(){e._activateNextCell(2)}),i},_activateNextCell:function(e){var t=this._getActiveCell()[0],i=this._getActiveCell()[1];switch(e){case 1:t-=1;break;case 2:i+=1;break;case 3:t+=1;break;case 4:i-=1}if(t<0||i<0||i>=this._currentDataColumnCount()||t>=this._currentDataRowCount())return!1;this._getOverlayRowIndex(t)<0?(this.scrollTo(this._getRowOffSet()+(1==e?-1:1)),this._activateNextCell(e),this._setIgnoreScroll(),$(".env-grid_vertical_scrollbar").scrollTo(1==e?"-=30":"+=30")):this.makeCellActive($(".env-grid_row:eq("+this._getOverlayRowIndex(t)+") .env-grid_co1umn:eq("+this._getOverlayColumnIndex(i)+")"))},_makeCellActive:function(){if(!this._isMappingMode()){var e=this._buildActiveCellElement(),t=this._getActiveCell()[0],i=this._getActiveCell()[1],a=this.getGridData()[t][i],s=this._getOverlayRowIndex(t),o=this._getOverlayColumnIndex(i);s>=0&&o>=0&&(this._renderCellValue(s,o,""),$(e).find(".jqs-editable").empty().text(this._getIdCellValue(a)),$(".env-grid_container .env-grid_row:eq("+s+") .env-grid_co1umn:eq("+o+")").append(e),$(".jqs-editable").focus()),this._showActiveRowAndColumn(),this._setMapColumnsToolbarButtonState(),this._setToolbarButtonsState()}},_showActiveRowAndColumn:function(){$(".jqs-active").removeClass("jqs-active");var e=this._getOverlayRowIndex(this._getActiveCell()[0]),t=this._getOverlayColumnIndex(this._getActiveCell()[1]),i=this._getSelectionType(),a=this._getSelectedCells()[0].length,s=this._getSelectedCells()[1].length;if(e>=0||"column"==i||"row"==i)if("row"==i||"cell"==i)for(var o=0;o<a;o++)e+o<0||$(".env-grid_container .env-grid_left > div:eq("+(e+o)+")").addClass("jqs-active");else"column"==i?$(".env-grid_container .env-grid_left > div").addClass("jqs-active"):$(".env-grid_container .env-grid_left > div:eq("+e+")").addClass("jqs-active");if(t>=0||"row"==i||"column"==i)if("column"==i||"cell"==i)for(o=0;o<s;o++)t+o<0||$(".env-grid_container .env-grid_top > div:eq("+(t+o)+")").addClass("jqs-active");else"row"==i?$(".env-grid_container .env-grid_top > div").addClass("jqs-active"):$(".env-grid_container .env-grid_top > div:eq("+t+")").addClass("jqs-active")},_addColumnToGridOverlay:function(e,t){if(void 0===e&&(e=this._getOverlayColumns()),!(e>=this._getGridOverlayMaxColumns())){this._addColumnHeaderCell(e,t);var i=this._buildOverlayCell(),a=this;$(".env-grid_row").each(function(t){i=$(i).clone(!0),0==e?0==a._getOverlayColumns()?$(this).append($(i)):$(this).find(".env-grid_co1umn:eq("+e+")").before($(i)):$(this).find(".env-grid_co1umn:eq("+(e-1)+")").after($(i))}),this._addColumnToGridData(e)}},_removeColumnFromGridOverlay:function(e){if(void 0===e||e>=this._getOverlayColumns())throw"An error occurred while removing the column at index "+e+" due to: Invalid column index";this._removeColumnHeaderCell(e),$(".env-grid_row").each(function(){$(this).find(".env-grid_co1umn:eq("+e+")").remove()}),this._removeColumnFromGridData(e)},_addColumnToGridData:function(e){var t=this._inverseArray(this._gridData,this._getDefaultGridDataArrayDimension());e==t.length?t[t.length]=new Array(t[0].length):0==e?t.splice(0,0,new Array(t[0].length)):t.splice(e,0,new Array(t[0].length)),this._gridData=this._inverseArray(t,this._getDefaultGridDataArrayDimension())},_removeColumnFromGridData:function(e){var t=this.getGridData();(t=this._inverseArray(t,this._getDefaultGridDataArrayDimension())).length>e&&t.splice(e,1),this._gridData=this._inverseArray(t,this._getDefaultGridDataArrayDimension()),this._gridDataChanged()},_addRowsToGridData:function(){for(var e=this._currentDataRowCount(),t=0;t<this._getDataAddRowSize();e++,t++)this._gridData[e]=new Array(this._currentDataColumnCount());this._setVerticalScrollHeight()},_setVerticalScrollHeight:function(){$(".jqs-vertical-scroll-height").css("height",(this._currentDataRowCount()+this._emptyRowsAtBottom)*parseInt(this._getCellHeight())+"px"),this._renderData()},_gridDataChanged:function(){this._renderData()},_renderData:function(){var e=this,t=!1,i=this._getRowOffSet()+this._getOverlayRows()<this._currentDataRowCount()+this._emptyRowsAtBottom?this._getRowOffSet()-1:this._currentDataRowCount()-this._getOverlayRows()+this._emptyRowsAtBottom;i==this._getRowOffSet()&&this._setRowOffSet(i+1);for(var a=i,s=0;s<this._getOverlayRows();a++,s++){if($(".env-grid_left div:eq("+s+")").text(a>=0?a+1:1),a+1>this._currentDataRowCount()&&(t=!0),t?($(".env-grid_container .env-grid_row:eq("+s+")").css("visibility","hidden"),$(".env-grid_left div:eq("+s+")").css("visibility","hidden"),$(".env-grid_container .jqs-grid-bottom").removeClass("grid-hide")):($(".env-grid_container .env-grid_row:eq("+s+")").css("visibility",""),$(".env-grid_left div:eq("+s+")").css("visibility",""),$(".env-grid_container .jqs-grid-bottom").addClass("grid-hide")),a<this._currentDataRowCount()){var o=this._gridData[a];$(".env-grid_container .env-grid_row:eq("+s+") .env-grid_co1umn").each(function(t){t<o.length?$(this).empty().text(void 0===o[t]?"":0==t?e._getIdCellValue(o[t]):o[t]):$(this).empty().text("")})}else $(".env-grid_container .env-grid_row:eq("+s+") div").empty().text("")}return t&&!this._isMappingMode()?($(".jqs-add-rows-section").show(),$(".tbr-button.jqs-add-rows").removeClass("disabled").off("click").on("click",function(){e.addRows()})):($(".jqs-add-rows-section").hide(),$(".tbr-button.jqs-add-rows").addClass("disabled").off("click")),e._setMapColumnsToolbarButtonState(),e._setToolbarButtonsState(),e._updateServiceCharge(),i},_showServiceCharge:function(){this._updateServiceCharge(),$(".jqs-addressing-service-charge").removeClass("grid-hide")},_hideServiceCharge:function(){this._updateServiceCharge(),$(".jqs-addressing-service-charge").addClass("grid-hide")},_updateServiceCharge:function(){var e=this.getFilteredGridData(!0).length,t=0;e>0&&e<100?t=1.15*e:e>=100&&e<200?t=.87*e:e>=200&&e<300?t=.75*e:e>=300&&e<500?t=.55*e:e>=500&&e<1e3?t=.48*e:e>=100&&(t=.38*e),$(".jqs-addressing-fee").text(this._formatCurrency(t))},_formatCurrency:function(e){return"$"+e.toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")},_overlayColumnCreated:function(){this._setOverlayColumns(1,!0),this._log(this.DEBUG,"Column added to GridOverlay !",0)},_overlayColumnRemoved:function(){this._setOverlayColumns(1,!1),this._log(this.DEBUG,"Column removed from GridOverlay !",0)},_overlayRowCreated:function(){this._setOverlayRows(1,!0),this._log(this.DEBUG,"Row added to GridOverlay !",0)},_overlayRowRemoved:function(){this._setOverlayRows(1,!1),this._log(this.DEBUG,"Row removed from GridOverlay !",0)},_currentDataRowCount:function(){return this.getGridData().length},_currentDataColumnCount:function(){return this.getGridData()[0].length},_getDataRowIndex:function(e){var t=this._getRowOffSet()+e-1;return t>=this._currentDataRowCount()&&(t=-1),t},_getDataColumnIndex:function(e){return e},_getOverlayRowIndex:function(e){var t=e-this._getRowOffSet()+1;return t>=this._getOverlayRows()&&(t=-1),t},_getOverlayColumnIndex:function(e){return e},_saveCellData:function(e,t,i){var a=this._getDataRowIndex(e),s=this._getDataColumnIndex(t);if(a<0||s<0||a>=this._currentDataRowCount||a>=this._currentDataColumnCount)throw"An error occurred while saving the cell data at Row:"+(e+1)+", Column:"+(t+1)+" due to: Invalid Data Index";var o=this._gridData[a][s];o!=(i=this._mergeIdCellValues(o,i))&&this._setCellValue(a,s,i)},_saveCellData1:function(e,t,i){var a=this._gridData[e][t];return a!=(i=this._mergeIdCellValues(a,i))?(this._setCellValue(e,t,i),this._getIdCellValue(i)):this._getIdCellValue(a)},_setCellValue:function(e,t,i){this._gridData[e][t]=i},_renderCellValue:function(e,t,i){$(".env-grid_container .env-grid_row:eq("+e+") .env-grid_co1umn:eq("+t+")").empty().text(i)},_showColumnMapper:function(e){this._renderMapperUIColumnHeader(e),this._setMappingMode(),$(".footer-container").find(".jqs-apply-to-design").hide(),$(".footer-container").find(".jqs-save-for-later").addClass("grid-hide"),$(".footer-container").find(".jqs-finish-mapping").show(),this._scrollToTop()},_selectColumnMappers:function(){var e=this.element;$.each(this._getColumnTitles(),function(t,i){e.find(".env-grid_top .jqs-co1umn-mapper:eq("+t+")").val(t).trigger("change")})},_finalizeColumnMapping:function(){var e=this._getColumnTitles();this._orderMappedColumns(e.length);var t=this;$(".jqs-header-co1umn select").each(function(i){return!(i>=t._getOverlayColumns())&&(""==$(this).val()?(t.removeColumns(i),t._addColumnToGridOverlay(i,e[i])):$(this).parent().html(e[i]),i+1<t._getOverlayColumns()&&i==e.length-1?(t.removeColumns(i+1,"all"),!1):void 0)}),$(".jqs-header-co1umn").each(function(t){$(this).html(e[t])}),this._makeColumnsResizable(),$(".footer-container").find(".jqs-apply-to-design").show(),$(".footer-container").find(".jqs-save-for-later").removeClass("grid-hide"),$(".footer-container").find(".jqs-finish-mapping").hide(),this._saveDataGroup(null,function(){t._resetMappingMode(),t._resetActiveCell(),t._resetSelectedCells(),t._makeCellActive(),t._markSelection(!0),t._scrollToTop()})},_cancelColumnMapping:function(){this._hideFileUpload(),$(".gridOverlay .tooltip").remove(),this._resetOverlayColumns(),this._resetOverlayRows(),this._resetMappingMode(),this._resetActiveCell(),this._resetSelectedCells(),this._create(),this.showGrid()},_orderMappedColumns:function(e){for(var t=this,i=0;i<e-$(".jqs-header-co1umn select").length;i++)t.addColumns();$(".jqs-header-co1umn select").each(function(e){var i=$(this).attr("data-value");""!=i&&t.swapColumns(_getColumnIndex($(this)),parseInt(i))})},_renderMapperUIColumnHeader:function(e){this.element.find(".env-grid_top").html(""),this._log(this.DEBUG,"started building "+this._getOverlayColumns()+" header columns",1);for(var t=0;t<this._getOverlayColumns();t++){this.element.find(".env-grid_top").append($("<div/>").addClass("jqs-header-co1umn").append(this._buildMapperDropdown(t,e)).append(this._buildRemoveColumnButton(t)));var i=$(".env-grid_row .env-grid_co1umn:nth-child("+(t+1)+")").width();i<$(".jqs-header-co1umn:eq("+t+")").width()&&(i=$(".jqs-header-co1umn:eq("+t+")").width()),$(".jqs-header-co1umn:eq("+t+")").css("width",i+10+"px"),$(".env-grid_row .env-grid_co1umn:nth-child("+(t+1)+")").css("width",i+10+"px")}this._log(this.DEBUG,"finished building "+this._getOverlayColumns()+" header columns",-1)},_buildMapperDropdown:function(e,t){var i=this,a=$("<select/>").addClass("jqs-co1umn-mapper").attr("data-previous-value","-1").append($("<option/>").attr("value","").html("Select One"));return 0==e&&a.attr("data-hint","Select the fields that matches your data").addClass("hint-start-mapping"),$(a).on("click",function(){i._hideHintBalloon($(".env-grid_container .hint-start-mapping"))}),$.each(this._getColumnTitles(),function(e,t){a.append($("<option/>").attr("value",e).html(t))}),$(a).on("change",function(){if("-1"==$(this).val())$(this).val(""),$(this).trigger("change");else{var e=$(this).parent().index(),t=parseInt($(this).val()),i=parseInt($(this).attr("data-previous-value"));i>=0&&($(".jqs-co1umn-mapper").find("option:eq("+(i+1)+")").removeAttr("disabled"),$(this).parent().find(".jqs-co1umn-remove").show()),$(this).attr("data-value",$(this).val()),""!=$(this).val()?($(this).find('option[value="-1"]').remove(),$(this).append($("<option/>").attr("value","-1").html("Un-map this Column")),$(this).attr("data-previous-value",t),$(".jqs-co1umn-mapper:lt("+e+"),.jqs-co1umn-mapper:gt("+e+")").find("option:eq("+(t+1)+")").attr("disabled","disabled"),$(this).parent().find(".jqs-co1umn-remove").hide()):$(this).find('option[value="-1"]').remove()}}),t.length>=e&&($(a).val(t[e]),$(a).trigger("change")),a},_buildRemoveColumnButton:function(){var e=this;return $("<span/>").addClass("jqs-co1umn-remove").append($('<img src="/html/addressing/img/delete.png"/>')).on("click",function(){$(".env-grid_top div.jqs-header-co1umn").length>1?1==confirm("This will remove the entire column, do you want to proceed?")&&e.removeColumns(_getColumnIndex($(this))):alert("The grid requires at least one column, so this last column can't be deleted")})},_swapColumnHeader:function(e,t){e>t&&($(".env-grid_top .jqs-header-co1umn:eq("+t+")").before($(".env-grid_top .jqs-header-co1umn:eq("+e+")")),Math.abs(e-t)>1&&$(".env-grid_top .jqs-header-co1umn:eq("+e+")").after($(".env-grid_top .jqs-header-co1umn:eq("+(t+1)+")")))},resizeGridOverlay:function(){if(this._isResponsive()){var e=this.element.parent().height(),t=parseInt((e-80)/this._getCellHeight())-5,i=t*this._getCellHeight()+21,a=i+11;this._setGridOverlayRows(t),$(".env-grid_vertical_scrollbar").css("height",i+"px").css("bottom",a+"px"),this._markSelection(),this._isMappingMode()&&this._showColumnMapper()}"upload"==this.options.dataGroupMode?(this._showFileUpload(),""!=this._uploadedFileName&&this.uploadedFileChangeEvent(this._uploadedFileName)):"existing"==this.options.dataGroupMode&&this._showExistingDataGroups(),this._setToolbarButtonsState()},scrollEvent:function(){if(this._isIgnoreScroll())return this._resetIgnoreScroll(),!1;var e=Math.ceil($(".env-grid_vertical_scrollbar").scrollTop()/this._getScrollFactor());this.scrollTo(parseInt(e)+1),this._setCaret(this._getCaretPosition())},setCellValue:function(e,t,i){this._saveCellData(e,t,i),console.log(this.getGridData())},getGridData:function(){return this._gridData},getFilteredGridData:function(e){return this._removeEmptyRows(this._clone(this._gridData),e,!0)},_applyGridData:function(){return this._removeEmptyRows(this._gridData,!0)},isGridEmpty:function(){for(var e=!1,t=0;t<this._gridData.length;t++){var i=this._gridData[t];if(e)break;for(var a=0;a<i.length;a++){var s=i[a];if(void 0!==s&&null!=s&&""!=s.trim()){e=!0;break}}}return!e},addRows:function(){this._addRowsToGridData(),this._makeCellActive()},addColumns:function(e,t,i){(void 0===t||t<1)&&(t=1),(void 0===e||e<0||e>this._getOverlayColumns())&&(e=this._getOverlayColumns());for(var a=0;a<t;a++)this._addColumnToGridOverlay(e+a,i)},removeColumns:function(e,t){if(void 0===e||e>=this._getOverlayColumns())throw"An error occurred while removing the column at index "+e+" due to: Invalid column index";if("string"==typeof t&&"all"==t)for(var i=this._getOverlayColumns()-1;i>=e;i--)this._removeColumnFromGridOverlay(i);else if("number"==typeof t)for(i=e+t-1;i>=e;i--)this._removeColumnFromGridOverlay(i);else this._removeColumnFromGridOverlay(e)},switchToTileView:function(){"tile"!=this._getView()&&($(".env-grid_container").removeClass("list-view").addClass("tile-view"),$(".tbr-button-list-view").removeClass("tbr-on"),$(".tbr-button-tile-view").addClass("tbr-on"),this._setView("tile"))},switchToListView:function(){"list"!=this._getView()&&($(".env-grid_container").removeClass("tile-view").addClass("list-view"),$(".tbr-button-tile-view").removeClass("tbr-on"),$(".tbr-button-list-view").addClass("tbr-on"),this._setView("list"))},makeCellActive:function(e,t,i){if(this._isMappingMode()&&void 0===i);else{if(this._clearSelection(t),$($(".env-grid_active_cell")[0]).find(".jqs-editable").length>0){var a=$($(".env-grid_active_cell")[0]).find(".jqs-editable").text();a=this._saveCellData1(this._getActiveCell()[0],this._getActiveCell()[1],a),this._renderCellValue(this._getOverlayRowIndex(this._getActiveCell()[0]),this._getOverlayColumnIndex(this._getActiveCell()[1]),this._getIdCellValue(a))}var s=$(e).parent().index(".env-grid_row"),o=$(e).index(),r=this._getDataRowIndex(s),n=this._getDataColumnIndex(o);i||(r!=this._getActiveCell()[0]&&this._addRowDataToUnsavedRowDataBuffer(this._getActiveCell()[0]),this._setActiveCell([r,n])),this._makeCellActive(),this._setCaret(this._getCaretPosition())}},scrollTo:function(e){var t=$($(".env-grid_active_cell")[0]).find(".jqs-editable").text(),i=this._getActiveCell()[0],a=this._getActiveCell()[1],s=this._getOverlayRowIndex(i),o=this._getOverlayColumnIndex(a);$($(".env-grid_active_cell")[0]).find(".jqs-editable").length>0&&(this._saveCellData(s,o,t),this._renderCellValue(s,o,"")),this._setRowOffSet(e);var r=this._renderData();return this._makeCellActive(),this._markSelection(!0),r},selectRow:function(e,t){void 0===t&&(t=1),this._clearSelection();for(var i=e,a=0;a<t;i++,a++)this._setSelectedCells(i,null);this._markSelection()},selectColumn:function(e,t){void 0===t&&(t=1),this._clearSelection();for(var i=e,a=0;a<t;i++,a++)this._setSelectedCells(null,i);this._markSelection()},selectCell:function(e,t){this._clearSelection();for(var i=[],a=e[0],s=0;a<=t[0];a++,s++)i[s]=a;var o=[];for(a=e[1],s=0;a<=t[1];a++,s++)o[s]=a;this._selectedCells=[i,o],this._markSelection()},applyEvent:function(){var e=this._getDataGroupId();this._trigger("onGridApply",null,{dataGroupId:e,data:this.getFilteredGridData(!0)}),this._applyGridData()},closeEvent:function(){this._trigger("onGridClose",null,{})},saveVariableDataGroupsToAccount:function(e){void 0!==e&&this._setPartyId$(e),""!=this._getPartyId$()?this._saveVariableDataGroupsToAccount():loginCallback(this.siteLoginCallback)},showAddVariableDataGroups:function(){},_saveVariableDataGroupsToAccount:function(){$.ajax({url:this.options.saveVariableDataForLaterEndpoint,method:"POST",data:"clientId="+this._getClientId$(),dataType:"json"}).done(function(e){e.success&&$(".jqs-save-for-later").addClass("grid-hide")})},uploadedFileChangeEvent:function(e){$("#jqs-address-data-file").val(e),$(".jqs-choose-file-btn").removeClass("grid-btn-cta").addClass("grid-btn-regular"),$(".jqs-upload-btn").addClass("grid-btn-cta")},_getSelectionType:function(){var e="",t=this._getSelectedCells();return t[0].length>0&&0==t[1].length?e="row":0==t[0].length&&t[1].length>0?e="column":t[0].length>0&&t[1].length>0&&(e="cell"),e},_copySelection:function(){(this._getSelectedCells()[0].length>0||this._getSelectedCells()[1].length>0)&&($(".env-grid_container").addClass("jqs-copied"),this._setCopiedCells(this._getSelectedCells()))},_markSelection:function(e){var t=this._getSelectionType(),i=this._getSelectedCells();this._clearSelection(!0);var a=this;switch(t){case"row":var s=a._getOverlayRowIndex(i[0][0])<0,o=a._getOverlayRowIndex(i[0][i[0].length-1])<0;$.each(i[0],function(t,i){var s=a._getOverlayRowIndex(i);s>=0&&(0==t&&a.makeCellActive($(".env-grid_container .env-grid_row:eq("+s+") > div.env-grid_co1umn:first"),!0,e),$(".env-grid_container .env-grid_row:eq("+s+")").addClass("jqs-row-selected"),$(".env-grid_container .env-grid_row:eq("+s+") > div.env-grid_co1umn").addClass("jqs-selected-cell"))}),s||$(".jqs-row-selected:first .jqs-selected-cell").addClass("selected-border-top"),$(".jqs-row-selected").each(function(e){$(this).find(".jqs-selected-cell:last").addClass("selected-border-right"),$(this).find(".jqs-selected-cell:first").addClass("selected-border-left")}),o||$(".jqs-row-selected:last .jqs-selected-cell").addClass("selected-border-bottom");break;case"column":$.each(i[1],function(t,i){a._getOverlayColumnIndex(i)>=0&&(0==t&&a.makeCellActive($(".env-grid_container .env-grid_row:eq(0) > div.env-grid_co1umn:eq("+i+")"),!0,e),$(".env-grid_row").each(function(e){$(this).addClass("jqs-co1umn-selected"),$(this).find(".env-grid_co1umn:eq("+i+")").addClass("jqs-selected-cell")}))}),$(".jqs-co1umn-selected").each(function(e){$(this).find(".jqs-selected-cell:last").addClass("selected-border-right"),$(this).find(".jqs-selected-cell:first").addClass("selected-border-left")});break;case"cell":s=a._getOverlayRowIndex(i[0][0])<0,o=a._getOverlayRowIndex(i[0][i[0].length-1])<0;for(var r=0;r<i[0].length;r++)for(var n=0;n<i[1].length;n++){var d=a._getOverlayRowIndex(i[0][r]),l=a._getOverlayColumnIndex(i[1][n]);d>=0&&l>=0&&(0==r&&0==n&&0==$(".env-grid_container .env-grid_row:eq("+d+") > div.env-grid_co1umn:eq("+l+")").find(".jqs-editable").length&&a.makeCellActive($(".env-grid_container .env-grid_row:eq("+d+") > div.env-grid_co1umn:eq("+l+")"),!0,e),$(".env-grid_row:eq("+d+")").each(function(t){(t>0||void 0!==e)&&($(this).addClass("jqs-cell-selected"),$(this).find(".env-grid_co1umn:eq("+l+")").addClass("jqs-selected-cell"))}))}s||$(".jqs-cell-selected:first .jqs-selected-cell").addClass("selected-border-top"),$(".jqs-cell-selected").each(function(e){$(this).find(".jqs-selected-cell:last").addClass("selected-border-right"),$(this).find(".jqs-selected-cell:first").addClass("selected-border-left")}),o||$(".jqs-cell-selected:last .jqs-selected-cell").addClass("selected-border-bottom");break;default:a._makeCellActive()}},_clearSelection:function(e){void 0!==e&&e||this._resetSelectedCells(),$(".jqs-row-selected").removeClass("jqs-row-selected"),$(".jqs-co1umn-selected").removeClass("jqs-co1umn-selected"),$(".jqs-cell-selected").removeClass("jqs-cell-selected"),$(".jqs-selected-cell").removeClass("jqs-selected-cell"),$(".selected-border-top").removeClass("selected-border-top"),$(".selected-border-right").removeClass("selected-border-right"),$(".selected-border-bottom").removeClass("selected-border-bottom"),$(".selected-border-left").removeClass("selected-border-left")},_setCaret:function(e,t){if(t=void 0===t?$(".jqs-editable")[0]:t,"end"==(e=void 0===e?0:e)&&(e=$(t).text().length),t){if(""!=$(t).text()){var i=document.createRange(),a=window.getSelection();i.setStart(t.childNodes[0],e),i.collapse(!0),a.removeAllRanges(),a.addRange(i)}t.focus()}},showColumnMapper:function(){this._showColumnMapper(),this._selectColumnMappers()},hideColumnMapper:function(){this._finalizeColumnMapping()},uploadGridData:function(e,t){this._extractColumnMapperData(e),this._loadGridData(e),void 0!==t&&1==t&&(this._showColumnMapper(this._columnMapperData),this._hasDefaultTemplate()&&(this._finalizeColumnMapping(),$(".gridOverlay .tooltip").remove(),this._resetMappingMode()))},cleanVariableData:function(e){if(void 0!==e)for(var t,i,a,s=0;s<e.length;s++){t=void 0,i=void 0,a=void 0;for(var o=0;o<e[s].length;o++)if(void 0!==e[s][o]&&null!=e[s][o]&&(void 0!==a&&null!=a||(a=e[s][o].match(/^(?:\s+|)((?:connecticut|massachusetts|maine|new(?:\s+|)hampshire|new(?:\s+|)jersey|puerto(?:\s+|)rico|rhode(?:\s+|)island|vermont))(?:\s+|)$/i)),void 0!==t&&null!=t||null!=(t=e[s][o].match(/^(?:\s+|)([0-9]+)((?:\-[0-9]+(?:\s+|)$|(?:\s+|)$))/))&&(i=o),void 0!==a&&void 0!==t&&null!=a&&null!=t)){for(var r=t[1].length,n=0;n<5-r;n++)t[1]="0"+t[1];e[s][i]=t[1]+(void 0!==t[2]?t[2]:"");break}}return e},_columnMapperData:[],_extractColumnMapperData:function(e){this._columnMapperData=e[0],e.splice(0,1),this._hasDefaultTemplate()||(this._columnMapperData=[])},_hasDefaultTemplate:function(){for(var e=0;e<this._columnMapperData.length;e++)if(isNaN(parseInt(this._columnMapperData[e]))||-1==parseInt(this._columnMapperData[e]))return!1;return this._columnMapperData.length>0},swapColumns:function(e,t){var i=e>t?e:t,a=e<t?e:t;this._swapColumnHeader(i,a);var s=this.getGridData(),o=this._inverseArray(s,this._getDefaultGridDataArrayDimension()),r=o[e];o[e]=o[t],o[t]=r,this._gridData=this._inverseArray(o,this._getDefaultGridDataArrayDimension()),this._gridDataChanged()},showGrid:function(e,t){var i=this;$(window).scrollTop(0),this.element.parent().show(),this._loadDropdowns(),$(".gridOverlayBg").removeClass("grid-hide"),$(".jqs-editable").trigger("click"),this._setCaret(this._getCaretPosition()),$("body").removeClass("texelGridScrollRemoval").addClass("texelGridScrollRemoval"),void 0!==t&&parseInt(t)>0?($(".env-grid_vertical_scrollbar").scrollTo(parseInt((t-1)*this._getScrollFactor())),setTimeout(function(){i._activeCell=[t-1,0],i._makeCellActive()},500)):"existing"==e?this._showExistingDataGroups():"upload"==e&&this._showFileUpload()},hideGrid:function(){this.element.parent().hide(),$(".gridOverlayBg").addClass("grid-hide"),$("body").removeClass("texelGridScrollRemoval")},saveDataGroupName:function(e){if(this._getDataGroup().name!=e){var t={name:e};this._saveDataGroup(t)}},_saveDataGroup:function(e,t){null==e?((e={}).name=this._getDataGroupName(),this._setRowDataToDataGroup(e,!0,!1),e.batchedRowData.length>0&&e.batchedRowData[0].length>0&&this._saveDataGroupOnServer(e,t)):0==Object.keys(e).length?(this._setRowDataToDataGroup(e,!0,!0),0==this._getDataGroupId()&&(e.name=this._getDataGroupName()),e.batchedRowData.length>0&&e.batchedRowData[0].length>0?this._saveDataGroupOnServer(e,t):void 0!==t&&t(this)):1==Object.keys(e).length&&"name"==Object.keys(e)[0]&&(this._setRowDataToDataGroup(e,!0,!0),(this._getDataGroupId()>0||e.batchedRowData.length>0&&e.batchedRowData[0].length>0)&&this._saveDataGroupOnServer(e,t)),this._showServiceCharge()},_setRowDataToDataGroup:function(e,t,i){var a=this.options.persistenceBatchSize;if(void 0===t||0==t){if(0==i){e.batchedRowData=[this.getFilteredGridData(!0)],e.batchedRowDataIndices=[];for(var s=0;s<e.batchedRowData.length;s++)e.batchedRowDataIndices[s]=s}else if(1==i)if(e.batchedRowData=[this._unsavedRowDataBuffer.rowData],this._unsavedRowDataBuffer.indices.length>0)e.batchedRowDataIndices=[this._unsavedRowDataBuffer.indices];else{var o=[];for(s=0;s<e.batchedRowData.length;s++)o[s]=s;e.batchedRowDataIndices=[o]}}else if(1==t)if(0==i){for(var r=this.getFilteredGridData(!0),n=[],d=[],l=(s=0,0),h=0;s<r.length;s++)0==s&&(n[0]=[],d[0]=[]),n[l][h]=r[s],d[l][h++]=s,h==a&&s<r.length-1&&(n[++l]=[],d[l]=[],h=0);e.batchedRowData=n,e.batchedRowDataIndices=d}else if(1==i){for(r=this._unsavedRowDataBuffer.rowData,o=this._unsavedRowDataBuffer.indices,n=[],d=[],s=0,l=0,h=0;s<r.length;s++)0==s&&(n[0]=[],d[0]=[]),n[l][h]=r[s],o.length>0?d[l][h++]=o[s]:d[l][h++]=s,h==a&&s<r.length-1&&(n[++l]=[],d[l]=[],h=0);e.batchedRowData=n,e.batchedRowDataIndices=d}},_saveDataGroupOnServerInBatch:function(e,t,i,a,s,o,r){0==t.id&&(t.id=this._getDataGroupId()),t.rowData=JSON.stringify(i.length>0?i[0]:i),t.rowDataIndices=JSON.stringify(a.length>0?a[0]:a),$.ajax({url:e.options.syncToServerEndpoint,method:"POST",data:t,dataType:"json"}).done(function(n){n.success&&(e._setDataGroupId(n),s>1&&e._updateProgressBar("saveData",e._calculateProgressPercentage(s,o+1),!0),0==o&&e._updateSavedDataGroupNames(n.dataGroupId,t.name),i.length>1?(i.shift(),a.shift(),e._saveDataGroupOnServerInBatch(e,t,i,a,s,++o,r)):void 0!==r&&r(e))})},_saveDataGroupOnServer:function(e,t){e.id=this._getDataGroupId(),e.attributeSet=this._getDataGroupAttributeSet(),e.attributes=JSON.stringify(this._getDataGroupAttributes()),e.sessionId=this._getSessionId$(),e.partyId=this._getPartyId$(),e.clientId=this._getClientId$();var i=e.batchedRowData;delete e.batchedRowData;var a=e.batchedRowDataIndices;delete e.batchedRowDataIndices,i.length>1&&this._showProgressBar("saveData",0),this._saveDataGroupOnServerInBatch(this,e,i,a,i.length,0,t)},_calculateProgressPercentage:function(e,t){return parseInt(100*t/e)},_showHintBalloon:function(e,t){$(e).tooltips(),setTimeout(function(){$(e).trigger("show")},t)},_hideHintBalloon:function(e){$(e).tooltips(),$(e).trigger("close")}}),function(e){e.fn.tooltips=function(t){var i;e("body");return this.each(function(t,a){i=e(a).attr("data-tooltip",t),e('.gridOverlay .tooltip[data-tooltip="'+t+'"]').remove();var s=e('<div class="tooltip" data-tooltip="'+t+'">'+i.attr("data-hint")+'<div class="arrow"></div></div>').appendTo(e(".gridOverlay")),o=i.position();s.css({top:o.top-s.outerHeight()+20,left:o.left-s.width()/2+90}),i.on("show",function(){i=e(this),s=e("div[data-tooltip="+i.data("tooltip")+"]");var t=i.position();s.css({top:t.top-s.outerHeight()+20,left:t.left-s.width()/2+90}),s.addClass("active")}).on("close",function(){i=e(this),s=e("div[data-tooltip="+i.data("tooltip")+"]").addClass("out"),setTimeout(function(){s.removeClass("active").removeClass("out")},300)})})}}(jQuery),$.widget("envelopes.DataGridProxy",$.envelopes.DataGrid,{_separator:function(e){this._log(e,"_____________________________________________________________________________________________________________________________________"),this._log(e,"")},_create:function(){this._separator(this.INFO),this._log(this.INFO,"Creating the DataGrid Widget ...",1),this._super(),this._log(this.INFO,"Creating the DataGrid Widget is complete !",-1),this._separator(this.INFO)},_renderGridOverlay:function(){this._separator(this.INFO),this._log(this.INFO,"Rendering the Grid Overlay ...",1),this._super(),this._log(this.INFO,"Rendering the Grid Overlay is complete !",-1),this._separator(this.INFO)},_buildToolbarElement:function(){this._separator(this.INFO),this._log(this.INFO,"Building the Toolbar ...",1);var e=this._super();return this._log(this.INFO,"Building the Toolbar is complete !",-1),this._separator(this.INFO),e},_generateColumnHeaderRowHTML:function(){this._separator(this.INFO),this._log(this.INFO,"Generating the ColumnHeader row ...",1);var e=this._super();return this._log(this.INFO,"Generating the ColumnHeader row is complete !",-1),this._separator(this.INFO),e},_generateRowNumberColumnHTML:function(){this._separator(this.INFO),this._log(this.INFO,"Generating the RowNumber Column ...",1);var e=this._super();return this._log(this.INFO,"Generating the RowNumber Column is complete !",-1),this._separator(this.INFO),e},_buildScrollBarElement:function(){this._separator(this.INFO),this._log(this.INFO,"Building the Scrollbar ...",1);var e=this._super();return this._log(this.INFO,"Building the Scrollbar is complete !",-1),this._separator(this.INFO),e},_addDefaultColumnHeader:function(){this._separator(this.INFO),this._log(this.INFO,"Adding default ColumnHeader cells to the ColumnHeader row ...",1),this._super(),this._log(this.INFO,"Adding default ColumnHeader cells to the ColumnHeader row is complete !",-1),this._separator(this.INFO)},_addColumnHeaderCell:function(e,t){this._separator(this.DEBUG),this._log(this.DEBUG,"Adding ColumnHeader cell to the ColumnHeader row ...",1),this._log(this.DEBUG,"*arg[columnIndex]: "+e,1),this._log(this.DEBUG,"*arg[columnTitle]: "+t,-1),this._super(e,t),this._log(this.DEBUG,"Adding ColumnHeader cell to the ColumnHeader row is complete !",-1),this._separator(this.DEBUG)},_getDefaultColumnTitle:function(e){this._separator(this.DEBUG),this._log(this.DEBUG,"Getting DefaultColumnTitle ...",1),this._log(this.DEBUG,"*arg[columnIndex]: "+e,0);var t=this._super(e);return this._log(this.DEBUG,"Got DefaultColumnTitle :"+t+" !",-1),this._separator(this.DEBUG),t},_addRowsToGridOverlay:function(e){this._separator(this.INFO),this._log(this.INFO,"Adding rows to GridOverlay ...",1),this._log(this.INFO,"*arg[numberOfRows]: "+e,0);var t=this._super(e);void 0===t?this._log(this.INFO,"Added "+e+" rows to the GridOverlay !",-1):this._log(this.INFO,"The GridOverlay only supports "+this._getGridOverlayMaxRows()+"rows. Only "+t+"rows added !",-1),this._separator(this.INFO)},_addRowToGridOverlay:function(){this._separator(this.DEBUG),this._log(this.DEBUG,"Adding a new row to the GridOverlay ...",1),this._super(),this._log(this.DEBUG,"Added a new row to the GridOverlay !",-1),this._separator(this.DEBUG)},_addRowNumberCellToGridOverlay:function(){this._separator(this.DEBUG),this._log(this.DEBUG,"Adding a new RowNumber cell to the GridOverlay ...",1),this._super(),this._log(this.DEBUG,"Added a new RowNumber cell to the GridOverlay !",-1),this._separator(this.DEBUG)},_buildOverlayRowCells:function(e){this._separator(this.DEBUG),this._log(this.DEBUG,"Adding cells to the GridOverlay row ...",1),this._log(this.DEBUG,"*arg[numberOfCells]: "+e,0);var t=this._super(e);return this._log(this.DEBUG,"Added "+e+" cells to the GridOverlay row !",-1),this._separator(this.DEBUG),t},_initializeGridData:function(){this._separator(this.INFO),this._log(this.INFO,"Initializing the GridData ...",1),this._super(),this._log(this.INFO,"Initializing the GridData complete !",-1),this._separator(this.INFO)},_addColumnToGridOverlay:function(e,t){this._separator(this.INFO),this._log(this.INFO,"Adding a new column to the GridOverlay at index "+e+" ...",1),this._log(this.INFO,"*arg[columnIndex]: "+e,0),this._log(this.INFO,"*arg[columnTitle]: "+t,0),this._super(e,t),this._log(this.INFO,"Added a new column to the GridOverlay at index "+e+" !",-1),this._separator(this.INFO)},_addColumnToGridData:function(e){this._separator(this.INFO),this._log(this.INFO,"Adding a new column to the GridData at index "+e+" ...",1),this._log(this.INFO,"*arg[columnIndex]: "+e,0),this._super(e),this._log(this.INFO,"Added a new column to the GridData at index "+e+" !",-1),this._log(this.DEBUG,this.getGridData()),this._separator(this.INFO)},_addRowsToGridData:function(){this._separator(this.INFO),this._log(this.INFO,"Adding "+this._getDataAddRowSize()+" new rows to GridData ...",1),this._super(),this._log(this.INFO,"Added "+this._getDataAddRowSize()+" new rows to GridData ...",-1),this._log(this.DEBUG,this.getGridData()),this._separator(this.INFO)},_setVerticalScrollHeight:function(){this._separator(this.INFO),this._log(this.INFO,"Setting the vertical scroll height ...",1),this._super(),this._log(this.INFO,"Set the vertical scroll height to "+this._currentDataRowCount()*parseInt(this._getCellHeight())+"px !",-1),this._separator(this.INFO)},_renderData:function(){this._separator(this.DEBUG),this._log(this.DEBUG,"Rendering the GridData ...",1);var e=this._super();return this._log(this.DEBUG,"Rendered the GridData based on RowOffSet  "+e+"!",-1),this._separator(this.DEBUG),e},scrollTo:function(e){this._separator(this.DEBUG),this._log(this.DEBUG,"Scrolling to rowOffSet "+e+" ...",1),this._log(this.INFO,"*arg[rowOffSet]: "+e,0);var t=this._super(e);return this._log(this.DEBUG,"Scrolled to rowOffSet "+t+" !",-1),this._separator(this.DEBUG),t},_currentDataRowCount:function(){return this._super()}}),$.widget("envelopes.VariableDataGrid",$.envelopes.DataGridProxy,{options:{dataGroupAttributeSet:"address"},_getColumnTitles:function(){return this._getDataGroupAttributes()},_getDataGroup:function(){return this._super()}});
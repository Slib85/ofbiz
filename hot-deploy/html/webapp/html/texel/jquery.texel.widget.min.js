function qExtend(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e}function getFXGXML(e,t){var a=null;return $.ajax({type:"GET",async:!1,url:"https://texel.envelopes.com/getFXG?type="+(t?"ugc":"")+"&id="+e,timeout:5e3,dataType:"xml"}).done(function(e){a=e}),a}function Scene7Element(e,t){this.id=e,this.type=t,this.parentX=0,this.parentY=0,this.x=0,this.y=0,this.width=1,this.height=1,this.scaleX=1,this.scaleY=1,this.rotation=0,this.originalRotation=0,this.deleted=!1,this.changed=!1,this.custom=!1,this.justAdded=!1,this.image=null,this.editable=!0}function Scene7RichText(e,t){Scene7Element.call(this,e,t),this.text="",this.tracking=0,this.textAlign="left",this.lineHeight=12,this.color="#000000",this.fontFamily="Minion Pro",this.fontSize=12,this.fontWeight="",this.textDecoration="",this.fitToSize=!1,this.isVariable=!1,this.groupId=null}function Scene7Bitmap(e,t){Scene7Element.call(this,e,t),this.leftCropAmt=0,this.topCropAmt=0,this.rightCropAmt=0,this.bottomCropAmt=0,this.lastCropWidth=0,this.lastCropHeight=0,this.cropStartX=0,this.cropStartY=0,this.cropWidth=0,this.cropHeight=0,this.zoom=1,this.url=""}function Scene7Path(e,t){Scene7Element.call(this,e,t),this.color="#FFFFFF",this.pathData=[],this.data=null}function cmykToHex(e,t,a,i){return r=255-Math.round(2.55*(e+i)),g=255-Math.round(2.55*(t+i)),b=255-Math.round(2.55*(a+i)),r<0&&(r=0),g<0&&(g=0),b<0&&(b=0),rgbToHex(r,g,b)}function rgbToHex(e,t,a){return"#"+(String("0"+e.toString(16)).slice(-2)+String("0"+t.toString(16)).slice(-2)+String("0"+a.toString(16)).slice(-2)).toUpperCase()}function makeFullHex(e){if(void 0===e)return"#000000";var t=e.length,a="#";if(7==t)return e;if(4!=t&&3!=t)return"#000000";for(var i=1;i<e.length;i++)a+=3==t?e.charAt(i)+e.charAt(i)+e.charAt(i):e.charAt(i)+e.charAt(i);return a}function charEncodingForUser(e){return e.replace("’","'").replace("é","e")}function charEncodingForScene7(e){return(e=void 0!==e?e:"").replace(/’/g,"'").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/%/g,"&#37;").replace(/\+/g,"&#43;")}function replaceBreakLines(e){return void 0!==e?e.replace(/(?:\\r\\n)|(?:<br\s*\/*>)/g,"\n"):""}function isCommandKey(e){var t=window.navigator.userAgent;return(0<=t.indexOf("OPR/")||0<=t.indexOf("Safari/")||0<=t.indexOf("Chrome/"))&&"91"==e||0<=t.indexOf("Firefox")&&"224"==e||0<=t.indexOf("MSIE ")&&"17"==e}qExtend(Scene7RichText,Scene7Element),qExtend(Scene7Bitmap,Scene7Element),qExtend(Scene7Path,Scene7Element),$.widget("env.texel",{options:{activeDesign:"0",orientation:"portrait",templateType:null,backgroundColor:"#FFFFFF",staticWidth:300,staticHeight:300,format:"png-alpha",quality:80,designs:{},showElements:!0,loadFromProduct:!1,variableDataGridId:"env-variabledata-grid",variableDataGridOptions:{responsive:!0,debug:!1},allSpotColors:{},initialLoad:!0,debug:!1},_globalVars:{designerEl:null,colorMap:{},templateHeight:0,templateWidth:0,elementBorder:1,selectedElements:[],selectedOffset:{top:0,left:0},designs:{},userImages:[],s7ImageQueue:null,product:null,sessionId:null,partyId:null,colorsFrontSel:null,colorsBackSel:null,loadFunction:null,exitFunction:null,image:{front:null,back:null},allowedColors:null},setProduct:function(e){this._globalVars.product=e},getProduct:function(){return this._globalVars.product},setLoadFunction:function(e){"function"==typeof e&&(this._globalVars.loadFunction=e)},setExitFunction:function(e){"function"==typeof e&&(this._globalVars.exitFunction=e)},_clone:function(e){return JSON.parse(JSON.stringify(JSON.decycle(e)))},_setOption:function(e,t){this._super(e,t),this._debug(e,t,null),"orientation"===e&&this._rotateTexel(),"showElements"!==e?this._paintTexel(this.options.activeDesign,!1,null,!0):this._toggleElementVisibility(this.options.activeDesign,t)},_setOptions:function(e){for(var t in this._super(e),e)e.hasOwnProperty(t)&&this._debug(t,e[t],null)},_setGlobalVars:function(e,t){this._globalVars[e]=t,this._debug(e,t)},getGlobalVars:function(e){return void 0===e?this._globalVars:this._globalVars[e]},_fonts:["AddCityboy","Adobe Caslon Pro","Adobe Caslon Pro Bold","Adobe Caslon Pro Italic","Adobe Fangsong Std R","Adobe Garamond Pro","Adobe Garamond Pro Bold","Adobe Garamond Pro Italic","Adobe Heiti Std R","Adobe Jenson Pro","Adobe Kaiti Std R","Adobe Ming Std L","Adobe Myungjo Std M","Adobe Song Std L","Adstien Normal","Allura","Alte Haas Grotesk","Ambient","American Typewriter","Angelina","AppleMyungjo","Arno Pro Display","Arnprior","BabelSans","BabelSans Italic","BakerSignet BT","Baloney","Batang","Batik Regular","Bauderie Script SSi","Bauhaus 93","Bauhaus Light","Bickham Script Pro Bold","Bickham Script Pro Regular","Birch Std","BlackChancery","Brandon Grotesque Regular","Brush Script Std","Cabletv","Calibri","Calibri Bold","Calibri Italic","Calligrapher","Cambria","Cambria Bold","Cambria Italic","Candara","Celtic Bold","Cezanne","Chalkboard","Chalkboard Bold","Chaparral Pro","Chaucer","Chisel","ChopinScript","Comic Sans MS","Consolas","Constantia","Copperplate","Corbel","Cornerstone","Courier New","Courier New Bold","Courier New Italic","Crillee","D3 Archism","Diploma","Dream Orphans","Eccentric Std","Echelon","Echelon Italic","Eleganza","Elisia","Emblem","English","Florence Regular","Franklin Gothic Medium","Freehand591","Fritz-Quad","Garamond Premr Pro","Garamond Premr Pro Italic","Garamond Premr Pro Smbd","Georgia","Georgia Italic","GeosansLight","Giddyup Std","Goodfish","Gotham Black","HandelGotDBol","HandelGotDLig","HandScript","Helsinki Light","Hobo Std","HoratioDLig","Impact","JaneAusten","Labtop","Lariat","LatinoSamba","Letter Gothic Std","Letter Gothic Std Bold","Lithos Pro Regular","Lucida Sans","Magical Wands","Mesquite Std","MicrogrammaDBolExt","Microsoft Sans Serif","Minion Pro","Mrs Eaves OT","Myriad Pro","Myriad Pro Bold","Myriad Pro CondItalic","Nueva Std Cond","OCR A Std","Orator Std","Plantagenet Cherokee","Poor Richard","Poplar Std","Pushkin","Radial","Radiated Pancake","Radii","Renaissance","Riesling","Rosewood Std Regular","Sabadoo","Sabertooth","Sable Lion","Saccule","Sachem","Sachem Bold","Sansation","Sansation Bold","Silom Regular","Sofia","Steiner","Stencil Std","T4C Beaulieux","Tag LET","Tahoma","Tahoma Bold","Times New Roman","Times New Roman Bold","Times New Roman Italic","Trajan Pro","Trajan Pro Bold","Tycho","Verdana","Verdana Bold","Verdana Italic","Virtue","Vivacious","Walkway Bold","Walkway Oblique","Walkway RevOblique","Windsong"],_colors:[{name:"Midnight Black",hex:"#000000",knockout:"#FFFFFF"},{name:"Deep Purple",hex:"#2e1b46",knockout:"#FFFFFF"},{name:"Navy",hex:"#002856",knockout:"#FFFFFF"},{name:"Pool",hex:"#0082ca",knockout:"#FFFFFF"},{name:"Baby Blue",hex:"#bad2dd",knockout:"#000000"},{name:"Seafoam",hex:"#98d2dd",knockout:"#000000"},{name:"Teal",hex:"#008996",knockout:"#FFFFFF"},{name:"Racing Green",hex:"#005740",knockout:"#FFFFFF"},{name:"Bright Green",hex:"#009946",knockout:"#FFFFFF"},{name:"Limelight",hex:"#a1d784",knockout:"#000000"},{name:"Wasabi",hex:"#dbe444",knockout:"#000000"},{name:"Citrus",hex:"#f1ed74",knockout:"#000000"},{name:"Lemonade",hex:"#ede59b",knockout:"#000000"},{name:"Nude",hex:"#f3dbb3",knockout:"#000000"},{name:"Silver",hex:"#c0c0c0",knockout:"#000000"},{name:"White",hex:"#ffffff",knockout:"#000000"},{name:"Sunflower",hex:"#fddd3f",knockout:"#000000"},{name:"Gold",hex:"#Fdd017",knockout:"#000000"},{name:"Pencil",hex:"#f8bf00",knockout:"#000000"},{name:"Mandarin",hex:"#ff9016",knockout:"#FFFFFF"},{name:"Grocery Bag",hex:"#caaa7b",knockout:"#000000"},{name:"Ochre",hex:"#d57f00",knockout:"#000000"},{name:"Rust",hex:"#bc4800",knockout:"#FFFFFF"},{name:"Terracotta",hex:"#993921",knockout:"#FFFFFF"},{name:"Tangerine",hex:"#e1261c",knockout:"#FFFFFF"},{name:"Ruby Red",hex:"#c20430",knockout:"#FFFFFF"},{name:"Garnet",hex:"#a32136",knockout:"#FFFFFF"},{name:"Wine",hex:"#8c3d45",knockout:"#FFFFFF"},{name:"Vintage Plum",hex:"#84286b",knockout:"#FFFFFF"},{name:"Magenta",hex:"#cb007c",knockout:"#FFFFFF"},{name:"Candy Pink",hex:"#f7dbe0",knockout:"#000000"},{name:"Wisteria",hex:"#7474c1",knockout:"#FFFFFF"},{name:"Lilac",hex:"#b5b4e0",knockout:"#000000"},{name:"Pastel Gray",hex:"#cacac8",knockout:"#000000"},{name:"Slate",hex:"#8d9b9b",knockout:"#000000"},{name:"Smoke",hex:"#6c6864",knockout:"#FFFFFF"},{name:"Tobacco",hex:"#88674d",knockout:"#FFFFFF"},{name:"Chocolate",hex:"#6f5d51",knockout:"#FFFFFF"},{name:"Moss",hex:"#6b5a24",knockout:"#FFFFFF"},{name:"Avocado",hex:"#90993f",knockout:"#000000"}],_setAllowedColors:function(e){var t=!1;if("undefined"!=typeof productPage)t=productPage.returnActiveProduct(!0).addAddressing;else for(var a=0;a<this._globalVars.designs[e].elements.length;a++){if(t=this._globalVars.designs[e].elements[a].isVariable)break}this._globalVars.allowedColors={"70lb. Bright White":{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,"Candy Pink":!0,"Bright Green":!0,Tobacco:!0,Slate:!0,Pool:!0,"Vintage Plum":!0,Terracotta:!0,Pencil:!0,Moss:!0,"Grocery Bag":!0,"Pastel Gray":!0,Seafoam:!0,Wisteria:!0,Rust:!0,Sunflower:!0,Avocado:!0,Nude:!0,Silver:!0,"Baby Blue":!0,Lilac:!0,Ochre:!0,Gold:!0,Limelight:!0,Mandarin:!0,Lemonade:!0,Wasabi:!0,Tangerine:!0,Citrus:!0},"80lb. White w&#x2f;Peel &amp; Press&trade;":{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,"Candy Pink":!0,"Bright Green":!0,Tobacco:!0,Slate:!0,Pool:!0,"Vintage Plum":!0,Terracotta:!0,Pencil:!0,Moss:!0,"Grocery Bag":!0,"Pastel Gray":!0,Seafoam:!0,Wisteria:!0,Rust:!0,Sunflower:!0,Avocado:!0,Nude:!0,Silver:!0,"Baby Blue":!0,Lilac:!0,Ochre:!0,Gold:!0,Limelight:!0,Mandarin:!0,Lemonade:!0,Wasabi:!0,Tangerine:!0,Citrus:!0},"White - 100&#x25; Recycled":{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,"Candy Pink":!0,"Bright Green":!0,Tobacco:!0,Slate:!0,Pool:!0,"Vintage Plum":!0,Terracotta:!0,Pencil:!0,Moss:!0,"Grocery Bag":!0,"Pastel Gray":!0,Seafoam:!0,Wisteria:!0,Rust:!0,Sunflower:!0,Avocado:!0,Nude:!0,Silver:!0,"Baby Blue":!0,Lilac:!0,Ochre:!0,Gold:!0,Limelight:!0,Mandarin:!0,Lemonade:!0,Wasabi:!0,Tangerine:!0,Citrus:!0},"Bright White - 100&#x25; Cotton":{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,"Candy Pink":!0,"Bright Green":!0,Tobacco:!0,Slate:!0,Pool:!0,"Vintage Plum":!0,Terracotta:!0,Pencil:!0,Moss:!0,"Grocery Bag":!0,"Pastel Gray":!0,Seafoam:!0,Wisteria:!0,Rust:!0,Sunflower:!0,Avocado:!0,Nude:!0,Silver:!0,"Baby Blue":!0,Lilac:!0,Ochre:!0,Gold:!0,Limelight:!0,Mandarin:!0,Lemonade:!0,Wasabi:!0,Tangerine:!0,Citrus:!0},"Glossy White":{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,"Candy Pink":!0,"Bright Green":!0,Tobacco:!0,Slate:!0,Pool:!0,"Vintage Plum":!0,Terracotta:!0,Pencil:!0,Moss:!0,"Grocery Bag":!0,"Pastel Gray":!0,Seafoam:!0,Wisteria:!0,Rust:!0,Sunflower:!0,Avocado:!0,Nude:!0,Silver:!0,"Baby Blue":!0,Lilac:!0,Ochre:!0,Gold:!0,Limelight:!0,Mandarin:!0,Lemonade:!0,Wasabi:!0,Tangerine:!0,Citrus:!0},"White Linen":{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,"Candy Pink":!0,"Bright Green":!0,Tobacco:!0,Slate:!0,Pool:!0,"Vintage Plum":!0,Terracotta:!0,Pencil:!0,Moss:!0,"Grocery Bag":!0,"Pastel Gray":!0,Seafoam:!0,Wisteria:!0,Rust:!0,Sunflower:!0,Avocado:!0,Nude:!0,Silver:!0,"Baby Blue":!0,Lilac:!0,Ochre:!0,Gold:!0,Limelight:!0,Mandarin:!0,Lemonade:!0,Wasabi:!0,Tangerine:!0,Citrus:!0},"Birch Translucent":{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,"Candy Pink":!0,"Bright Green":!0,Tobacco:!0,Slate:!0,Pool:!0,"Vintage Plum":!0,Terracotta:!0,Pencil:!0,Moss:!0,"Grocery Bag":!0,"Pastel Gray":!0,Seafoam:!0,Wisteria:!0,Rust:!0,Sunflower:!0,Avocado:!0,Nude:!0,Silver:!0,"Baby Blue":!0,Lilac:!0,Ochre:!0,Gold:!0,Limelight:!0,Mandarin:!0,Lemonade:!0,Wasabi:!0,Tangerine:!0,Citrus:!0},"White w&#x2f;Red LUX Lining":{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,"Candy Pink":!0,"Bright Green":!0,Tobacco:!0,Slate:!0,Pool:!0,"Vintage Plum":!0,Terracotta:!0,Pencil:!0,Moss:!0,"Grocery Bag":!0,"Pastel Gray":!0,Seafoam:!0,Wisteria:!0,Rust:!0,Sunflower:!0,Avocado:!0,Nude:!0,Silver:!0,"Baby Blue":!0,Lilac:!0,Ochre:!0,Gold:!0,Limelight:!0,Mandarin:!0,Lemonade:!0,Wasabi:!0,Tangerine:!0,Citrus:!0},"White w&#x2f;Black LUX Lining":{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,"Candy Pink":!0,"Bright Green":!0,Tobacco:!0,Slate:!0,Pool:!0,"Vintage Plum":!0,Terracotta:!0,Pencil:!0,Moss:!0,"Grocery Bag":!0,"Pastel Gray":!0,Seafoam:!0,Wisteria:!0,Rust:!0,Sunflower:!0,Avocado:!0,Nude:!0,Silver:!0,"Baby Blue":!0,Lilac:!0,Ochre:!0,Gold:!0,Limelight:!0,Mandarin:!0,Lemonade:!0,Wasabi:!0,Tangerine:!0,Citrus:!0},"White w&#x2f;Silver LUX Lining":{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,"Candy Pink":!0,"Bright Green":!0,Tobacco:!0,Slate:!0,Pool:!0,"Vintage Plum":!0,Terracotta:!0,Pencil:!0,Moss:!0,"Grocery Bag":!0,"Pastel Gray":!0,Seafoam:!0,Wisteria:!0,Rust:!0,Sunflower:!0,Avocado:!0,Nude:!0,Silver:!0,"Baby Blue":!0,Lilac:!0,Ochre:!0,Gold:!0,Limelight:!0,Mandarin:!0,Lemonade:!0,Wasabi:!0,Tangerine:!0,Citrus:!0},"White w&#x2f;Gold LUX Lining":{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,"Candy Pink":!0,"Bright Green":!0,Tobacco:!0,Slate:!0,Pool:!0,"Vintage Plum":!0,Terracotta:!0,Pencil:!0,Moss:!0,"Grocery Bag":!0,"Pastel Gray":!0,Seafoam:!0,Wisteria:!0,Rust:!0,Sunflower:!0,Avocado:!0,Nude:!0,Silver:!0,"Baby Blue":!0,Lilac:!0,Ochre:!0,Gold:!0,Limelight:!0,Mandarin:!0,Lemonade:!0,Wasabi:!0,Tangerine:!0,Citrus:!0},"Quartz Metallic":{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,"Candy Pink":!0,"Bright Green":!0,Tobacco:!0,Slate:!0,Pool:!0,"Vintage Plum":!0,Terracotta:!0,Pencil:!0,Moss:!0,"Grocery Bag":!0,"Pastel Gray":!0,Seafoam:!0,Wisteria:!0,Rust:!0,Sunflower:!0,Avocado:!0,Nude:!0,Silver:!0,"Baby Blue":!0,Lilac:!0,Ochre:!0,Gold:!0,Limelight:!0,Mandarin:!0,Lemonade:!0,Wasabi:!0,Tangerine:!0,Citrus:!0},Natural:{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,"Candy Pink":!0,"Bright Green":!0,Tobacco:!0,Slate:!0,Pool:!0,"Vintage Plum":!0,Terracotta:!0,Pencil:!0,Moss:!0,"Grocery Bag":!0,"Pastel Gray":!0,Seafoam:!0,Wisteria:!0,Rust:!0,Sunflower:!0,Avocado:!0,Silver:!0,"Baby Blue":!0,Lilac:!0,Ochre:!0,Gold:!0,Limelight:!0,Mandarin:!0,Lemonade:!0,Wasabi:!0,Tangerine:!0,Citrus:!0},"Natural - 100&#x25; Recycled":{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,"Candy Pink":!0,"Bright Green":!0,Tobacco:!0,Slate:!0,Pool:!0,"Vintage Plum":!0,Terracotta:!0,Pencil:!0,Moss:!0,"Grocery Bag":!0,"Pastel Gray":!0,Seafoam:!0,Wisteria:!0,Rust:!0,Sunflower:!0,Avocado:!0,Silver:!0,"Baby Blue":!0,Lilac:!0,Ochre:!0,Gold:!0,Limelight:!0,Mandarin:!0,Lemonade:!0,Wasabi:!0,Tangerine:!0,Citrus:!0},"Natural Linen":{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,"Candy Pink":!0,"Bright Green":!0,Tobacco:!0,Slate:!0,Pool:!0,"Vintage Plum":!0,Terracotta:!0,Pencil:!0,Moss:!0,"Grocery Bag":!0,"Pastel Gray":!0,Seafoam:!0,Wisteria:!0,Rust:!0,Sunflower:!0,Avocado:!0,Silver:!0,"Baby Blue":!0,Lilac:!0,Ochre:!0,Gold:!0,Limelight:!0,Mandarin:!0,Lemonade:!0,Wasabi:!0,Tangerine:!0,Citrus:!0},"Natural White - 100&#x25; Cotton":{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,"Candy Pink":!0,"Bright Green":!0,Tobacco:!0,Slate:!0,Pool:!0,"Vintage Plum":!0,Terracotta:!0,Pencil:!0,Moss:!0,"Grocery Bag":!0,"Pastel Gray":!0,Seafoam:!0,Wisteria:!0,Rust:!0,Sunflower:!0,Avocado:!0,Silver:!0,"Baby Blue":!0,Lilac:!0,Ochre:!0,Gold:!0,Limelight:!0,Mandarin:!0,Lemonade:!0,Wasabi:!0,Tangerine:!0,Citrus:!0},Stone:{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,"Bright Green":!0,Tobacco:!0,Slate:!0,Pool:!0,"Vintage Plum":!0,Terracotta:!0,Moss:!0,"Grocery Bag":!0,Seafoam:!0,Wisteria:!0,Rust:!0,Sunflower:!0,Avocado:!0,Silver:!0,"Baby Blue":!0,Lilac:!0,Ochre:!0,Gold:!0,Limelight:!0,Mandarin:!0,Lemonade:!0,Wasabi:!0,Tangerine:!0,Citrus:!0},"Natural w&#x2f;Gold LUX Lining":{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,"Candy Pink":!0,"Bright Green":!0,Tobacco:!0,Slate:!0,Pool:!0,"Vintage Plum":!0,Terracotta:!0,Moss:!0,"Grocery Bag":!0,"Pastel Gray":!0,Seafoam:!0,Wisteria:!0,Rust:!0,Sunflower:!0,Avocado:!0,Silver:!0,"Baby Blue":!0,Lilac:!0,Ochre:!0,Gold:!0,Limelight:!0,Mandarin:!0,Lemonade:!0,Wasabi:!0,Tangerine:!0,Citrus:!0},Nude:{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,"Bright Green":!0,Tobacco:!0,Slate:!0,Pool:!0,"Vintage Plum":!0,Terracotta:!0,Moss:!0,"Grocery Bag":!0,"Pastel Gray":!0,Seafoam:!0,Wisteria:!0,Rust:!0,Sunflower:!0,Avocado:!0,Silver:!0,Lilac:!0,Gold:!0,Limelight:!0,Mandarin:!0,Wasabi:!0,Tangerine:!0},"Grocery Bag":{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,"Bright Green":!0,Slate:!0,Pool:!0,"Vintage Plum":!0,Rust:!0,Silver:!0,Gold:!0,Limelight:!0,White:!0,Mandarin:!0,Wasabi:!0,Tangerine:!0},"Clear Translucent":{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,"Candy Pink":!0,"Bright Green":!0,Tobacco:!0,Slate:!0,Pool:!0,"Vintage Plum":!0,Terracotta:!0,Pencil:!0,Moss:!0,Seafoam:!0,Wisteria:!0,Rust:!0,Sunflower:!0,Avocado:!0,Nude:!0,Silver:!0,"Baby Blue":!0,Lilac:!0,Ochre:!0,Gold:!0,Limelight:!0,Mandarin:!0,Lemonade:!0,Wasabi:!0,Tangerine:!0,Citrus:!0},"Platinum Translucent":{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,"Candy Pink":!0,"Bright Green":!0,Tobacco:!0,Slate:!0,Pool:!0,"Vintage Plum":!0,Terracotta:!0,Pencil:!0,Moss:!0,"Grocery Bag":!0,Seafoam:!0,Wisteria:!0,Rust:!0,Sunflower:!0,Avocado:!0,Nude:!0,"Baby Blue":!0,Lilac:!0,Ochre:!0,Gold:!0,Limelight:!0,Mandarin:!0,Lemonade:!0,Wasabi:!0,Tangerine:!0,Citrus:!0},"Silver Metallic":{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,"Bright Green":!0,Tobacco:!0,Pool:!0,"Vintage Plum":!0,Terracotta:!0,Moss:!0,"Grocery Bag":!0,Seafoam:!0,Wisteria:!0,Rust:!0,Avocado:!0,Ochre:!0,Limelight:!0,Mandarin:!0,Wasabi:!0,Tangerine:!0,Citrus:!0},"Gold Translucent":{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,"Bright Green":!0,Tobacco:!0,Slate:!0,Pool:!0,"Vintage Plum":!0,"Grocery Bag":!0,Rust:!0,Ochre:!0,Limelight:!0,Mandarin:!0,Tangerine:!0},"Gold Metallic":{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,"Bright Green":!0,Tobacco:!0,Slate:!0,Pool:!0,"Vintage Plum":!0,"Grocery Bag":!0,Rust:!0,Ochre:!0,Limelight:!0,White:!0,Mandarin:!0,Tangerine:!0},Sunflower:{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,"Bright Green":!0,Tobacco:!0,Slate:!0,Pool:!0,"Vintage Plum":!0,"Grocery Bag":!0,Limelight:!0,White:!0,Mandarin:!0},Tobacco:{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,Silver:!0,Gold:!0,White:!0},"Rose Quartz Metallic":{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,"Bright Green":!0,Tobacco:!0,Slate:!0,Pool:!0,"Vintage Plum":!0,Moss:!0,"Grocery Bag":!0,Wisteria:!0,Rust:!0,Avocado:!0,Lilac:!0,Limelight:!0},Magenta:{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Wine:!0,Tobacco:!0,"Vintage Plum":!0,"Grocery Bag":!0,Silver:!0,White:!0},"Candy Pink":{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,"Bright Green":!0,Tobacco:!0,Slate:!0,Pool:!0,"Vintage Plum":!0,"Grocery Bag":!0,Rust:!0,Avocado:!0,Lilac:!0,Ochre:!0,Limelight:!0,Mandarin:!0},"Amethyst Metallic":{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Wine:!0,"Ruby Red":!0,"Bright Green":!0,Slate:!0,"Vintage Plum":!0,White:!0},"Crystal Metallic":{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Wine:!0,"Ruby Red":!0,Tobacco:!0,Slate:!0,Pool:!0,"Vintage Plum":!0,Terracotta:!0,Pencil:!0,Moss:!0,"Grocery Bag":!0,"Pastel Gray":!0,Seafoam:!0,Wisteria:!0,Rust:!0,Sunflower:!0,Avocado:!0,Nude:!0,"Baby Blue":!0,Lilac:!0,Limelight:!0,Mandarin:!0,Lemonade:!0,Wasabi:!0,Tangerine:!0,Citrus:!0},Lilac:{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Wine:!0,"Ruby Red":!0,"Bright Green":!0,Tobacco:!0,Slate:!0,"Vintage Plum":!0,Limelight:!0,White:!0},Wisteria:{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Wine:!0,"Ruby Red":!0,White:!0},Seafoam:{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,Tobacco:!0},"Aquamarine Metallic":{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,"Bright Green":!0,Tobacco:!0,Slate:!0,"Vintage Plum":!0,"Grocery Bag":!0,Mandarin:!0},"Baby Blue":{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,"Bright Green":!0,Tobacco:!0,Slate:!0,Pool:!0},"Leaf Translucent":{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Wine:!0,"Ruby Red":!0,Tobacco:!0,Slate:!0,Gold:!0,White:!0},"Fairway Metallic":{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Wine:!0,"Ruby Red":!0,Tobacco:!0,Slate:!0,"Grocery Bag":!0,Gold:!0,White:!0},"Lagoon Metallic":{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Wine:!0,"Ruby Red":!0,Tobacco:!0,Slate:!0,Pool:!0,"Vintage Plum":!0},Avocado:{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,"Ruby Red":!0,Tobacco:!0,Slate:!0,White:!0},Limelight:{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,"Ruby Red":!0,Tobacco:!0,Slate:!0,"Vintage Plum":!0,Silver:!0,Gold:!0,White:!0},Lemonade:{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,Wine:!0,"Ruby Red":!0,"Bright Green":!0,Tobacco:!0,Slate:!0,Pool:!0,"Vintage Plum":!0,Terracotta:!0,Moss:!0,"Grocery Bag":!0,Seafoam:!0,Wisteria:!0,Rust:!0,Avocado:!0,Lilac:!0,Ochre:!0,Gold:!0,Limelight:!0,Wasabi:!0},Ochre:{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Tobacco:!0,Slate:!0,Terracotta:!0,Rust:!0,Silver:!0,Gold:!0,White:!0},Mandarin:{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Slate:!0,Silver:!0,Gold:!0,White:!0},Tangerine:{Custom:!0,"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Tobacco:!0,Slate:!0,Silver:!0,Gold:!0,White:!0},"Copper Metallic":{"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Chocolate:!0,Smoke:!0,Silver:!0,Gold:!0,White:!0},Smoke:{"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Silver:!0,Gold:!0,White:!0},"Red Translucent":{"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Smoke:!0,White:!0},"Jupiter Metallic":{"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Smoke:!0,Silver:!0,Gold:!0,White:!0},Terracotta:{"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Smoke:!0,Teal:!0,Wine:!0,White:!0},"Ruby Red":{"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Smoke:!0,Silver:!0,Gold:!0,White:!0},Garnet:{"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Silver:!0,Gold:!0,White:!0},"Punch Metallic":{"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Chocolate:!0,Smoke:!0,"Ruby Red":!0,Gold:!0,White:!0},"Boardwalk Blue":{"Midnight Black":!0,Chocolate:!0,Smoke:!0,Silver:!0,Gold:!0,White:!0},Teal:{"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,Smoke:!0,White:!0},Pool:{"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Smoke:!0,White:!0},"Azalea Metallic":{"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Chocolate:!0,Smoke:!0,Wine:!0,White:!0},"Emerald Metallic":{"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Chocolate:!0,Smoke:!0,Silver:!0,Gold:!0,White:!0},"Vista Metallic":{"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,White:!0},Moss:{"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Tobacco:!0,White:!0},Olive:{"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Tobacco:!0,White:!0},Slate:{"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Teal:!0,White:!0},"Flame Metallic":{"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Magenta:!0,"Racing Green":!0,Chocolate:!0,Smoke:!0,Silver:!0,White:!0},"Vintage Plum":{"Midnight Black":!0,Navy:!0,"Deep Purple":!0,Garnet:!0,Smoke:!0,Silver:!0,Gold:!0,White:!0},"Bronze Metallic":{Silver:!t,Gold:!t,White:!0},Chocolate:{Silver:!t,Gold:!t,White:!0},"Anthracite Metallic":{Silver:!t,Gold:!t,White:!0},"Sapphire Metallic":{Silver:!t,Gold:!t,White:!0},Navy:{Silver:!t,Gold:!t,White:!0,"Midnight Black":!0},"Midnight Black":{Silver:!t,Gold:!t,White:!0},"Black Linen":{Silver:!t,Gold:!t,White:!0},"Black w&#x2f;Gold LUX Lining":{Silver:!t,Gold:!t,White:!0},"Teak Woodgrain":{Silver:!t,Gold:!t,White:!0}}},_debug:function(e,t,a){this.options.debug&&"object"==typeof console&&(void 0!==e&&null!=e?console.log("Set "+e+":"+t):console.log(a))},_populateDesignSettings:function(){var i=this;i._globalVars.designs=$.extend(!0,{},this.options.designs),$.each(this._globalVars.designs,function(e,t){if(i._globalVars.designs[e].s7XML=null,i._globalVars.designs[e].lastElement={},i._globalVars.designs[e].customCount=0,i._globalVars.designs[e].history=[],i._globalVars.designs[e].historyPosition=0,i._globalVars.designs[e].s7ElementQueue={},i._globalVars.designs[e].activeVariableData=0,i._globalVars.designs[e].variableData=[],i._globalVars.designs[e].spotColors=null,i._globalVars.designs[e].cleanAddressUrl=null,void 0===i._globalVars.designs[e].scene7url&&(i._globalVars.designs[e].scene7url=null),void 0===i._globalVars.designs[e].addressBookId&&(i._globalVars.designs[e].addressBookId=null),void 0===i._globalVars.designs[e].elements&&(i._globalVars.designs[e].elements=[]),void 0===i._globalVars.designs[e].hiddenElements&&(i._globalVars.designs[e].hiddenElements=[]),null!=i._globalVars.designs[e].addressBookId){var a=i.createAddressingGrid([[]],"manual",i.partyId,"0",!1);i._globalVars.designs[e].variableData=a.VariableDataGrid("getFilteredGridData",!0)}})},onLoad:function(){$("body").removeClass("texelScrollRemoval").addClass("texelScrollRemoval"),this.element.removeClass("hidden"),"function"==typeof this._globalVars.loadFunction&&this._globalVars.loadFunction(),this.makeFullSize()},_create:function(){var a=this;null==this._globalVars.sessionId&&(this._globalVars.sessionId="undefined"!=typeof envSession?envSession:null),$("body").append($("<div />").addClass("gridOverlayBg grid-hide")).append($("<div/>").addClass("gridOverlay reset-css grid-hide").append($("<div/>").attr("id",this.options.variableDataGridId))),this._globalVars.s7ImageQueue=new AjaxQueue(!0,3,!0),this._populateDesignSettings(),a._setAllowedColors(a.options.activeDesign),this._processFXGXML(null),this._loadUserImages(),this._getSpotColors();var t=$("<div />").addClass("sides");$.each(this._globalVars.designs,function(e){t.append($("<div />").addClass("side_"+e).append($("<p />").html("0"==e?"Front":"Back")).append($("<img />").attr("src","")).on("click",function(){a._setOption("activeDesign",e)}))}),this.element.append($("<div />").addClass("texel_container").append($("<div />").addClass("texelToolbox").append($("<div />").append($("<img />").attr("id","texAddText").attr("src","/html/texel/img/toolbox/addText.png").attr("alt","Add Text").attr("title","Add Text").on("click",function(){a.createCustomElement("RichText",null,null)})).append($("<div />").addClass("toolText").html("Text"))).append($("<div />").append($("<img />").attr("id","texAddImage").attr("src","/html/texel/img/toolbox/addImage.png").attr("alt","Add Image").attr("title","Add Image").on("click",function(){a.createCustomElement("BitmapImage",null,null)})).append($("<div />").addClass("toolText").html("Image"))).append($("<div />").append($("<img />").attr("id","texAddAddressing").attr("src","/html/texel/img/toolbox/addAddressing.png").attr("alt","Add Addressing").attr("title","Add Addressing").on("click",function(){void 0!==$("[bns-recipientaddresscount]").attr("bns-recipientaddresscount")&&0<parseInt($("[bns-recipientaddresscount]").attr("bns-recipientaddresscount"))?a.showGrid("manual"):$('[data-target="addressing"][data-key="addresses"]').trigger("click")})).append($("<div />").addClass("toolText").html("Addressing"))).append($("<div />").append($("<img />").attr("id","texUndo").attr("src","/html/texel/img/toolbox/undoLast.png").attr("alt","Undo").attr("title","Undo").on("click",function(){a.undo(null,!1)})).append($("<div />").addClass("toolText").html("Undo"))).append($("<div />").append($("<img />").attr("id","texRedo").attr("src","/html/texel/img/toolbox/redoLast.png").attr("alt","Redo").attr("title","Redo").on("click",function(){a.redo(null)})).append($("<div />").addClass("toolText").html("Redo"))).append($("<div />").append($("<img />").attr("id","texReset").attr("src","/html/texel/img/toolbox/refreshDesign.png").attr("alt","Reset").attr("title","Reset").on("click",function(){a.undo(null,!0)})).append($("<div />").addClass("toolText").html("Reset")))).append($("<div />").addClass("texelbtn newTemplate"+("undefined"!=typeof showTemplatesInDesigner&&showTemplatesInDesigner?"":" hidden")).attr("data-reveal-id","startDesign").html("Choose a New Template")).append($("<div />").addClass("texelTemplateHelp jqs-texelTemplateHelp").css({"background-color":"#f8f9fb",margin:"10px","text-align":"left"}).append($("<div />").addClass("row texelHelpHeader jqs-texelHelpHeader").css({color:"#00a4e4",cursor:"pointer",padding:"5px 15px"}).append($("<div />").css({"font-size":"14px",float:"left"}).append("Online Designer Help:")).append($("<div />").css({"font-size":"14px",float:"right"}).append("Show Help ").append($("<i />").addClass("fa fa-caret-down")))).append($("<div />").addClass("jqs-texelHelpContainer row hidden").css("padding","0px 15px").append($("<div />").css({float:"left",width:"50%",padding:"5px"}).append($("<span />").css({color:"#000000","font-size":"16px","font-weight":"bold"}).html("Add Your Customization")).append($("<ol />").css("margin-bottom","0px").append($("<li />").html("To begin editing an existing text box or image, just click the box and the necessary tools will appear.")).append($("<li />").html('To delete an existing text box or image, just click the item you\'d like to delete. Once the toolbox appears, click "remove" in the lower right-hand corner of the toolbar.')).append($("<li />").html("Using the toolbar on the left-hand side you can: Add Text, Add An Image &amp; Under/Redo changes that you've made or reset back to the original template.")))).append($("<div />").css({float:"right",width:"50%",padding:"5px"}).append($("<div />").css({color:"#000000","font-size":"16px","font-weight":"bold"}).html("Need Recipient Addressing?")).append($("<ol />").css("margin-bottom","0px").append($("<li />").html("Save the customization you add to this template and close the designer.")).append($("<li />").html('On the product page, select "recipient addressing". This can be done before or after you customize a template, or as a stand-alone service.')))))).append(t).append($("<div />").addClass("texel_designer")).append($("<div/>").addClass("texelbtn saveClose").html("Save & Close").on("click",function(){a.closeTexelPopupContainers(),a.element.addClass("hidden"),$("body").removeClass("texelScrollRemoval"),"function"==typeof a._globalVars.exitFunction&&a._globalVars.exitFunction()}))).removeClass("hidden"),$(".jqs-texelTemplateHelp").on("click",function(){$(".jqs-texelHelpContainer").hasClass("hidden")?($(".jqs-texelTemplateHelp .jqs-texelHelpHeader > div:eq(1)").html('Hide Help <i class="fa fa-caret-up"></i>'),$(".jqs-texelHelpContainer").removeClass("hidden")):($(".jqs-texelTemplateHelp .jqs-texelHelpHeader > div:eq(1)").html('Show Help <i class="fa fa-caret-down"></i>'),$(".jqs-texelHelpContainer").addClass("hidden")),a.makeFullSize()}),this._setGlobalVars("designerEl",this.element.find(".texel_designer")),this.options.staticHeight=this._globalVars.templateHeight/this._globalVars.templateWidth*this.options.staticWidth,this.makeFullSize(),this._paintTexel(this.options.activeDesign,!0,null,!0),$.each(this._globalVars.designs,function(e,t){e!=a.options.activeDesign&&a._createHistory(e)}),$(".s7Element").each(function(){null!=$(this).attr("id").match(/\_\d+$/)&&a._globalVars.designs[a.options.activeDesign].customCount++}),a._globalVars.designs[0].customCount=a._globalVars.designs[0].elements.length,a._globalVars.designs[1].customCount=a._globalVars.designs[1].elements.length,a.options.initialLoad=!1},allowAddressing:function(e){e?$("#texAddAddressing").parent().show():$("#texAddAddressing").parent().hide()},makeFullSize:function(){var e=this;function t(){for(e.options.staticWidth=300,e.options.staticHeight=300;e.element.width()>e.options.staticWidth+250&&e.element.height()-$(".texelTemplateHelp").outerHeight()-20>e._globalVars.templateHeight/e._globalVars.templateWidth*(e.options.staticWidth+75);)e.options.staticWidth=e.options.staticWidth+50,e.options.staticHeight=e._globalVars.templateHeight/e._globalVars.templateWidth*e.options.staticWidth;e._globalVars.designerEl.animate({width:e.options.staticWidth,height:e.options.staticHeight},{duration:0,complete:function(){e._paintTexel(e.options.activeDesign,e.options.initialLoad,null,!0),0<$(".texelPopupContainer").length&&e._updateToolPosition($("#"+$(".texelPopupContainer").attr("data-targetedElementId"))),$(".texel_container .newTemplate").css("left",$(".texel_designer").offset().left-$(".texel_container").offset().left-96+"px"),$(".texel_container .saveClose").css("left",$(".texel_designer").offset().left-$(".texel_container").offset().left+$(".texel_designer").outerWidth()+10+"px"),$(".texel_container .texelToolbox").css({top:$(".texel_designer").offset().top-$(".texel_container").offset().top+"px",left:$(".texel_designer").offset().left-$(".texel_container").offset().left-90+"px"}),$(".texel_container .sides").css({top:$(".texel_designer").offset().top-$(".texel_container").offset().top+"px",left:$(".texel_designer").offset().left-$(".texel_container").offset().left+$(".texel_designer").outerWidth()+10+"px"})}})}t(),$(window).off("resize.texelSize").on("resize.texelSize",function(e){null!=e.target.toString().match(/window/i)&&waitForFinalEvent(function(){t()},250,"texelSize")})},destroy:function(){this.destroyTexel()},destroyTexel:function(){"function"==typeof this._globalVars.exitFunction&&this._globalVars.exitFunction(!1);var e=this.element.attr("id");delete this.element,$("#"+e).remove(),$("body").removeClass("texelScrollRemoval")},_processFXGXML:function(e){var a=this;null==e?($.each(a._globalVars.designs,function(e,t){a._globalVars.designs[e].s7XML=getFXGXML(a._globalVars.designs[e].templateId,!1),a._setGlobalVars("templateWidth",parseFloat($(a._globalVars.designs[e].s7XML).find("Graphic").attr("viewWidth"))),a._setGlobalVars("templateHeight",parseFloat($(a._globalVars.designs[e].s7XML).find("Graphic").attr("viewHeight")))}),this._getDesignColors(),this._getElements(null,null)):(this._getElements(getFXGXML(e,!0),null),this._paintTexel(null,!0,null,!0))},_adjustLayering:function(e,t){for(var a=this,i=[],o=0;o<a._globalVars.designs[a.options.activeDesign].elements.length;o++)"down"==t&&void 0!==a._globalVars.designs[a.options.activeDesign].elements[o+1]&&a._globalVars.designs[a.options.activeDesign].elements[o+1].id==e&&a._globalVars.designs[a.options.activeDesign].elements[o+1].custom&&a._globalVars.designs[a.options.activeDesign].elements[o].custom?(i.push(a._globalVars.designs[a.options.activeDesign].elements[o+1]),i.push(a._globalVars.designs[a.options.activeDesign].elements[o]),o++):"up"==t&&void 0!==a._globalVars.designs[a.options.activeDesign].elements[o+1]&&a._globalVars.designs[a.options.activeDesign].elements[o].id==e&&a._globalVars.designs[a.options.activeDesign].elements[o+1].custom&&a._globalVars.designs[a.options.activeDesign].elements[o].custom?(i.push(a._globalVars.designs[a.options.activeDesign].elements[o+1]),i.push(a._globalVars.designs[a.options.activeDesign].elements[o]),o++):i.push(a._globalVars.designs[a.options.activeDesign].elements[o]);a._globalVars.designs[a.options.activeDesign].elements=i,a._paintTexel(a.options.activeDesign,!0,null,!0),a._updateObjectTools("imageLayering")},_getActiveElementIndex:function(e){for(var t=0;t<this._globalVars.designs[this.options.activeDesign].elements.length;t++)if(this._globalVars.designs[this.options.activeDesign].elements[t].id==e)return t;return null},_updateObjectTools:function(e){var t=this,a=$(".texelPopupContainer").attr("data-targetedelementid"),i=t._getActiveElementIndex(a);"imageLayering"==e&&null!=i&&($(".texelPopupContainer").find('[data-target="imageLayering"][data-value="down"]').removeClass("texelToolDisabled"),$(".texelPopupContainer").find('[data-target="imageLayering"][data-value="up"]').removeClass("texelToolDisabled"),void 0!==t._globalVars.designs[t.options.activeDesign].elements[i-1]&&t._globalVars.designs[t.options.activeDesign].elements[i-1].custom||$(".texelPopupContainer").find('[data-target="imageLayering"][data-value="down"]').addClass("texelToolDisabled"),void 0!==t._globalVars.designs[t.options.activeDesign].elements[i+1]&&t._globalVars.designs[t.options.activeDesign].elements[i+1].custom||$(".texelPopupContainer").find('[data-target="imageLayering"][data-value="up"]').addClass("texelToolDisabled"))},paintTexel:function(e,t){var a=this;$.each(a._globalVars.designs,function(e){a._paintTexel(e,!1,null,t)}),a._cleanDesignObjectForStorage()},_paintTexel:function(o,e,n,t){var s=this;if(void 0!==o&&null!=o||(o=this.options.activeDesign),e&&s._createHistory(o),this._debug(null,null,"Painting Texel"),t){this._globalVars.designerEl.empty();for(var a=0;a<this._globalVars.designs[o].elements.length;a++){var i=this._globalVars.designs[o].elements[a];if(i.deleted)s._globalVars.designerEl.find("#"+i.id).remove();else{$.each(s._colors,function(e,t){if(t.hex==i.color)return t.name,!0}),"undefined"!=typeof productPage&&void 0!==s._globalVars.allowedColors[productPage.returnActiveProduct(!0).color]&&productPage.returnActiveProduct(!0).addAddressing&&!s._globalVars.allowedColors[productPage.returnActiveProduct(!0).color][""]&&(i.color="#FFFFFF"),s._setDesignBackgroundColor(i),s._createElementDom(i,a)}}}else null!=n&&$.each(n,function(e){for(var t=0;t<s._globalVars.designs[o].elements.length;t++){var a=s._globalVars.designs[o].elements[t];n[e]!=a.id||a.deleted?a.deleted&&s._globalVars.designerEl.find("#"+a.id).remove():s._createElementDom(a,t)}});this._makeElementsSelectable(),null!==n?$.each(n,function(e){void 0===s._globalVars.designerEl.find("#"+n[e]).data("ui-draggable")&&(s._makeElementsDraggable(n[e]),s._makeElementsResizable(n[e]))}):$.each(s._globalVars.designs[o].elements,function(e){void 0===s._globalVars.designerEl.find("#"+s._globalVars.designs[o].elements[e].id).data("ui-draggable")&&(s._makeElementsDraggable(s._globalVars.designs[o].elements[e].id),s._makeElementsResizable(s._globalVars.designs[o].elements[e].id))}),t||null==n?(s._globalVars.designerEl.texelLoader(!0),this._globalVars.s7ImageQueue.push({url:"https://texel.envelopes.com/getImage",type:"POST",timeout:1e4,data:this._generateQueryParams(o,null,!1,null,!1)},function(e,t,a){s._globalVars.designerEl.css({"background-image":"url(data:image/"+s.options.format+";base64,"+e.data+")","background-repeat":"no-repeat"}),s._globalVars.designerEl.texelLoader(!1)},function(e){},null),$.each(this._globalVars.designs[o].elements,function(i){s._globalVars.designs[o].elements[i].deleted||s._globalVars.designs[o].s7ElementQueue[s._globalVars.designs[o].elements[i].id].push({url:"https://texel.envelopes.com/getImage",type:"POST",timeout:1e4,data:s._generateQueryParams(o,s._globalVars.designs[o].elements[i].id,!1,null,!1)},function(e,t,a){s._globalVars.designs[o].elements[i].image=e.data,s._globalVars.designerEl.find("#"+s._globalVars.designs[o].elements[i].id).each(function(){s._createElementInnerDom(s._globalVars.designs[o].elements[i],$(this).find(".s7ElementImage")),null!=e.overflow&&-1!=e.overflow.indexOf(s._globalVars.designs[o].elements[i].id)?s._markOversetElements($(this),!0):s._markOversetElements($(this),!1)})},function(e){},null)})):null!=n&&$.each(n,function(l){s._globalVars.designerEl.find("#"+n[l]).texelLoader(!0),s._globalVars.designs[o].s7ElementQueue[n[l]].push({url:"https://texel.envelopes.com/getImage",type:"POST",timeout:1e4,data:s._generateQueryParams(o,n[l],!1,null,!1)},function(e,t,a){var i=$(s._globalVars.designerEl).find("#"+n[l]),o=i.data("Scene7Element");o.image=e.data,s._createElementInnerDom(o,i.find(".s7ElementImage")),s._globalVars.designerEl.find("#"+n[l]).texelLoader(!1),null!=e.overflow&&-1!=e.overflow.indexOf(o.id)?s._markOversetElements(i,!0):s._markOversetElements(i,!1)},function(e){},null)}),s._calculatePrintColors()},_setDesignBackgroundColor:function(e){"Path"==e.type&&e.id.toLowerCase()=="COLOR_bgcolor".toLowerCase()&&(e.color=e.pathData[0].color=this.options.backgroundColor,e.pathData[0].pathType="fill")},_createElementDom:function(t,e){if("Path"!=t.type||t.id.toLowerCase()!="COLOR_bgcolor".toLowerCase()){var a,i,o=this,l=this._getElementSize((t.lastCropWidth?t.width/t.imageAttrWidth*t.lastCropWidth:t.width)*t.scaleX),n=this._getElementSize((t.lastCropHeight?t.height/t.imageAttrHeight*t.lastCropHeight:t.height)*t.scaleY),s=this._getElementSize(this._calculateRotatedDimensions(t).width),r=this._getElementSize(this._calculateRotatedDimensions(t).height),d=this._normalizeRotation(t.rotation);i=(r-n)*Math.abs(r/n)/2,a=(s-l)/2;var c={width:l,height:n,left:Math.round(this._getElementSize(t.parentX+t.x)+(d%90!=0?0<d&&d<180?-a:a:0)),top:Math.round(this._getElementSize(t.parentY+t.y)-(d%90!=0?0<d&&d<180?-i:i:0)),"outline-color":"rgba(5,167,229,"+(this.options.showElements&&t.editable?".5":"0")+")","outline-width":this._globalVars.elementBorder+"px","outline-style":"dashed",transform:"rotate("+d+"deg)",zIndex:e},g=this._globalVars.designerEl.find("#"+t.id);if(0==g.length){switch(g=$("<div/>").attr({id:t.id,"group-id":null!=t.groupId?t.groupId:""}).addClass(t.editable?"s7Element":"noEdit").addClass(t.type).css(c),t.id==t.groupId&&t.isVariable&&o._createAddressBrowser(t,g,this.options.activeDesign),o._globalVars.designerEl.append(g),g.data("Scene7Element",t),t.type){case"RichText":g.on("click",function(e){o.createTextPopup(t,g),o._updateToolPosition(g)});break;case"BitmapImage":g.on("click",function(e){o.createImagePopup(t,g),o._updateToolPosition(g)});break;case"Path":g.on("click",function(e){o.createPathPopup(t,g),o._updateToolPosition(g)})}g.append(o._createElementInnerDom(t,null))}else g.css(c),o._createElementInnerDom(t,g.find(".s7ElementImage"));o._updateToolPosition($("#"+t.id))}},_createElementInnerDom:function(e,t){var a=this._getElementSize(this._calculateRotatedDimensions(e).width),i=this._getElementSize(this._calculateRotatedDimensions(e).height),o=this._normalizeRotation(e.rotation),l=this._globalVars.designerEl.offset().left-this.element.find("#"+e.id).offset().left,n=this._globalVars.designerEl.offset().top-this.element.find("#"+e.id).offset().top,s=0,r=0,d=this._getElementSize(this._calculateRotatedDimensions(e).width),c=this._getElementSize(this._calculateRotatedDimensions(e).height),g=(d-this._getElementSize(e.width*e.scaleX))/2,h=(c-this._getElementSize(e.height*e.scaleY))*Math.abs(c/this._getElementSize(e.height*e.scaleY))/2;90!=o&&270!=o||(s=-(a-i)/2,r=(a-i)/2);var p={position:"absolute",width:a,height:i,transform:"rotate("+-1*o+"deg)","background-image":"url(data:image/"+this.options.format+";base64,"+(null!=e.image?e.image:"iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNgYAAAAAMAASsJTYQAAAAASUVORK5CYII=")+")","background-repeat":"no-repeat","background-position":Math.round(l+(o%90!=0?0<o&&o<180?-g:g:0))+"px "+Math.round(n-(o%90!=0?0<o&&o<180?-h:h:0))+"px",left:s-(o%90!=0?g<h?g:h:0)+"px",top:r-(o%90!=0?g<h?g:h:0)+"px"};if(null==t)return $("<div/>").addClass("s7ElementImage").css(p);t.css(p)},_markOversetElements:function(e,t){if(t){var a=$("<div/>").addClass("jqs-oversetWarning oversetWarning");e.append(a),killTexelToolTip=function(){$(".texelToolTip").fadeOut(500,function(){$(this).remove()})},a.on("mouseenter",function(){if(0==a.find(".texelToolTip").length){$(".texelToolTip").remove();var e=$("<div />").addClass("texelToolTip").append($("<p />").html("Your text box is too small for the entered text, please increase the text box size."));a.append(e),e.css({top:-e.height()-10,left:-e.width()/2+a.width()/4})}else clearTimeout(texelWarningThread)}).on("mouseleave",function(){texelWarningThread=window.setTimeout(killTexelToolTip,1e3)})}else e.find(".jqs-oversetWarning").remove()},_makeElementsSelectable:function(){var a=this;this._globalVars.designerEl.hasClass("ui-selectable")&&this._globalVars.designerEl.selectable("destroy"),this._globalVars.designerEl.selectable({filter:"div.s7Element"}),$(window).off("keydown.texel").on("keydown.texel",function(e){if((17==e.keyCode||isCommandKey(e.keyCode))&&a._globalVars.designerEl.find("div.s7Element").draggable("disable"),46==e.keyCode&&"TEXTAREA"!=document.activeElement.tagName&&"INPUT"!=document.activeElement.tagName){var t=!1;a._globalVars.designerEl.find(".ui-selected").each(function(){$(this).data("Scene7Element").deleted=!0,""!=$(this).attr("group-id")&&$.each($("[group-id="+$(this).attr("group-id")+"]"),function(){$(this).data("Scene7Element").deleted=!0}),t=!0}),t&&a._paintTexel(a.options.activeDesign,!0,null,!0)}}).off("keyup.texel").on("keyup.texel",function(e){(17==e.keyCode||isCommandKey(e.keyCode))&&a._globalVars.designerEl.find("div.s7Element").draggable("enable")})},_makeElementsDraggable:function(e){var l=this;this._globalVars.designerEl.find(null!=e?"#"+e+":not(.noEdit)":"div.s7Element").draggable({containment:"document",cursor:"move",snap:!0,snapTolerance:5,scroll:!1,distance:10,start:function(e,t){$(this).is(".ui-selected")||$(".ui-selected").removeClass("ui-selected"),""!=$(this).attr("group-id")&&$("[group-id="+$(this).attr("group-id")+"]:not(.ui-selected)").each(function(){$(this).addClass("ui-selected")}),$(this).data("_paintTexel",l._isElementOverflown($(this))),l._globalVars.selectedElements=l._globalVars.designerEl.find(".ui-selected").each(function(){$(this).data("offset",$(this).offset()),$(this).data("_paintTexel",l._isElementOverflown($(this)))}),l._globalVars.selectedOffset=$(this).offset()},drag:function(e,t){var a=l._showAlignmentGrid(l.options.activeDesign,$(this));-3<=a&&a<=3&&(t.position.left=t.position.left+a);var i=t.position.top-l._globalVars.selectedOffset.top,o=t.position.left-l._globalVars.selectedOffset.left;l._globalVars.selectedElements.not(this).each(function(){$(this).css({top:$(this).data("offset").top+i,left:$(this).data("offset").left+o})}),l._updateToolPosition($(this))},stop:function(e,t){l._updateDragSettings($(this),$(this).data("Scene7Element")),l._globalVars.selectedElements.not(this).each(function(){l._updateDragSettings($(this),$(this).data("Scene7Element")),l._paintTexel(l.options.activeDesign,!0,[$(this).data("Scene7Element").id],!1)}),l._createHistory(),l._paintTexel(l.options.activeDesign,!1,[$(this).data("Scene7Element").id],!1),l._globalVars.designerEl.find("#verCenterLine").remove(),l._globalVars.designerEl.find("#verLeftLine").remove(),l._globalVars.designerEl.find("#verRightLine").remove(),$(e.toElement).one("click",function(e){e.stopImmediatePropagation()})}})},_updateDragSettings:function(e,t){var a=this._getOriginalSize(parseFloat(e.css("left")))-t.parentX,i=this._getOriginalSize(parseFloat(e.css("top")))-t.parentY;90==t.originalRotation&&(a+=this._getOriginalSize(parseFloat(e.css("width")))),270==t.originalRotation&&(i+=this._getOriginalSize(parseFloat(e.css("height")))),t.x=a,t.y=i,t.changed=!0,this._updateToolPosition(e)},_makeElementsResizable:function(e){var i=this,t={se:".ui-resizable-se",nw:".ui-resizable-nw"};this._globalVars.designerEl.find(null!=e?"#"+e+":not(.noEdit)":"div.s7Element").each(function(){var a=$(this);$.each(t,function(e,t){a.append($("<div/>").addClass("ui-resizable-handle ui-resizable-"+e))})});var o=function(e,t,a){e.find(".ui-resizable-n, .ui-resizable-s").css("left",t/2-4+"px"),e.find(".ui-resizable-e, .ui-resizable-w").css("top",a/2-4+"px")};this._globalVars.designerEl.find(null!=e?"#"+e:"div.s7Element").each(function(){var a=$(this);a.resizable({containment:"document",alsoResize:$("div.s7Element"),delay:150,autoHide:!0,handles:t,aspectRatio:"Path"==a.data("Scene7Element").type||"BitmapImage"==a.data("Scene7Element").type,create:function(e,t){o(a,$(e.target).css("width"),$(e.target).css("height"))},start:function(e,t){i._globalVars.selectedElements=$(".ui-selected").each(function(){$(this).data("offset",$(this).offset())}),0<i._globalVars.selectedElements.length?$(this).resizable("option","alsoResize",i._globalVars.selectedElements.not(this)):$(this).resizable("option","alsoResize","")},resize:function(e,t){o(a,$(e.target).css("width"),$(e.target).css("height"))},stop:function(e,t){i._updateSizeSettings(a),i._globalVars.selectedElements.not(this).each(function(){i._updateSizeSettings($(this)),o($(this),$(this).width(),$(this).height()),i._paintTexel(i.options.activeDesign,!0,[$(this).data("Scene7Element").id],!1)}),i._paintTexel(i.options.activeDesign,!0,[$(this).data("Scene7Element").id],!1)}})})},_updateSizeSettings:function(e){var t=e.data("Scene7Element"),a=this._getOriginalSize(parseFloat(e.css("left")))-t.parentX,i=this._getOriginalSize(parseFloat(e.css("top")))-t.parentY,o=t.width*(parseFloat(e.css("width"))/(this._getElementSize(t.width)*t.scaleX)),l=t.height*(parseFloat(e.css("height"))/(this._getElementSize(t.height)*t.scaleY)),n=t.scaleX*(parseFloat(e.css("width"))/(this._getElementSize(t.width)*t.scaleX)),s=t.scaleY*(parseFloat(e.css("height"))/(this._getElementSize(t.height)*t.scaleY));if(90==e.originalRotation)a+=o;else if(270==e.originalRotation){i+=l;var r=o;o=l,l=r;var d=n;n=s,s=d}t.x=a,t.y=i,t.scaleX=n,t.scaleY=s,"BitmapImage"==t.type&&(t.lastCropWidth=t.width,t.lastCropHeight=t.height),t.changed=!0},_getElements:function(e,t){var a=this;void 0!==t&&null!=t||(t=this.options.activeDesign),null==e?$.each(a._globalVars.designs,function(t,e){void 0!==a._globalVars.designs[t].elements&&0<a._globalVars.designs[t].elements.length?($.each(a._globalVars.designs[t].elements,function(e){a._globalVars.designs[t].elements[e]=a._processXMLElements(null,t,!1,a._globalVars.designs[t].elements[e])}),$.each(a._globalVars.designs[t].hiddenElements,function(e){a._globalVars.designs[t].hiddenElements[e]=a._processXMLElements(null,t,!1,a._globalVars.designs[t].hiddenElements[e])})):$(a._globalVars.designs[t].s7XML).find("RichText, Path, BitmapImage, Rect").each(function(e){a._processXMLElements($(this),t,!1,null)})}):$(e).find("RichText, Path, BitmapImage, Rect").each(function(e){a._processXMLElements($(this),t,!0,null)})},_processXMLElements:function(e,t,a,i){if(null!=i){var o=null;for(var l in"RichText"==i.type?o=new Scene7RichText(i.id,i.type):"BitmapImage"==i.type?o=new Scene7Bitmap(i.id,i.type):"Path"==i.type&&(o=new Scene7Path(i.id,i.type)),i)i.hasOwnProperty(l)&&(o[l]=i[l]);return this._globalVars.designs[t].s7ElementQueue[i.id]=new AjaxQueue(!0,3,!0),i.custom||(this._globalVars.designs[t].lastElement={id:i.id,type:i.type}),o}if(a&&e.attr("s7:elementID","UGC_"+this._globalVars.designs[t].customCount++),void 0!==e.attr("s7:elementID")){var n=e.attr("s7:elementID"),s=e.prop("nodeName");a||(this._globalVars.designs[t].lastElement={id:n,type:s}),this._isElementVisible(t,n)?"RichText"===s?this._globalVars.designs[t].elements.push(this._createRichText(e,a)):"BitmapImage"===s?this._globalVars.designs[t].elements.push(this._createBitmapImage(e,a)):"Path"===s&&this._globalVars.designs[t].elements.push(this._createPath(e,a)):"RichText"===s?this._globalVars.designs[t].hiddenElements.push(this._createRichText(e,a)):"BitmapImage"===s?this._globalVars.designs[t].hiddenElements.push(this._createBitmapImage(e,a)):"Path"===s&&this._globalVars.designs[t].hiddenElements.push(this._createPath(e,a)),this._globalVars.designs[t].s7ElementQueue[n]=new AjaxQueue(!0,3,!0)}},_isColorAllowed:function(e,t){return 50<Math.abs(this._getColorContrast(e)-this._getColorContrast(t))},_getColorContrast:function(e){return e=e.replace("#",""),(299*parseInt(e.substr(0,2),16)+587*parseInt(e.substr(2,2),16)+114*parseInt(e.substr(4,2),16))/1e3},_getAllowedBaseColor:function(e,t){return void 0!==t&&t?e:128<=this._getColorContrast(e)?"#000000":"#ffffff"},_createRichText:function(e,t){void 0===t&&(t=!1);var a,i=this,o=new Scene7RichText(e.attr("s7:elementID"),e.prop("nodeName"));o.parentX=void 0!==e.parent().attr("x")?parseFloat(e.parent().attr("x")):0,o.parentY=void 0!==e.parent().attr("y")?parseFloat(e.parent().attr("y")):0,o.x=void 0!==e.attr("x")?parseFloat(e.attr("x")):0,o.y=void 0!==e.attr("y")?parseFloat(e.attr("y")):0,o.width=void 0!==e.attr("width")?parseFloat(e.attr("width")):1,o.height=void 0!==e.attr("height")?parseFloat(e.attr("height")):1,o.scaleX=void 0!==e.attr("scaleX")?parseFloat(e.attr("scaleX")):1,o.scaleY=void 0!==e.attr("scaleY")?parseFloat(e.attr("scaleY")):1,e.find("content>p>span").each(function(){a=void 0===a?$(this).text():a+"<br />"+$(this).text()}),o.text=charEncodingForUser(replaceBreakLines(a)),o.tracking=void 0!==e.attr("trackingRight")?e.attr("trackingRight").replace("%",""):0,o.rotation=void 0!==e.attr("rotation")?parseFloat(e.attr("rotation")):0,o.originalRotation=void 0!==e.attr("rotation")?parseFloat(e.attr("rotation")):0,o.textAlign=void 0!==e.attr("textAlign")?e.attr("textAlign"):"left",o.lineHeight=void 0!==e.attr("lineHeight")?parseInt(e.attr("lineHeight")):12;var l=void 0!==this._getColor(e)?this._getColor(e):"#000000";if(void 0!==i._globalVars.allowedColors[i.options.colorName])for(var n in i._globalVars.allowedColors[i.options.colorName])if(i._globalVars.allowedColors[i.options.colorName].hasOwnProperty(n)&&i._globalVars.allowedColors[i.options.colorName][n]&&"Custom"!=n){for(var s=0;s<i._colors.length;s++)if(n==i._colors[s].name){l=i._colors[s].hex;break}break}return o.color=i._isColorAllowed(i.options.backgroundColor,l)?l:i._getAllowedBaseColor(l,null!=o.id.match(/^text_ko/i)),o.fontFamily=function(e){for(var t=void 0!==e.attr("fontFamily")?e.attr("fontFamily"):"Minion Pro",a=0;a<i._fonts.length;a++)i._fonts[a]==t+" Bold"&&(t+=" Bold");return t}(e),o.fontSize=void 0!==e.attr("fontSize")?parseInt(e.attr("fontSize")):12,o.fontWeight=void 0!==e.attr("fontWeight")?e.attr("fontWeight"):"",o.textDecoration=void 0!==e.attr("textDecoration")?e.attr("textDecoration"):"",o.fitToSize=!1,o.custom=t,o.editable=this._isElementEditable(null,e.attr("s7:elementID")),o},_createBitmapImage:function(e,t){void 0===t&&(t=!1);var a=new Scene7Bitmap(e.attr("s7:elementID"),e.prop("nodeName"));a.parentX=void 0!==e.parent().attr("x")?parseFloat(e.parent().attr("x")):0,a.parentY=void 0!==e.parent().attr("y")?parseFloat(e.parent().attr("y")):0,a.x=void 0!==e.attr("x")?parseFloat(e.attr("x")):0,a.y=void 0!==e.attr("y")?parseFloat(e.attr("y")):0,a.scaleX=void 0!==e.attr("scaleX")?parseFloat(e.attr("scaleX")):1,a.scaleY=void 0!==e.attr("scaleY")?parseFloat(e.attr("scaleY")):1,a.width=void 0!==e.attr("width")?parseFloat(e.attr("width")):1,a.height=void 0!==e.attr("height")?parseFloat(e.attr("height")):1,a.cropStartX=0,a.cropStartY=0,a.leftCropAmt=0,a.topCropAmt=0,a.rightCropAmt=0,a.bottomCropAmt=0,a.rotation=void 0!==e.attr("rotation")?parseFloat(e.attr("rotation")):0;var i=e.attr("source").match(/.*@Embed\((?:.*\/.*\/(.*)\.[a-z]{3,4})|.*@Embed\('is\(ActionEnvelope\/(.*)\)'/);a.url="ActionEnvelope/"+i[1]||i[2],a.custom=t,a.editable=this._isElementEditable(null,e.attr("s7:elementID"));var o=this._getImageAttr("http://actionenvelopew2p.scene7.com/is/image/"+a.url);return a.imageAttrWidth=parseFloat(o.width),a.imageAttrHeight=parseFloat(o.height),a.cropWidth=parseFloat(a.imageAttrWidth),a.cropHeight=parseFloat(a.imageAttrHeight),a.lastCropWidth=a.cropWidth,a.lastCropHeight=a.cropHeight,a},_createPath:function(e,t){void 0===t&&(t=!1);var n=this,s=new Scene7Path(e.attr("s7:elementID"),e.prop("nodeName"));s.parentX=void 0!==e.parent().attr("x")?parseFloat(e.parent().attr("x")):0,s.parentY=void 0!==e.parent().attr("y")?parseFloat(e.parent().attr("y")):0,s.x=void 0!==e.attr("x")?parseFloat(e.attr("x")):0,s.y=void 0!==e.attr("y")?parseFloat(e.attr("y")):0,s.rotation=void 0!==e.attr("rotation")?parseFloat(e.attr("rotation")):0,s.originalRotation=void 0!==e.attr("rotation")?parseFloat(e.attr("rotation")):0,s.scaleX=void 0!==e.attr("scaleX")?parseFloat(e.attr("scaleX")):1,s.scaleY=void 0!==e.attr("scaleY")?parseFloat(e.attr("scaleY")):1,s.data=e.attr("data");var r=1;$.each(e.children(),function(e){var t="#FFFFFF",a=this.tagName,i=1,o="miter",l="none";"stroke"==a?(s.color=t=n._getColor($(this)),void 0!==$($(this).children()[0]).attr("weight")&&(r=parseFloat($($(this).children()[0]).attr("weight"))),void 0!==$($(this).children()[0]).attr("miterLimit")&&(i=$($(this).children()[0]).attr("miterLimit")),void 0!==$($(this).children()[0]).attr("caps")&&(l=$($(this).children()[0]).attr("caps")),void 0!==$($(this).children()[0]).attr("joints")&&(o=$($(this).children()[0]).attr("joints"))):"fill"==a&&(s.color=t=n._getColor($(this))),s.pathData.push({pathType:a,color:t,weight:r,miterLimit:i,joints:o,caps:l})});var a,i,o,l,d,c,g,h,p=(a=s.data,i=r,o=Number.MAX_VALUE,l=Number.MAX_VALUE,d=0-Number.MAX_VALUE,c=0-Number.MAX_VALUE,g=[],h=(a=(a=a.replace(/\s\s+/g," ")).replace(/(\r\n|\n|\r)/g," ")).match(/([A-Z]{1}(?:-*[0-9]+\.*[0-9]*e*-*[0-9]*(?:\s){0,1}){2,})Z*/g),$.each(h,function(){var e=this+"",t=e.charAt(0);if(e=(e=e.substring(1,e.length-1)).split(" "),"M"===t||"L"===t)for(var a=0;a<e.length;a+=2)g.push({x:e[a],y:e[a+1]});else if("C"===t)for(a=0;a<e.length;a+=6)g.push({x:e[a],y:e[a+5]})}),$.each(g,function(){this.x=parseFloat(this.x),this.y=parseFloat(this.y),this.x>d&&(d=this.x),this.x<o&&(o=this.x),this.y>c&&(c=this.y),this.y<l&&(l=this.y)}),{w:d-o+i,h:c-l+i});return s.width=p.w,s.height=p.h,s.editable=this._isElementEditable(null,e.attr("s7:elementID")),n._setDesignBackgroundColor(s),s},_getDesignColors:function(){var a=this;$.each(a._globalVars.designs,function(e,t){$(a._globalVars.designs[e].s7XML).find("s7\\:Color, Color").each(function(e){if("Black"===$(this).attr("colorName"))a._globalVars.colorMap.Black="#000000";else if("Paper"===$(this).attr("colorName"))a._globalVars.colorMap.Paper="#FFFFFF";else{var t=$(this).attr("colorName").match(/C=([0-9]+)\sM=([0-9]+)\sY=([0-9]+)\sK=([0-9]+)/);if(null!=t)return void(a._globalVars.colorMap[$(this).attr("colorName")]=cmykToHex(parseInt(t[1]),parseInt(t[2]),parseInt(t[3]),parseInt(t[4])));if(null!=(t=$(this).attr("colorName").match(/([0-9]+),([0-9]+),([0-9]+),([0-9]+)/)))return void(a._globalVars.colorMap[$(this).attr("colorName")]=cmykToHex(parseInt(t[1]),parseInt(t[2]),parseInt(t[3]),parseInt(t[4])));if(null!=(t=$(this).attr("colorName").match(/R=([0-9]+)\sG=([0-9]+)\sB=([0-9]+)/)))return void(a._globalVars.colorMap[$(this).attr("colorName")]=rgbToHex(parseInt(t[1]),parseInt(t[2]),parseInt(t[3])))}})})},_getColor:function(e){return void 0!==e.find("SolidColorStroke").first().attr("s7:colorName")&&"KEYLINE"==e.find("SolidColorStroke").first().attr("s7:colorName")?"KEYLINE":void 0!==e.find("SolidColor").first().attr("s7:colorName")&&"KEYLINE"==e.find("SolidColor").first().attr("s7:colorName")?"KEYLINE":void 0!==e.attr("color")?makeFullHex(e.attr("color")):void 0!==e.attr("s7:colorName")&&""!=e.attr("s7:colorName")?this._globalVars.colorMap[e.attr("s7:colorName")]:void 0!==e.attr("s7:colorValue")&&""!=e.attr("s7:colorValue")?7<e.attr("s7:colorValue").length?this._globalVars.colorMap[e.attr("s7:colorValue").substring(0,7)]:this._globalVars.colorMap[e.attr("s7:colorValue")]:void 0!==e.find("SolidColorStroke").first().attr("color")?makeFullHex(e.find("SolidColorStroke").first().attr("color")):void 0!==e.find("SolidColorStroke").first().attr("s7:colorName")&&""!=e.find("SolidColorStroke").first().attr("s7:colorName")?this._globalVars.colorMap[e.find("SolidColorStroke").first().attr("s7:colorName")]:void 0!==e.find("SolidColorStroke").first().attr("s7:colorValue")&&""!=e.find("SolidColorStroke").first().attr("s7:colorValue")?7<e.find("SolidColorStroke").first().attr("s7:colorValue").length?makeFullHex(e.find("SolidColorStroke").first().attr("s7:colorValue").substring(0,7)):makeFullHex(e.find("SolidColorStroke").first().attr("s7:colorValue")):void 0!==e.find("SolidColor").first().attr("color")?makeFullHex(e.find("SolidColor").first().attr("color")):void 0!==e.find("SolidColor").first().attr("s7:colorName")&&""!=e.find("SolidColor").first().attr("s7:colorName")?this._globalVars.colorMap[e.find("SolidColor").first().attr("s7:colorName")]:void 0!==e.find("SolidColor").first().attr("s7:colorValue")&&""!=e.find("SolidColor").first().attr("s7:colorValue")?7<e.find("SolidColor").first().attr("s7:colorValue").length?makeFullHex(e.find("SolidColor").first().attr("s7:colorValue").substring(0,7)):makeFullHex(e.find("SolidColor").first().attr("s7:colorValue")):void 0},_isElementVisible:function(e,t){return("BLANK"!=this._globalVars.designs[e].templateType||-1!=t.indexOf("COLOR_bgcolor")||-1!=t.indexOf("noedit_"))&&(-1==t.indexOf("_logo_left")&&(-1==t.indexOf("COLOR_reply_border")&&(-1==t.indexOf("TEXT_reply_stamp_mark")&&(-1==t.indexOf("_logo_top")&&(("FRONT"!==this._globalVars.designs[e].templateSide||"REPLY"!==this._globalVars.designs[e].templateType||-1==t.indexOf("_return_"))&&("FRONT"!==this._globalVars.designs[e].templateSide||"RETURN"!==this._globalVars.designs[e].templateType||-1==t.indexOf("_reply_")))))))},_isElementEditable:function(e,t){return-1==t.indexOf("noedit_")},_generateQueryParams:function(e,t,a,i,o){void 0===a&&(a=!1);void 0===e&&(e=this.options.activeDesign);var l={};l.url="http://actionenvelopew2p.scene7.com/is/agm/ActionEnvelope/"+this._globalVars.designs[e].templateId,l.fmt=this.options.format,l.qlt=this.options.quality,l.wid=null!=i?i:this.options.staticWidth;for(var n=0;n<this._globalVars.designs[e].elements.length;n++){var g=this._globalVars.designs[e].elements[n];if(g.editable){if(null==t||null!=t&&t!=g.id)if(a);else if(null!=t||g.id.toLowerCase()!="COLOR_bgcolor".toLowerCase()){l["setAttr."+g.id]="{visible=false}";continue}if(g.deleted)g.custom||(l["setAttr."+g.id]="{visible=false}");else{var s=0,r=0;if(g.custom){var d=this._getObjParentOffsetByName(this._globalVars.designs[e].lastElement.id,this._globalVars.designs[e]);s=d.x,r=d.y}if("Path"===g.type){var c="";$.each(g.pathData,function(e){"fill"===g.pathData[e].pathType?c+='<fill><SolidColor color="'+g.color+'"/></fill>':"stroke"===g.pathData[e].pathType&&(c+='<stroke><SolidColorStroke color="'+g.color+'" joints="'+g.pathData[e].joints+'" caps="'+g.pathData[e].caps+'" miterLimit="'+g.pathData[e].miterLimit+'" weight="'+g.pathData[e].weight+'"/></stroke>')}),l["setElement."+g.id]=encodeURIComponent(c);var h="{x="+g.x+"%26y="+g.y+"%26scaleX="+g.scaleX+"%26scaleY="+g.scaleY+"%26rotation="+g.rotation+"}";l["setAttr."+g.id]=h}else if("RichText"===g.type){var p=0,u="";u+="<content>",$.each(replaceBreakLines(g.text).split("\n"),function(e,t){var a,i,o,l,n,s,r,d,c;0,t.length>p&&(p=t.length),u+=(a=charEncodingForScene7(t),i=g.fontSize,o=g.textAlign,l=g.textDecoration,g.fontWeight,n=g.fontFamily,s=g.lineHeight,r=g.tracking,d=g.color,c="<p ",c+=' fontSize="'+i+'"',c+=' s7:maxFontSize="'+i+'"',c+=' textAlign="'+o+'"',c+=' textDecoration="'+l+'"',c+=' fontFamily="'+n+'"',c+=' lineHeight="'+s+'"',c+=' trackingRight="'+r+'%25"',c+=' color="'+d+'"',c+=">",c+="<span>"+a+"</span></p>")}),u+="</content>";var m=this._normalizeRotation(g.rotation-g.originalRotation);if(""!=g.fontWeight&&(l["deleteAttr."+g.id]="(fontWeight)"),g.custom){c="<RichText";c+=' s7:elementID="'+g.id+'" ',c+=' rotation="'+m+'" ',c+=' x="'+(g.width*g.scaleX/2+g.x-s)+'" ',c+=' y="'+(g.height*g.scaleY/2+g.y-r)+'" ',c+=' width="'+g.width*g.scaleX+'" ',c+=' height="'+g.height*g.scaleY+'" ',c+=' s7:referencePoint="center" ',c+=">"+(g.isVariable&&o?"":u)+"</RichText>",void 0===l["insertAfter."+this._globalVars.designs[e].lastElement.id]?l["insertAfter."+this._globalVars.designs[e].lastElement.id]=[encodeURIComponent(c)]:l["insertAfter."+this._globalVars.designs[e].lastElement.id].unshift(encodeURIComponent(c))}else{l["setElement."+g.id]=encodeURIComponent(u);h="{x="+(g.width*g.scaleX/2+g.x)+"%26y="+(g.height*g.scaleY/2+g.y)+"%26width="+g.width*g.scaleX+"%26height="+g.height*g.scaleY+"%26rotation="+g.rotation+"%26typographicCase=lowercase%26s7:referencePoint=center}";l["setAttr."+g.id]=h}}else if("BitmapImage"===g.type){if(g.custom){var v="crop="+Math.round(g.cropStartX)+","+Math.round(g.cropStartY)+","+Math.round(g.cropWidth)+","+Math.round(g.cropHeight),f="";f=-1!=g.url.indexOf("fxg")?"source=@Embed('"+g.url+"')%26s7:fit=stretch":"source=@Embed('is("+g.url+"?"+v+")')%26s7:fit=stretch";c="<Group";c+=' x="'+(g.x+((g.lastCropWidth?g.lastCropWidth*g.scaleX:g.width)-g.width)/2+g.width-(this._getObjParentOffsetByName(this._globalVars.designs[e].lastElement.id,this._globalVars.designs[e]).x+g.width/2))+'" ',c+=' y="'+(g.y+((g.lastCropWidth?g.lastCropHeight*g.scaleY:g.height)-g.height)/2+g.height-(this._getObjParentOffsetByName(this._globalVars.designs[e].lastElement.id,this._globalVars.designs[e]).y+g.height/2))+'" ',c+=' s7:referencePoint="inherit"><BitmapImage',c+=' s7:elementID="'+g.id+'" ',c+=' scaleX="'+g.scaleX+'" ',c+=' scaleY="'+g.scaleY+'" ',c+=' s7:referencePoint="center" ',c+=' s7:fillOverprint="false" ',c+=' s7:fillOverprintMode="true" ',c+=' s7:fit="stretch"',c+=' s7:strokeOverprint="false" ',c+=' s7:strokeOverprintMode="true" ',c+=' rotation="'+g.rotation+'" ',c+=' width="'+(g.changed?g.lastCropWidth:g.width)+'" ',c+=' height="'+(g.changed?g.lastCropHeight:g.height)+'" ',c+=' source="'+f.replace(/%26/g,"%26amp;").replace("source=","")+'" ',c+="/></Group>",void 0===l["insertAfter."+this._globalVars.designs[e].lastElement.id]?l["insertAfter."+this._globalVars.designs[e].lastElement.id]=[encodeURIComponent(c)]:l["insertAfter."+this._globalVars.designs[e].lastElement.id].unshift(encodeURIComponent(c))}else{h="{x="+(g.width/2+g.x+((g.lastCropWidth?g.width/g.imageAttrWidth*g.lastCropWidth*g.scaleX:g.width)-g.width)/2)+"%26y="+(g.height/2+g.y+((g.lastCropHeight?g.height/g.imageAttrHeight*g.lastCropHeight*g.scaleY:g.height)-g.height)/2)+"%26width="+(g.changed?g.width/g.imageAttrWidth*g.lastCropWidth:g.width)+"%26height="+(g.changed?g.height/g.imageAttrHeight*g.lastCropHeight:g.height)+"%26scaleX="+g.scaleX+"%26scaleY="+g.scaleY+"%26rotation="+g.rotation+"%26s7:referencePoint=center%26";-1!=g.url.indexOf("fxg")?h+="source=@Embed('"+g.url+"')%26s7:fit=stretch}":h+="source=@Embed('is("+g.url+"?crop="+Math.round(g.cropStartX)+","+Math.round(g.cropStartY)+","+Math.round(g.cropWidth)+","+Math.round(g.cropHeight)+")')%26s7:fit=stretch}",l["setAttr."+g.id]=h}}}}}for(n=0;n<this._globalVars.designs[e].hiddenElements.length;n++){l["setAttr."+this._globalVars.designs[e].hiddenElements[n].id]="{visible=false}"}return l["setAttr.rootElement"]="{viewWidth="+this._globalVars.templateWidth+"%26viewHeight="+this._globalVars.templateHeight+"}",l},_generateUrlFromParams:function(e){var t=e.url;return delete e.url,t+"?"+this._makeStringFromParam(e)},_makeStringFromParam:function(e){var i="",t="";return $.each(e,function(a,e){0<i.length&&(i+="&"),"url"===a?t=e+"?":e instanceof Array?$.each(e,function(e,t){0!==e&&(i+="&"),i+=a+"="+t}):i+=a+"="+e}),t+i},_getScaleMultiplier:function(){return"landscape"===this.options.orientation?this.options.staticWidth/this._globalVars.templateHeight:this.options.staticWidth/this._globalVars.templateWidth},_getElementSize:function(e){return e*this._getScaleMultiplier()},_getOriginalSize:function(e){return e/this._getScaleMultiplier()},_rotateTexel:function(){var e=this;if("landscape"===e.options.orientation){var t=e._globalVars.templateWidth;e._setGlobalVars("templateWidth",e._globalVars.templateHeight),e._setGlobalVars("templateHeight",t)}},_normalizeRotation:function(e){return e<0&&(e+=360),e%360},_createHistory:function(e){void 0===e&&(e=this.options.activeDesign),this._debug(null,null,"Creating history point."),this._globalVars.designs[e].historyPosition+1<this._globalVars.designs[e].history.length&&this._globalVars.designs[e].history.splice(this._globalVars.designs[e].historyPosition+1);var t=this._clone(this._globalVars.designs[e]);delete t.history,delete t.historyPosition,delete t.s7ElementQueue,this._globalVars.designs[e].history.push(t),this._globalVars.designs[e].historyPosition=this._globalVars.designs[e].history.length-1,this.preview(e,75,this._globalVars.designerEl.parent().find(".sides .side_"+e+" img"),null),this._cleanDesignObjectForStorage()},_toggleElementVisibility:function(e,t){void 0===e&&(e=this.options.activeDesign),t?$(this._globalVars.designerEl).find("div.s7Element").css("outline-color","rgba(5,167,229,.5)"):$(this._globalVars.designerEl).find("div.s7Element").css("outline-color","rgba(5,167,229,0)")},_showAlignmentGrid:function(e,t){var a=this;void 0===e&&(e=this.options.activeDesign);var i=parseFloat(t.css("left")),o=parseFloat(t.css("left"))+parseFloat(t.css("width")),l=parseFloat(t.css("width"))/2+parseFloat(t.css("left")),n=parseFloat(a._globalVars.designerEl.css("width"))/2-l;if(-5<=n&&n<=5){if(0==a._globalVars.designerEl.find("#verCenterLine").length){var s=$("<div/>").attr("id","verCenterLine").css({"background-color":"rgba(5,167,229,0.5)",width:"1px",height:"100%",position:"absolute",left:"50%"});a._globalVars.designerEl.append(s)}}else a._globalVars.designerEl.find("#verCenterLine").remove();return t.siblings(".s7Element").each(function(){if(!$(this).hasClass("ui-selected")&&Math.abs(i-parseFloat($(this).css("left")))<=1){if(0==a._globalVars.designerEl.find("#verLeftLine").length){var e=$("<div/>").attr("id","verLeftLine").css({"background-color":"rgba(5,167,229,0.5)",width:"1px",height:"100%",position:"absolute",left:i});return a._globalVars.designerEl.append(e),!1}}else a._globalVars.designerEl.find("#verLeftLine").remove()}),t.siblings(".s7Element").each(function(){if(!$(this).hasClass("ui-selected")&&Math.abs(o-(parseFloat($(this).css("left"))+parseFloat($(this).css("width"))))<=1){if(0==a._globalVars.designerEl.find("#verRightLine:not(.ui-selected)").length){var e=$("<div/>").attr("id","verRightLine").css({"background-color":"rgba(5,167,229,0.5)",width:"1px",height:"100%",position:"absolute",left:o});return a._globalVars.designerEl.append(e),!1}}else a._globalVars.designerEl.find("#verRightLine").remove()}),n},_calculateRotatedDimensions:function(e){if(0==e.rotation)return{width:(e.lastCropWidth?e.width/e.imageAttrWidth*e.lastCropWidth:e.width)*e.scaleX,height:(e.lastCropHeight?e.height/e.imageAttrHeight*e.lastCropHeight:e.height)*e.scaleY};var t=.005555555555*e.rotation*Math.PI;t=t>.5*Math.PI&&t<1*Math.PI||t>1.5*Math.PI&&t<2*Math.PI?Math.PI-t:t;var a=Math.sin(t)*(e.lastCropHeight?e.height/e.imageAttrHeight*e.lastCropHeight:e.height)*e.scaleY+Math.cos(t)*(e.lastCropWidth?e.width/e.imageAttrWidth*e.lastCropWidth:e.width)*e.scaleX,i=Math.sin(t)*(e.lastCropWidth?e.width/e.imageAttrWidth*e.lastCropWidth:e.width)*e.scaleX+Math.cos(t)*(e.lastCropHeight?e.height/e.imageAttrHeight*e.lastCropHeight:e.height)*e.scaleY;return{width:Math.abs(a),height:Math.abs(i)}},undo:function(e,t){void 0!==e&&null!=e||(e=this.options.activeDesign),0<this._globalVars.designs[e].history.length&&0<this._globalVars.designs[e].historyPosition&&(t?this._globalVars.designs[e].historyPosition=0:this._globalVars.designs[e].historyPosition--,$.extend(this._globalVars.designs[e],this._clone(this._globalVars.designs[e].history[this._globalVars.designs[e].historyPosition])),this._paintTexel(e,!1,null,!0))},redo:function(e){void 0!==e&&null!=e||(e=this.options.activeDesign),0<this._globalVars.designs[e].history.length&&this._globalVars.designs[e].historyPosition+1<this._globalVars.designs[e].history.length&&(this._globalVars.designs[e].historyPosition++,$.extend(this._globalVars.designs[e],this._clone(this._globalVars.designs[e].history[this._globalVars.designs[e].historyPosition])),this._paintTexel(e,!1,null,!0))},zoom:function(e){if(void 0===e&&(e=50),0<e||e<0&&300<this.options.staticWidth){var t=e+this.options.staticWidth,a=this._globalVars.templateHeight/this._globalVars.templateWidth*t;this.element.width()>t&&this.element.height()>a&&this._setOption("staticWidth",t)}},preview:function(e,t,i,o){var l=this;void 0!==e&&null!=e||(e=this.options.activeDesign),$.ajax({url:"https://texel.envelopes.com/getImage",type:"POST",timeout:1e4,data:this._generateQueryParams(e,null,!0,t,!1),async:!0}).done(function(e,t,a){null!=i&&i.attr("src","data:image/"+l.options.format+";base64,"+e.data),"function"==typeof o&&o(e,l.options.format)}).fail(function(e){}).always(function(e,t,a){})},_updateVariableData:function(e,t,a){return null==e&&(e=a),e[0].width=void 0!==e[0].width&&e[0].width!=this._globalVars.templateWidth-10?e[0].width:this._globalVars.templateWidth-10,e[0].height=7*e[0].lineHeight,e[0].x=void 0!==e[0].x&&e[0].x!=(this._globalVars.templateWidth-(this._globalVars.templateWidth-10))/2?e[0].x:(this._globalVars.templateWidth-(this._globalVars.templateWidth-10))/2,e[0].y=void 0!==e[0].y&&e[0].y!=this._globalVars.templateHeight/2-e[0].lineHeight?e[0].y:this._globalVars.templateHeight/2-e[0].lineHeight,e[0].text=""!=t[0]?t[0]+"\n":"",e[0].text+=""!=t[1]?t[1]+"\n":"",e[0].text+=""!=t[2]?t[2]+"\n":"",e[0].text+=""!=t[3]?t[3]+"\n":"",e[0].text+=""!=t[4]?t[4]+", ":"",e[0].text+=""!=t[5]?t[5]+" ":"",e[0].text+=""!=t[6]?t[6]+"\n":"",e[0].text+=""!=t[7]?t[7]:"",e[0].text=e[0].text.replace(/\n[\s,]*\n/g,"\n"),e},_variableS7Obj:function(t){var a=[t];return this._globalVars.designerEl.find("[group-id="+t.groupId+"]").each(function(){var e=$(this).data("Scene7Element");e.id!=t.groupId&&a.push(e)}),a},_createAddressBrowser:function(t,e,a){var i=this;void 0!==a&&null!=a||(a=this.options.activeDesign);var o=function(t){var a=[];return $.each(t,function(e){a.push(t[e].id)}),a};e.append($("<div/>").addClass("addressRotator").append($("<div/>").addClass("addPrev").html("< Previous").on("click",function(){if(0<i._globalVars.designs[a].activeVariableData){var e=i._variableS7Obj(t);i._updateVariableData(e,i._globalVars.designs[a].variableData[--i._globalVars.designs[a].activeVariableData],null),i._paintTexel(i.options.activeDesign,!1,o(e),!1)}})).append($("<div/>").addClass("addNext").html("Next >").on("click",function(){if(i._globalVars.designs[a].activeVariableData<i._globalVars.designs[a].variableData.length-1){var e=i._variableS7Obj(t);i._updateVariableData(e,i._globalVars.designs[a].variableData[++i._globalVars.designs[a].activeVariableData],null),i._paintTexel(i.options.activeDesign,!1,o(e),!1)}})))},createAddressingGrid:function(e,t,a,i,o){var l=this;void 0===i||null==i?i=this.options.activeDesign:o?l._setOption("activeDesign",i):this.options.activeDesign=i;var n=$.extend({gridData:void 0!==e?e:[[]],sessionId:l._globalVars.sessionId,partyId:void 0===a||null==a?"":a,dataGroupId:null==l._globalVars.designs[i].addressBookId?-1:parseInt(l._globalVars.designs[i].addressBookId),onGridApply:function(e,t){l.options.activeDesign=i,l._globalVars.designs[i].addressBookId=t.dataGroupId+"",l._globalVars.designs[i].variableData=t.data,"undefined"!=typeof productPage&&productPage.updateAddressingButton(t.data.length),l.createCustomElement("RichText",i,void 0!==l._globalVars.product.getProduct?l._globalVars.product.getProduct().variableSettings:l.getProduct().variableSettings)},onGridClose:function(e,t){l.closeTexelPopupContainers(),l.element.addClass("hidden"),$("body").removeClass("texelScrollRemoval")},dataGroupMode:t},this.options.variableDataGridOptions||{});return $("#"+this.options.variableDataGridId).VariableDataGrid(n)},showGrid:function(e,t){null==t?$("#"+this.options.variableDataGridId).VariableDataGrid("showGrid",e):$("#"+this.options.variableDataGridId).VariableDataGrid("showGrid",e,t+1),this.closeTexelPopupContainers()},getVariableDataLength:function(e){return void 0!==e&&null!=e||(e=this.options.activeDesign),this._globalVars.designs[e].variableData.length},createCustomElement:function(e,t,a){var i=this,o=null!=a;if(o){var l=null;if($.each(i._globalVars.designs[t].elements,function(e){if(!i._globalVars.designs[t].elements[e].deleted&&i._globalVars.designs[t].elements[e].isVariable)return l=i._globalVars.designs[t].elements[e],!1}),null!=l){var n=i._variableS7Obj(l);return i._updateVariableData(n,i._globalVars.designs[t].variableData[i._globalVars.designs[t].activeVariableData],null),void i._paintTexel(t,!0,null,!0)}}i.closeTexelPopupContainers(),void 0!==t&&null!=t||(t=this.options.activeDesign);var s,r=e+"_"+(o?"addressing":this._globalVars.designs[t].customCount++);function d(e){i._globalVars.designs[t].s7ElementQueue[e]=new AjaxQueue(!0,3,!0),i._paintTexel(t,!0,[e],!1)}switch(e){case"RichText":var c=[{width:200,height:14,x:this._globalVars.templateWidth/2-100,y:this._globalVars.templateHeight/2-50,fontSize:12,lineHeight:14,textAlign:"left",trackingRight:2,fontFamily:"Minion Pro",text:"Enter your text here"}];function g(e){return $.parseXML('<Graphic xmlns="http://ns.adobe.com/fxg/2008" xmlns:s7="http://ns.adobe.com/S7FXG/2008"><RichText fontFamily="'+e.fontFamily+'" fontSize="'+e.fontSize+'" lineHeight="'+e.lineHeight+'" s7:colorName="Black" s7:colorValue="#ff" s7:colorspace="defined" s7:elementID="'+r+'" textAlign="'+e.textAlign+'" trackingRight="'+e.trackingRight+'%" width="'+e.width+'" height="'+e.height+'" x="'+e.x+'" y="'+e.y+'"><content><p><span>'+charEncodingForScene7(e.text)+"</span></p></content></RichText></Graphic>")}if(o){s=[{width:i._globalVars.templateWidth-10,x:(i._globalVars.templateWidth-(i._globalVars.templateWidth-10))/2,fontSize:30,lineHeight:32,textAlign:"center",trackingRight:2,fontFamily:"Bauderie Script SSi",text:"Enter your text here"}],$.extend(s[0],a[0],!0),c=i._updateVariableData(null,i._globalVars.designs[t].variableData[0],s);var h=this._createRichText($(g(c[0])).find("RichText"),!0);h.groupId=r,h.isVariable=!0,this._globalVars.designs[t].elements.push(h),d(r)}else this._globalVars.designs[t].elements.push(this._createRichText($(g(c[0])).find("RichText"),!0)),d(r);break;case"BitmapImage":;this._globalVars.designs[t].elements.push(this._createBitmapImage($($.parseXML('<Graphic xmlns="http://ns.adobe.com/fxg/2008" xmlns:s7="http://ns.adobe.com/S7FXG/2008"><Group s7:referencePoint="inherit" x="0" y="0"><BitmapImage width="400" height="200" s7:elementID="'+r+'" s7:fillOverprint="false" s7:fillOverprintMode="true" s7:fit="stretch" s7:referencePoint="center" s7:strokeOverprint="false" s7:strokeOverprintMode="true" scaleX=".5" scaleY=".5" source="@Embed(\'8001A.assets/images/image_library_icon.jpg\')"/></Group></Graphic>')).find("BitmapImage"),!0)),d(r)}$("#"+r).trigger("click")},closeTexelPopupContainers:function(){0<$(".texelPopupContainer").length&&($(".texelPopupContainer").remove(),"undefined"!=typeof texelEndCropping&&texelEndCropping(!1))},getFontList:function(e){var a=e.data("Scene7Element"),i="";return-1==this._fonts.indexOf(a.fontFamily)&&(i+='<div class="texelListItem texelSelectListSelected" data-value="'+a.fontFamily+'"><img src="/html/img/fonts/'+a.fontFamily.toLowerCase().replace(/\s/g,"")+'.png" /></div>'),$.each(this._fonts,function(e,t){i+='<div class="texelListItem'+(t===a.fontFamily?" texelSelectListSelected":"")+'" data-value="'+t+'"><img src="/html/img/fonts/'+t.toLowerCase().replace(/\s/g,"")+'.png" /></div>'}),i},getColorList:function(e){var a=this,i=e.data("Scene7Element"),o="",l="";return $.each(this._colors,function(e,t){if(null!=a._globalVars.product&&void 0!==a._globalVars.product.getProduct&&!a._globalVars.product.getProduct().hasWhiteInk&&"#ffffff"==t.hex)return!0;null!=a._globalVars.product&&void 0!==a._globalVars.product.getProduct&&void 0!==a._globalVars.product.getProduct().color&&void 0!==a._globalVars.allowedColors[a._globalVars.product.getProduct().color]?void 0!==a._globalVars.allowedColors[a._globalVars.product.getProduct().color][t.name]&&a._globalVars.allowedColors[a._globalVars.product.getProduct().color][t.name]&&(t.hex===i.color.toLowerCase()&&(l=i.color),o+='<div style="background-color: '+t.hex+';" class="texelListItem'+(t.hex===i.color.toLowerCase()?' texelSelectListSelected"':"")+'" data-value="'+t.hex+'">'+t.name+"</div>"):(a._isColorAllowed(a.options.backgroundColor,t.hex)||"#ffffff"==t.hex)&&(t.hex===i.color.toLowerCase()&&(l=i.color),o+='<div style="background-color: '+t.hex+';" class="texelListItem'+(t.hex===i.color.toLowerCase()?' texelSelectListSelected"':"")+'" data-value="'+t.hex+'">'+t.name+"</div>")}),""==l&&(o+='<div style="background-color: '+i.color+';" class="texelListItem texelSelectListSelected" data-value="'+i.color+'">'+i.color+"</div>"),o},createPathPopup:function(e,t){var a=this;a.closeTexelPopupContainers();var i='<div class="texelPopupContainer texelPathEditor" data-targetedElementId="'+e.id+'"><div class="texelDeleteButton">Remove <img src="/html/texel/img/delete.png" /></div><div class="texelCloseButton">X</div><div class="texelLeftPointer textAreaBackground"></div><div class="texelPopupRow noTopBorder"><div><div class="texelSelect pathColor" data-type="env-listParent" data-target="textEditor_color" data-value="color1"><div class="selectedColor" style="background-color: '+e.color+'"></div></div><div id="textEditor_color" class="texelSelectList jqs-scrollable" data-type="env-listChild"><h4>COLORS</h4>'+this.getColorList(t)+'</div></div></div><div class="texelPopupRow"><div><div class="texelRadio nudge" data-direction="left"><img src="/html/texel/img/nudgeLeft.png" /></div><div class="texelRadio nudge" data-direction="up"><img src="/html/texel/img/nudgeUp.png" /></div><div class="texelRadio nudge" data-direction="right"><img src="/html/texel/img/nudgeRight.png" /></div><div class="texelRadio nudge" data-direction="down" ><img src="/html/texel/img/nudgeDown.png" /></div><div class="toolText">Nudge</div></div></div></div></div>';$("body").append(i),a._nudgeTool(t,$(".texelPopupContainer"),e),createScrollableLock($("#textEditor_color")),a._bindTexelPopupPulldowns($(".texelPopupContainer"),e),$(".texelPopupContainer").find(".texelDeleteButton").on("click",function(){e.deleted=!0,a._paintTexel(a.options.activeDesign,!0,null,!0),$(".texelPopupContainer").remove()}),$(".texelPopupContainer").find(".texelCloseButton").on("click",function(){$(".texelPopupContainer").remove()})},createImagePopup:function(p,u){var m=this;m.closeTexelPopupContainers();var e='<div class="texelPopupContainer texelImageEditor texelWideContainer" data-targetedElementId="'+p.id+'"><div class="texelDeleteButton">Remove <img src="/html/texel/img/delete.png" /></div><div class="texelCloseButton">x</div><div class="texelLeftPointer"></div><div class="texelPopupRow noTopBorder"><div><div class="texelRadio" data-type="env-action" data-target="imageRotate" data-value="left"><img src="/html/texel/img/rotateLeft.png" /></div><div class="texelRadio" data-type="env-action" data-target="imageRotate" data-value="right"><img src="/html/texel/img/rotateRight.png" /></div><div class="toolText">Rotate</div></div>'+(p.custom?'<div><div class="texelRadio" data-type="env-action" data-target="imageLayering" data-value="down"><img src="/html/texel/img/layerDown.png" /></div><div class="texelRadio" data-type="env-action" data-target="imageLayering" data-value="up"><img src="/html/texel/img/layerUp.png" /></div><div class="toolText">Layer</div></div>':"")+'<div><div class="texelRadio nudge" data-direction="left"><img src="/html/texel/img/nudgeLeft.png" /></div><div class="texelRadio nudge" data-direction="up"><img src="/html/texel/img/nudgeUp.png" /></div><div class="texelRadio nudge" data-direction="right"><img src="/html/texel/img/nudgeRight.png" /></div><div class="texelRadio nudge" data-direction="down" ><img src="/html/texel/img/nudgeDown.png" /></div><div class="toolText">Nudge</div></div><div><div class="texelRadio" data-type="env-action" data-target="imageZoom" data-value="in"><img src="/html/texel/img/zoomIn.png" /></div><div class="texelRadio" data-type="env-action" data-target="imageZoom" data-value="out"><img src="/html/texel/img/zoomOut.png" /></div><div class="toolText">Zoom</div></div><div><div class="texelRadio" data-type="env-action" data-target="imageCrop" data-active="false"><img src="/html/texel/img/crop.png" /></div><div class="toolText">Crop</div></div></div><div class="texelPopupRow uploadBlock"><h4>Upload Your Own Images:</h4><p>Supported Files: AI, EPS, BMP, JPEG, PNG, GIF, TIFF<br>20MB File Size Maximum.</p>'+("function"==typeof navigator.sayswho&&null!=navigator.sayswho().match(/(?:msie|ie \d+)/i)?"<p>If you are experiencing difficulty uploading your logo on Internet Explorer, please switch to either FireFox or Chrome.</p>":"")+'</div><div class="texelPopupRow texelNoPadding"><div class="texelUploadErrorBox jqs-texelUploadErrorBox texelHidden"></div></div><div class="texelPopupRow noTopBorder"><div class="texelButtonOrange texelImageUpload">Upload Image</div></div><div class="texelPopupRow"><div class="uploadContainer"><div class="uploadGrid"></div></div></div><form class="texelImgUpl" id="texelImgUpl" action="/'+websiteId+'/control/uploadUGCFile" method="post" enctype="multipart/form-data"><input type="file" name="ugcFile" id="ugcFileBut"></form></div>';$("body").append(e),m._paintUserImages(u,p,!1),$(".texelPopupContainer #texelImgUpl").on("submit",function(e){e.preventDefault();var t=e.target,a=new FormData(t);$(".jqs-texelUploadErrorBox").html(""),$(".jqs-texelUploadErrorBox").removeClass("texelHidden").addClass("texelHidden"),$(".texelPopupContainer .uploadContainer").texelLoader(!0),$.ajax({url:t.action,method:t.method,processData:!1,contentType:!1,data:a,dataType:"json"}).done(function(e){if($(".texelPopupContainer").find("#ugcFileBut").val(""),e.success&&void 0!==e.paths){for(var t=0;t<e.paths.length;t++)-1!=e.paths[t].path.indexOf("fxg")?m._globalVars.userImages.unshift("//actionenvelopew2p.scene7.com/is/agm/"+e.paths[t].path):m._globalVars.userImages.unshift("//actionenvelopew2p.scene7.com/is/image/"+e.paths[t].path);m._paintUserImages(u,p,!0)}else $(".jqs-texelUploadErrorBox").html("There was an issue uploading the image."),$(".jqs-texelUploadErrorBox").removeClass("texelHidden");$(".texelPopupContainer .uploadContainer").texelLoader(!1)}).fail(function(){$(".jqs-texelUploadErrorBox").html("There was an issue uploading the image."),$(".jqs-texelUploadErrorBox").removeClass("texelHidden"),$(".texelPopupContainer .uploadContainer").texelLoader(!1)})}),$(".texelPopupContainer").find(".texelImageUpload").on("click",function(){$(".texelPopupContainer").find("#ugcFileBut").trigger("click")}),$(".texelPopupContainer").find("#ugcFileBut").on("change",function(){$("#texelImgUpl").submit()}),$(".texelPopupContainer").find('[data-target="imageRotate"]').on("click",function(){switch($(this).attr("data-value")){case"left":0==p.rotation?p.rotation=270:p.rotation-=90;break;case"right":270==p.rotation?p.rotation=0:p.rotation+=90}m._updateDragSettings(u,p),m._submitPopupChanges(p)}),$(".texelPopupContainer").find('[data-target="imageLayering"]').on("click",function(){$(this).hasClass("texelToolDisabled")||m._adjustLayering(p.id,$(this).attr("data-value"))}),m._nudgeTool(u,$(".texelPopupContainer"),p),$(".texelPopupContainer").find('[data-target="imageZoom"]').on("click",function(){switch($(this).attr("data-value")){case"in":p.zoom<2?p.zoom+=.1:p.zoom+=0;break;case"out":1<=p.zoom?p.zoom-=.1:p.zoom-=0}p.cropStartX=p.leftCropAmt+p.lastCropWidth*(p.zoom-1)/2,p.cropStartY=p.topCropAmt+p.lastCropHeight*(p.zoom-1)/2,p.cropWidth=p.lastCropWidth-p.lastCropWidth*(p.zoom-1),p.cropHeight=p.lastCropHeight-p.lastCropHeight*(p.zoom-1),m._updateDragSettings(u,p),m._submitPopupChanges(p)});var v=$(".texelPopupContainer").find('[data-target="imageCrop"]');texelBeginCropping=function(){if("true"!=v.attr("data-active")){v.attr("data-active","true");var e=90==p.rotation||270==p.rotation?.9*parseInt(u.css("height"))+"px":.9*parseInt(u.css("width"))+"px",t=90==p.rotation||270==p.rotation?.9*parseInt(u.css("width"))+"px":.9*parseInt(u.css("height"))+"px",a=.1*parseInt(e)/2+"px",i=.1*parseInt(t)/2+"px";u.find(".s7ElementImage").append($("<div/>").addClass("cropBox").css({width:e,height:t,left:a,top:i}).hover(function(e){u.resizable("disable"),u.draggable("disable"),e.stopPropagation()},function(e){u.resizable("enable"),u.draggable("enable")}).resizable({containment:"parent",handles:"nw, se",delay:150,autoHide:!1,aspectRatio:!1,create:function(e,t){f=e},stop:function(e,t){f=e}}).draggable({containment:"parent",cursor:"move",snap:!1,scroll:!1,distance:10,create:function(e,t){f=e},stop:function(e,t){f=e}}).append($("<div />").addClass("applyCrop texelButtonOrange").html("Apply Crop").on("click",function(){texelEndCropping(!0)}))),$(window).off("keydown.cropApplicationKey").on("keydown.cropApplicationKey",function(e){13==e.keyCode&&texelEndCropping(!0)})}},texelEndCropping=function(e){var t,a,i,o,l,n,s,r,d,c,g,h;"true"==v.attr("data-active")&&(v.attr("data-active","false"),u.find(".s7ElementImage .cropBox").length&&(void 0!==e&&e&&(t=p,a=f,i=""!=$(a.target).css("left")?parseInt($(a.target).css("left")):0,o=parseInt($(a.target).parent().css("width"))-(parseInt($(a.target).css("width"))+i),l=""!=$(a.target).css("top")?parseInt($(a.target).css("top")):0,n=parseInt($(a.target).parent().css("height"))-(parseInt($(a.target).css("height"))+l),s=t.cropStartX-t.leftCropAmt,r=t.cropStartY-t.topCropAmt,d=t.cropWidth+(t.leftCropAmt+t.rightCropAmt),c=t.cropHeight+(t.topCropAmt+t.bottomCropAmt),g=t.lastCropWidth+t.lastCropWidth/t.cropWidth*(t.leftCropAmt+t.rightCropAmt),h=t.lastCropHeight+t.lastCropHeight/t.cropHeight*(t.topCropAmt+t.bottomCropAmt),t.leftCropAmt=t.leftCropAmt+m._getOriginalSize(i)/t.scaleX*(t.imageAttrWidth/t.width),t.topCropAmt=t.topCropAmt+m._getOriginalSize(l)/t.scaleY*(t.imageAttrHeight/t.height),t.rightCropAmt=t.rightCropAmt+m._getOriginalSize(o)/t.scaleX*(t.imageAttrWidth/t.width),t.bottomCropAmt=t.bottomCropAmt+m._getOriginalSize(n)/t.scaleY*(t.imageAttrHeight/t.height),t.lastCropWidth=g-t.lastCropWidth/t.cropWidth*(t.leftCropAmt+t.rightCropAmt),t.lastCropHeight=h-t.lastCropHeight/t.cropHeight*(t.topCropAmt+t.bottomCropAmt),t.cropStartX=s+t.leftCropAmt,t.cropStartY=r+t.topCropAmt,t.cropWidth=d-(t.leftCropAmt+t.rightCropAmt),t.cropHeight=c-(t.topCropAmt+t.bottomCropAmt),m._updateDragSettings(u,t),m._submitPopupChanges(t)),u.find(".cropBox").remove()),u.resizable("enable"),u.draggable("enable"),$(window).off("keydown.cropApplicationKey"))};var f=null;$(".texelPopupContainer").find('[data-target="imageCrop"]').on("click",function(){texelBeginCropping()}),$(".texelPopupContainer").find(".texelDeleteButton").on("click",function(){p.deleted=!0,m._paintTexel(m.options.activeDesign,!0,null,!0),$(".texelPopupContainer").remove()}),$(".texelPopupContainer").find(".texelCloseButton").on("click",function(){u.find(".cropBox").remove(),$(".texelPopupContainer").remove()}),m._updateObjectTools("imageLayering")},_loadUserImages:function(){var a=this;$.ajax({url:"/"+websiteId+"/control/getImageLibrary",data:{catId:""},cache:!1,dataType:"json",async:!0}).done(function(t){t.success&&void 0!==t.content&&(a._globalVars.partyId=t.partyId,$.each(t.content,function(e){-1!=t.content[e].assetUrl.indexOf("fxg")?a._globalVars.userImages.push("//actionenvelopew2p.scene7.com/is/agm/"+t.content[e].assetUrl):a._globalVars.userImages.push("//actionenvelopew2p.scene7.com/is/image/"+t.content[e].assetUrl)}))})},_paintUserImages:function(e,i,t){var o=this;$(".texelPopupContainer .uploadGrid").empty(),$.each(o._globalVars.userImages,function(e){$(".texelPopupContainer .uploadGrid").append($("<img/>").attr({"data-url":o._globalVars.userImages[e],src:o._globalVars.userImages[e]+"?fmt=png-alpha&wid=75&hei=75"}).on("click",function(){if(-1!=$(this).attr("data-url").indexOf("fxg")){var e=getFXGXML($(this).attr("data-url").match(/.*?\/(\d+)\.fxg/)[1],!0),t=parseFloat($(e).find("Graphic").attr("viewWidth")),a=parseFloat($(e).find("Graphic").attr("viewHeight"));o._updateImageAttr(i,{width:t,height:a},"http:"+$(this).attr("data-url"))}else o._updateImageAttr(i,o._getImageAttr("http:"+$(this).attr("data-url")),"http:"+$(this).attr("data-url"))}))}),t&&$($(".texelPopupContainer .uploadGrid img")[0]).trigger("click"),0==o._globalVars.userImages.length&&$(".texelPopupContainer").find("#ugcFileBut").trigger("click")},_getImageAttr:function(e){var t={};return $.ajax({type:"GET",timeout:5e3,url:"https://texel.envelopes.com/getImageAttr?url="+e,dataType:"json",async:!1}).done(function(e){t=e}),t},_updateImageAttr:function(e,t,a){var i=1;parseFloat(t.width)>this._globalVars.templateWidth&&this._globalVars.templateWidth/parseFloat(t.width)<=this._globalVars.templateHeight/parseFloat(t.height)?i=this._globalVars.templateWidth/3/parseFloat(t.width):parseFloat(t.height)>this._globalVars.templateHeight&&this._globalVars.templateHeight/parseFloat(t.height)<=this._globalVars.templateWidth/parseFloat(t.width)&&(i=this._globalVars.templateHeight/3/parseFloat(t.height)),e.scaleX=i,e.scaleY=i,e.width=parseFloat(t.width),e.height=parseFloat(t.height),e.lastCropWidth=e.width,e.lastCropHeight=e.height,e.cropStartX=0,e.cropStartY=0,e.leftCropAmt=0,e.topCropAmt=0,e.rightCropAmt=0,e.bottomCropAmt=0,e.cropWidth=e.width,e.cropHeight=e.height,e.imageAttrWidth=e.width,e.imageAttrHeight=e.height,e.url=a.replace("http://actionenvelopew2p.scene7.com/is/image/","").replace("http://actionenvelopew2p.scene7.com/is/agm/",""),e.url=-1!=e.url.indexOf("fxg")?e.url.replace("ActionEnvelope/",""):e.url,this._submitPopupChanges(e)},createTextPopup:function(t,e){var a=this;function i(e){for(var t="",a="",i=e-20<0?0:e-20;i<e+20;i++)e===i&&(a=i),t+='<div class="texelListItem'+(i===e?" texelSelectListSelected":"")+'" data-value="'+i+'">'+i+"</div>";return""==a&&(t+='<div class="texelListItem texelSelectListSelected" data-value="'+e+'">'+e+"</div>"),t}"undefined"!=typeof index&&null!=index||(index=this.options.activeDesign),a.closeTexelPopupContainers();var o='<div class="texelPopupContainer" data-targetedElementId="'+t.id+'"><div class="texelDeleteButton">Remove <img src="/html/texel/img/delete.png" /></div><div class="texelCloseButton">X</div><div class="texelLeftPointer textAreaBackground"></div>'+(t.isVariable?"":'<textarea class="texelTextArea" name="texelText" placeholder="Begin by typing here...">'+t.text+"</textarea>")+'<div class="texelPopupRow"><div><div class="texelSelect fontName" data-type="env-listParent" data-target="textEditor_fontFamily">'+t.fontFamily+'</div><div id="textEditor_fontFamily" class="texelSelectList jqs-scrollable" data-type="env-listChild"><h4>FONTS</h4>'+a.getFontList(e)+'</div><div class="toolText">Font</div></div><div><div class="texelSelect fontColor" data-type="env-listParent" data-target="textEditor_color" data-value="color1"><div class="selectedColor" style="background-color: '+t.color+'"></div></div><div id="textEditor_color" class="texelSelectList jqs-scrollable" data-type="env-listChild"><h4>COLORS</h4>'+a.getColorList(e)+'</div><div class="toolText">Ink Color</div></div><div><img class="textSize" src="/html/texel/img/textSize.png" /><div class="texelSelect fontSize" data-type="env-listParent" data-target="textEditor_fontSize">'+t.fontSize+'</div><div id="textEditor_fontSize" class="texelSelectList jqs-scrollable" data-type="env-listChild"><h4>SIZES</h4>'+i(t.fontSize)+'</div><div class="toolText">Font Size</div></div></div><div class="texelPopupRow"><div><img class="textSpacing" src="/html/texel/img/textSpacing.png" /><div class="texelSelect" data-type="env-listParent" data-target="textEditor_tracking">'+t.tracking+'</div><div id="textEditor_tracking" class="texelSelectList jqs-scrollable" data-type="env-listChild"><h4>SPACING</h4>'+i(t.tracking)+'</div><div class="toolText">Text Spacing</div></div><div><img class="lineSpacing" src="/html/texel/img/lineSpacing.png" /><div class="texelSelect" data-type="env-listParent" data-target="textEditor_lineHeight">'+t.lineHeight+'</div><div id="textEditor_lineHeight" class="texelSelectList jqs-scrollable" data-type="env-listChild"><h4>SPACING</h4>'+i(t.lineHeight)+'</div><div class="toolText">Line Height</div></div><div><div class="texelRadio" data-type="env-radio" data-target="fontAlignment" data-value="left" data-selected="'+("left"==t.textAlign?"true":"false")+'"><div class="tlb1-fontAlignment"></div><div class="tlb2-fontAlignment"></div><div class="tlb3-fontAlignment"></div><div class="tlb4-fontAlignment"></div></div><div class="texelRadio" data-type="env-radio" data-target="fontAlignment" data-value="center" data-selected="'+("center"==t.textAlign?"true":"false")+'"><div class="tmb1-fontAlignment"></div><div class="tmb2-fontAlignment"></div><div class="tmb3-fontAlignment"></div><div class="tmb4-fontAlignment"></div></div><div class="texelRadio" data-type="env-radio" data-target="fontAlignment" data-value="right" data-selected="'+("right"==t.textAlign?"true":"false")+'"><div class="trb1-fontAlignment"></div><div class="trb2-fontAlignment"></div><div class="trb3-fontAlignment"></div><div class="trb4-fontAlignment"></div></div><div class="toolText">Font Alignment</div></div></div><div class="texelPopupRow"><div><div class="texelRadio" data-type="env-action" data-target="imageRotate" data-value="left"><img src="/html/texel/img/rotateLeft.png" /></div><div class="texelRadio" data-type="env-action" data-target="imageRotate" data-value="right"><img src="/html/texel/img/rotateRight.png" /></div><div class="toolText">Rotate</div></div>'+(t.custom?'<div><div class="texelRadio" data-type="env-action" data-target="imageLayering" data-value="down"><img src="/html/texel/img/layerDown.png" /></div><div class="texelRadio" data-type="env-action" data-target="imageLayering" data-value="up"><img src="/html/texel/img/layerUp.png" /></div><div class="toolText">Layer</div></div>':"")+'<div><div class="texelRadio nudge" data-direction="left"><img src="/html/texel/img/nudgeLeft.png" /></div><div class="texelRadio nudge" data-direction="up"><img src="/html/texel/img/nudgeUp.png" /></div><div class="texelRadio nudge" data-direction="right"><img src="/html/texel/img/nudgeRight.png" /></div><div class="texelRadio nudge" data-direction="down" ><img src="/html/texel/img/nudgeDown.png" /></div><div class="toolText">Nudge</div></div></div>'+(t.isVariable?'<div class="texelPopupRow"><div class="editAddress texelbtn">Edit Address</div></div>':"")+"</div>";$("body").append(o),createScrollableLock($("#textEditor_fontFamily")),createScrollableLock($("#textEditor_color")),createScrollableLock($("#textEditor_fontSize")),createScrollableLock($("#textEditor_tracking")),createScrollableLock($("#textEditor_lineHeight")),(null!=a._globalVars.product&&void 0!==a._globalVars.product.getProduct&&void 0!==a._globalVars.product.getProduct().color&&(void 0!==a._globalVars.allowedColors[a._globalVars.product.getProduct().color]&&void 0!==a._globalVars.allowedColors[a._globalVars.product.getProduct().color].Custom&&a._globalVars.allowedColors[a._globalVars.product.getProduct().color].Custom||void 0===a._globalVars.allowedColors[a._globalVars.product.getProduct().color])||"undefined"!=typeof websiteId&&"admin"==websiteId)&&($('<label for="miniColorPicker" />').html("Custom: ").append($("<input />").attr("id","miniColorPicker")).insertAfter("#textEditor_color h4"),$("#miniColorPicker").minicolors({control:"hue",defaultValue:"#000000",format:"hex",keywords:"",inline:!1,letterCase:"lowercase",position:"bottom right",theme:"default",change:function(e){a._updateColorSelection("textEditor_color",e,t)}})),a._bindTexelPopupPulldowns($(".texelPopupContainer"),t),$(".texelPopupContainer").find(".editAddress").on("click",function(){a.showGrid(null,a._globalVars.designs[index].activeVariableData)}),$(".texelPopupContainer").find('[data-type="env-radio"]').on("click",function(){var e=$(this).attr("data-target");$('[data-target="'+e+'"]').attr("data-selected","false"),$(this).attr("data-selected","true"),t.textAlign=$(this).attr("data-value"),a._submitPopupChanges(t)}),a._nudgeTool(e,$(".texelPopupContainer"),t),$(".texelPopupContainer").find('[data-target="imageRotate"]').on("click",function(){switch($(this).attr("data-value")){case"left":0==t.rotation?t.rotation=270:t.rotation-=90;break;case"right":270==t.rotation?t.rotation=0:t.rotation+=90}a._submitPopupChanges(t)}),$(".texelPopupContainer").find('[data-target="imageLayering"]').on("click",function(){$(this).hasClass("texelToolDisabled")||a._adjustLayering(t.id,$(this).attr("data-value"))}),$(".texelPopupContainer").find(".texelTextArea").on("input",function(e){t.text=$(this).val(),a._submitPopupChanges(t)}),t.changed||$(".texelPopupContainer").find(".texelTextArea").focus().select(),$(".texelPopupContainer").find(".texelDeleteButton").on("click",function(){t.deleted=!0,""!=e.attr("group-id")&&$.each($("[group-id="+e.attr("group-id")+"]"),function(){$(this).data("Scene7Element").deleted=!0}),a._paintTexel(a.options.activeDesign,!0,null,!0),$(".texelPopupContainer").remove()}),$(".texelPopupContainer").find(".texelCloseButton").on("click",function(){$(".texelPopupContainer").remove()}),a._updateObjectTools("imageLayering")},deactivateOrActivateAddressing:function(e){var t=this;if(void 0!==e){for(var a=0;a<t._globalVars.designs[t.options.activeDesign].elements.length;a++){var i=this._globalVars.designs[t.options.activeDesign].elements[a];i.id.match("_addressing")&&(i.deleted=!e)}t._setAllowedColors(t.options.activeDesign),t._paintTexel(t.options.activeDesign,!0,null,!0)}},_updateColorSelection:function(e,t,a){$('[data-target="'+e+'"]').attr("data-value",t),$('[data-target="'+e+'"]').find("span").css("color",t),$('[data-target="'+e+'"]').find("div").css("background-color",t),a[e.replace("textEditor_","")]=t,this._submitPopupChanges(a)},_bindTexelPopupPulldowns:function(e,i){var o=this;e.find('[data-type="env-listParent"]').on("click",function(){var t=$(this),a=t.attr("data-target");0==$("#"+a+":visible").length?($("#"+a).show(),$(window).bind("click.env-CloseListEvent-"+a,function(e){0==$(e.target).parents("#"+a).length&&$(e.target).attr("data-target")!=t.attr("data-target")&&($("#"+a).hide(),$(this).off("click.env-CloseListEvent-"+a))}),$("#"+a).scrollTo(parseInt($("#"+a).find(".texelSelectListSelected").offset().top)-parseInt($("#"+a).offset().top))):($("#"+a).hide(),$(window).off("click.env-CloseListEvent-"+a))}),e.find('[data-type="env-listChild"] > div.texelListItem').on("click",function(){$(this).addClass("texelSelectListSelected").siblings(".texelSelectListSelected").removeClass("texelSelectListSelected");var e=$(this).closest(".texelSelectList").attr("id");if("textEditor_color"==e)o._updateColorSelection(e,$(this).attr("data-value"),i);else{$('[data-target="'+e+'"]').attr("data-value",$(this).attr("data-value")),$('[data-target="'+e+'"]').html($(this).attr("data-value"));var t=e.replace("textEditor_",""),a="fontSize"==t||"tracking"==t||"lineHeight"==t?parseInt($(this).attr("data-value")):$(this).attr("data-value");i[t]=a,$(window).trigger("click.env-CloseListEvent-"+e),o._submitPopupChanges(i)}})},_submitPopupChanges:function(e){var t=this;e.changed=!0,waitForFinalEvent(function(){t._paintTexel(t.options.activeDesign,!0,[e.id],!1)},300,e.id+"_popUpChanges")},_nudgeTool:function(e,t,a){var i=this;t.find(".nudge").on("click",function(){switch($(this).attr("data-direction")){case"left":$(e).css("left",parseInt($(e).css("left"))-1+"px"),i._updateDragSettings(e,a);break;case"right":$(e).css("left",parseInt($(e).css("left"))+1+"px"),i._updateDragSettings(e,a);break;case"up":$(e).css("top",parseInt($(e).css("top"))-1+"px"),i._updateDragSettings(e,a);break;case"down":$(e).css("top",parseInt($(e).css("top"))+1+"px"),i._updateDragSettings(e,a)}i._createHistory()})},_updateToolPosition:function(e){if(e.attr("id")==$(".texelPopupContainer").attr("data-targetedelementid")){var t=parseInt(this._getRotationFromTransform(e,!0)),a=e.offset().top-(parseInt($(".texelPopupContainer .texelLeftPointer").css("top"))+$(".texelPopupContainer .texelLeftPointer").outerWidth())/2+30;parseInt($(".texel_designer").offset().top)+20>a?a+=Math.abs(parseInt($(".texel_designer").offset().top)+20-a):parseInt($(".texel_designer").offset().top)+parseInt($(".texel_designer").height())-150<a+parseInt($(".texelPopupContainer").height())&&(a=parseInt($(".texel_designer").offset().top)+parseInt($(".texel_designer").height())-150-parseInt($(".texelPopupContainer").height()));var i=e.offset().left+(90==t||270==t?e.outerHeight():e.outerWidth())+$(".texelPopupContainer .texelLeftPointer").outerWidth()/2;i+$(".texelPopupContainer").outerWidth()>$(window).width()&&(i=$(window).width()-$(".texelPopupContainer").outerWidth()),$(".texelPopupContainer").css({top:a,left:i})}},_getRotationFromTransform:function(e,t){if("none"==e.css("transform"))return 0;t=void 0!==t&&t;var a=e.css("transform").split("(")[1].split(")")[0].split(","),i=parseFloat(Math.atan2(a[1],a[0])*(180/Math.PI));return i<0&&t&&(i+=360),i},_getObjParentOffsetByName:function(e,t){for(var a=0;a<t.elements.length;a++)if(t.elements[a].id==e)return{x:t.elements[a].parentX,y:t.elements[a].parentY};for(a=0;a<t.hiddenElements.length;a++)if(t.hiddenElements[a].id==e&&void 0!==t.hiddenElements[a].parentX)return{x:t.hiddenElements[a].parentX,y:t.hiddenElements[a].parentY};return{x:0,y:0}},_isElementOverflown:function(e){return e.parent().width()<parseInt(e.css("left"))+parseInt(e.width())||e.parent().height()<parseInt(e.css("top"))+parseInt(e.height())||parseInt(e.css("top"))<0||parseInt(e.css("left"))<0},setInkSelector:function(e,t){this._globalVars.colorsFrontSel=e,this._globalVars.colorsBackSel=t},_calculatePrintColors:function(){var r=this;$.each(r._globalVars.designs,function(e){var t={},a=void 0,i=0,o=!1,l=!1,n="";if($.each(r._globalVars.designs[e].elements,function(){return!(!this.deleted&&"COLOR_bgcolor"!=this.id)||("KEYLINE"==(a=void 0!==this.color?this.color:"#000000")||("BitmapImage"===this.type?l=!0:(this.editable&&"#ffffff"==a.toLowerCase()&&"ffffff"!=r.options.backgroundColor.toLowerCase()&&(o=!0),void(a.toLowerCase()!=r.options.backgroundColor.toLowerCase()&&(t[a]=void 0===t[a]?1:t[a]+1)))))}),i+=Object.keys(t).length,l&&i<2&&(i=2),2<i?i=4:1<i&&(i=2),o&&(i="0"==e?"whiteInkFront":"whiteInkBack"),null!=r._globalVars.product)switch(e){case"0":$.each(r._globalVars.colorsFrontSel,function(){$(this).attr("data-value")==i+""&&$(this).trigger("click")});break;case"1":$.each(r._globalVars.colorsBackSel,function(){$(this).attr("data-value")==i+""&&$(this).trigger("click")})}var s=0;$.each(t,function(e,t){0<s&&(n+=","),void 0!==r.options.allSpotColors&&e.toLowerCase().replace("#","")in r.options.allSpotColors&&(n+=r.options.allSpotColors[e.toLowerCase().replace("#","")]),s++}),0<n.length&&(r._globalVars.designs[e].spotColors=n)})},_getSpotColors:function(){var i=this;$.ajax({type:"GET",url:"/"+websiteId+"/control/getSpotColors",dataType:"json"}).done(function(e,t,a){void 0!==e.spotColors&&0<e.spotColors.length&&$.each(e.spotColors,function(e,t){void 0!==t&&void 0!==t.hex&&void 0!==t.pms&&(i.options.allSpotColors[t.hex]=t.pms)})})},_cleanDesignObjectForStorage:function(){var a=this,i=this._clone(this.options),o=this._clone(this._globalVars.designs);if($.each(o,function(t,e){o[t].scene7url=a._generateUrlFromParams(a._generateQueryParams(t,null,!0,670,!1)),$.each(o[t].elements,function(e){!o[t].elements[e].deleted&&o[t].elements[e].isVariable&&(o[t].cleanAddressUrl=a._generateUrlFromParams(a._generateQueryParams(t,null,!0,670,!0))),o[t].elements[e].image=null}),delete o[t].s7XML,delete o[t].lastElement,delete o[t].customCount,delete o[t].history,delete o[t].historyPosition,delete o[t].s7ElementQueue,delete o[t].activeVariableData,delete o[t].variableData,delete o[t].allSpotColors,delete i.designs[t].addressBookId,delete i.designs[t].cleanAddressUrl,delete i.designs[t].elements,delete i.designs[t].hiddenElements,delete i.designs[t].scene7url,delete i.designs[t].spotColors}),null!=this._globalVars.product){var e={scene7Data:{settings:i,designs:o},itemComments:"",inkColors:""};void 0!==this._globalVars.product.getProduct?this._globalVars.product.getProduct().s7Data=e:this._globalVars.product.s7Data=e}}}),$.fn.texelLoader=function(e){var t=$(this);e?(t.find("div.texelLoader").remove(),t.append($("<div/>").addClass("texelLoader").append($("<div/>").addClass("spin")))):t.find("div.texelLoader").remove()};
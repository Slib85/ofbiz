#############################
#############################
#############################
#health check rules
server {
    error_log                  /var/log/nginx/error.log;
    access_log                 /var/log/nginx/access.log main;
    client_max_body_size       20M;

    listen 443 ssl http2;
    listen [::]:443 ssl http2;

    server_name                jvm1.bigname.com;
    #set ssl rules
    include /usr/local/ofbiz/etc/nginx/bigname_ssl.rules;
    include /usr/local/ofbiz/etc/nginx/ssl.rules;

    #set gzip to reduce transfer sizes
    include /usr/local/ofbiz/etc/nginx/gzip.rules;

    if ($scheme = http) {
        set $ofbiz $scheme://adminfarm;
    }
    if ($scheme = https) {
        set $ofbiz $scheme://jvm1;
    }

    location / {
        deny all;
    }

    #main rules
    location = /bigname/control/h3althCh3ck {
        add_header Cache-Control "no-cache";

        proxy_pass $ofbiz;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Cache $cache;
        proxy_redirect off;
        proxy_intercept_errors on;
        proxy_http_version 1.1;
    }
    location = /admin/control/cl3arAllCach3 {
        add_header Cache-Control "no-cache";

        proxy_pass $ofbiz;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Cache $cache;
        proxy_redirect off;
        proxy_intercept_errors on;
        proxy_http_version 1.1;
    }
}
server {
    error_log                  /var/log/nginx/error.log;
    access_log                 /var/log/nginx/access.log main;
    client_max_body_size       20M;

    listen 443 ssl http2;
    listen [::]:443 ssl http2;

    server_name                jvm2.bigname.com;
    #set ssl rules
    include /usr/local/ofbiz/etc/nginx/bigname_ssl.rules;
    include /usr/local/ofbiz/etc/nginx/ssl.rules;

    #set gzip to reduce transfer sizes
    include /usr/local/ofbiz/etc/nginx/gzip.rules;

    if ($scheme = http) {
        set $ofbiz $scheme://adminfarm;
    }
    if ($scheme = https) {
        set $ofbiz $scheme://jvm2;
    }

    location / {
        deny all;
    }

    #main rules
    location = /bigname/control/h3althCh3ck {
        add_header Cache-Control "no-cache";

        proxy_pass $ofbiz;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Cache $cache;
        proxy_redirect off;
        proxy_intercept_errors on;
        proxy_http_version 1.1;
    }
    location = /admin/control/cl3arAllCach3 {
        add_header Cache-Control "no-cache";

        proxy_pass $ofbiz;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Cache $cache;
        proxy_redirect off;
        proxy_intercept_errors on;
        proxy_http_version 1.1;
    }
}
server {
    error_log                  /var/log/nginx/error.log;
    access_log                 /var/log/nginx/access.log main;
    client_max_body_size       20M;

    listen 443 ssl http2;
    listen [::]:443 ssl http2;

    server_name                jvm3.bigname.com;
    #set ssl rules
    include /usr/local/ofbiz/etc/nginx/bigname_ssl.rules;
    include /usr/local/ofbiz/etc/nginx/ssl.rules;

    #set gzip to reduce transfer sizes
    include /usr/local/ofbiz/etc/nginx/gzip.rules;

    if ($scheme = http) {
        set $ofbiz $scheme://adminfarm;
    }
    if ($scheme = https) {
        set $ofbiz $scheme://jvm3;
    }

    location / {
        deny all;
    }

    #main rules
    location = /bigname/control/h3althCh3ck {
        add_header Cache-Control "no-cache";

        proxy_pass $ofbiz;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Cache $cache;
        proxy_redirect off;
        proxy_intercept_errors on;
        proxy_http_version 1.1;
    }
    location = /admin/control/cl3arAllCach3 {
        add_header Cache-Control "no-cache";

        proxy_pass $ofbiz;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Cache $cache;
        proxy_redirect off;
        proxy_intercept_errors on;
        proxy_http_version 1.1;
    }
}
server {
    error_log                  /var/log/nginx/error.log;
    access_log                 /var/log/nginx/access.log main;
    client_max_body_size       20M;

    listen 443 ssl http2;
    listen [::]:443 ssl http2;

    server_name                jvm4.bigname.com;
    #set ssl rules
    include /usr/local/ofbiz/etc/nginx/bigname_ssl.rules;
    include /usr/local/ofbiz/etc/nginx/ssl.rules;

    #set gzip to reduce transfer sizes
    include /usr/local/ofbiz/etc/nginx/gzip.rules;

    if ($scheme = http) {
        set $ofbiz $scheme://adminfarm;
    }
    if ($scheme = https) {
        set $ofbiz $scheme://jvm4;
    }

    location / {
        deny all;
    }

    #main rules
    location = /bigname/control/h3althCh3ck {
        add_header Cache-Control "no-cache";

        proxy_pass $ofbiz;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Cache $cache;
        proxy_redirect off;
        proxy_intercept_errors on;
        proxy_http_version 1.1;
    }
    location = /admin/control/cl3arAllCach3 {
        add_header Cache-Control "no-cache";

        proxy_pass $ofbiz;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Cache $cache;
        proxy_redirect off;
        proxy_intercept_errors on;
        proxy_http_version 1.1;
    }
}

#############################
#############################
#############################
#non-www to www for bigname
server {
    listen 80;
    listen [::]:80;
    listen 443 ssl http2;
    listen [::]:443 ssl http2;

    server_name bigname.com;
    #set ssl rules
    include /usr/local/ofbiz/etc/nginx/bigname_ssl.rules;
    include /usr/local/ofbiz/etc/nginx/ssl.rules;

    return 301 https://www.bigname.com$request_uri;
}

#route http to https for www.bigname.com
server {
    listen 80;
    listen [::]:80;

    server_name    www.bigname.com;
    return         301 https://www.bigname.com$request_uri;
}

#############################
#############################
#############################
#os.bigname.com
server {
    error_log                  /var/log/nginx/error.log;
    access_log                 /var/log/nginx/access.log main;
    client_max_body_size       500M;
    proxy_connect_timeout      180s;
    proxy_read_timeout         180s;
    proxy_send_timeout         180s;
    send_timeout               180s;

    listen 443 ssl http2;
    listen [::]:443 ssl http2;

    server_name                os.bigname.com;
    #set ssl rules
    include /usr/local/ofbiz/etc/nginx/bigname_ssl.rules;
    include /usr/local/ofbiz/etc/nginx/ssl.rules;

    #set gzip to reduce transfer sizes
    include /usr/local/ofbiz/etc/nginx/gzip.rules;

    if ($scheme = http) {
        set $ofbiz $scheme://adminfarm;
    }
    if ($scheme = https) {
        set $ofbiz $scheme://adminfarmSecure;
    }

    location = / {
        return 301 $scheme://$host/admin/control/main;
    }

    #set caching for static files
    include /usr/local/ofbiz/etc/nginx/static.rules;

    #robots ignore for dev settings
    location /robots.txt {
        return 200 "User-agent: *\nDisallow: /";
    }

    #nginx status
    location = /dashboard.html {
        add_header Cache-Control "no-cache";
        root /usr/share/nginx/html;
        #allow 173.251.121.74; # permit access from env office
        #deny all; # deny access from everywhere else
    }
    location = /status {
        add_header Cache-Control "no-cache";
        root /usr/share/nginx/html;
        #allow 173.251.121.74; # permit access from env office
        #deny all; # deny access from everywhere else

        stub_status;
    }
    location /api {
        api write=off;
        #allow 173.251.121.74; # permit access from env office
        #deny all; # deny access from everywhere else
    }

    #main rules
    location / {
        add_header Cache-Control "no-cache";

        proxy_pass $ofbiz;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Cache $cache;
        proxy_redirect off;
        proxy_intercept_errors on;
        proxy_http_version 1.1;
    }
}

#############################
#############################
#############################
#vendor.bigname.com
server {
    error_log                  /var/log/nginx/error.log;
    access_log                 /var/log/nginx/access.log main;
    client_max_body_size       500M;

    listen 443 ssl http2;
    listen [::]:443 ssl http2;

    server_name                vendor.bigname.com;
    #set ssl rules
    include /usr/local/ofbiz/etc/nginx/bigname_ssl.rules;
    include /usr/local/ofbiz/etc/nginx/ssl.rules;

    #set gzip to reduce transfer sizes
    include /usr/local/ofbiz/etc/nginx/gzip.rules;

    if ($scheme = http) {
        set $ofbiz $scheme://adminfarm;
    }
    if ($scheme = https) {
        set $ofbiz $scheme://adminfarmSecure;
    }

    location = / {
        return 301 $scheme://$host/vendor/control/main;
    }

    #set caching for static files
    include /usr/local/ofbiz/etc/nginx/static.rules;

    #robots ignore for dev settings
    location /robots.txt {
        return 200 "User-agent: *\nDisallow: /";
    }

    #main rules
    location / {
        add_header Cache-Control "no-cache";

        proxy_pass $ofbiz;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Cache $cache;
        proxy_redirect off;
        proxy_intercept_errors on;
        proxy_http_version 1.1;
    }
}

#############################
#############################
#############################
#www.bigname.com
server {
    error_log                  /var/log/nginx/error.log;
    access_log                 /var/log/nginx/access.log main;
    client_max_body_size       400M;

    listen 443 ssl http2;
    listen [::]:443 ssl http2;

    server_name                www.bigname.com;
    add_header Strict-Transport-Security max-age=31536000;
    
    #set ssl rules
    include /usr/local/ofbiz/etc/nginx/bigname_ssl.rules;
    include /usr/local/ofbiz/etc/nginx/ssl.rules;

    #set gzip to reduce transfer sizes
    include /usr/local/ofbiz/etc/nginx/gzip.rules;

    if ($scheme = http) {
        set $ofbiz $scheme://serverfarm;
    }
    if ($scheme = https) {
        set $ofbiz $scheme://serverfarmSecure;
    }
    if ($bignamenewRedirect) {
        rewrite ^ $bignamenewRedirect permanent;
    }
    if ($bignamenew) {
        set $ofbiz $ofbiz$bignamenew$is_args$args;
    }

    location = /robots.txt {
        alias /usr/local/ofbiz/hot-deploy/html/webapp/html/robots_bigname.txt;
    }

    location = /folders-urls-sitemap.xml {
        alias /usr/local/ofbiz/hot-deploy/html/webapp/html/folders-urls-sitemap.xml;
    }

    #location = /sitemap.xml {
    #    alias /usr/local/ofbiz/hot-deploy/html/webapp/html/sitemap_bigname.xml;
    #}

    #set caching for static files
    include /usr/local/ofbiz/etc/nginx/static.rules;

    #cache rules
    include /usr/local/ofbiz/etc/nginx/cache.rules;

    #main rules
    location / {
        add_header Cache-Control "no-cache";

        proxy_pass $ofbiz;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Cache $cache;
        proxy_redirect off;
        proxy_intercept_errors on;
        proxy_http_version 1.1;

        #health_check interval=2m fails=2 passes=2 uri=/envelopes/control/healthCheck match=server_ok;
    }

    location ~* /envelopes/control/ {
        return 404;
    }

    location ~* /folders/control/ {
        return 404;
    }

    location ~* /bags/control/ {
        return 404;
    }
}

#############################
#############################
#############################
#shop.bigname.com
server {
    error_log                  /var/log/nginx/error.log;
    access_log                 /var/log/nginx/access.log main;
    client_max_body_size       50M;

    listen 443 ssl http2;
    listen [::]:443 ssl http2;

    server_name                shop.bigname.com;
    
    #set ssl rules
    include /usr/local/ofbiz/etc/nginx/bigname_ssl.rules;
    include /usr/local/ofbiz/etc/nginx/ssl.rules;

    #set gzip to reduce transfer sizes
    include /usr/local/ofbiz/etc/nginx/gzip.rules;

    if ($scheme = http) {
        set $ofbiz $scheme://serverfarm;
    }
    if ($scheme = https) {
        set $ofbiz $scheme://serverfarmSecure;
    }
    if ($bignamenewRedirect) {
        rewrite ^ $bignamenewRedirect permanent;
    }
    if ($bignamenew) {
        set $ofbiz $ofbiz$bignamenew$is_args$args;
    }

    #main rules
    location / {
        add_header Cache-Control "no-cache";

        proxy_pass $ofbiz;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Cache $cache;
        proxy_redirect off;
        proxy_intercept_errors on;
        proxy_http_version 1.1;

        #health_check interval=2m fails=2 passes=2 uri=/envelopes/control/healthCheck match=server_ok;
    }
}
